<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Cheese Quiz Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- ê¸°ë³¸ ìŠ¤íƒ€ì¼: ê¹”ë”í•œ ì¹´ë“œí˜• ê´€ë¦¬ì í˜ì´ì§€ -->
  <style>
    :root {
      --bg: #f5f6fa;
      --card-bg: #ffffff;
      --border: #e1e4ea;
      --primary: #2563eb;
      --primary-soft: #e0edff;
      --text-main: #111827;
      --text-sub: #6b7280;
      --danger: #dc2626;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }

    .admin-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header.admin-header {
      padding: 0.9rem 1.5rem;
      border-bottom: 1px solid var(--border);
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .admin-logo {
      font-weight: 700;
      font-size: 1.1rem;
    }
    .admin-logo span {
      font-weight: 400;
      font-size: 0.9rem;
      color: var(--text-sub);
      margin-left: 0.4rem;
    }

    .admin-badge {
      font-size: 0.8rem;
      padding: 0.12rem 0.5rem;
      border-radius: 999px;
      border: 1px solid var(--primary-soft);
      background: var(--primary-soft);
      color: var(--primary);
    }

    .admin-main {
      display: grid;
      grid-template-columns: 220px minmax(0, 1fr);
      gap: 1.5rem;
      padding: 1.5rem;
    }

    /* ì‚¬ì´ë“œ ë©”ë‰´ */
    .admin-nav {
      align-self: flex-start;
      position: sticky;
      top: 4rem;
    }

    .admin-nav-group-title {
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--text-sub);
      margin-bottom: 0.4rem;
    }

    .admin-nav-list {
      list-style: none;
      margin: 0;
      padding: 0;
      border-radius: 0.75rem;
      border: 1px solid var(--border);
      background: #fff;
      overflow: hidden;
    }

    .admin-nav-item {
      border-top: 1px solid var(--border);
    }
    .admin-nav-item:first-child {
      border-top: none;
    }

    .admin-nav-button {
      display: flex;
      width: 100%;
      padding: 0.7rem 0.9rem;
      background: transparent;
      border: none;
      text-align: left;
      font-size: 0.9rem;
      cursor: pointer;
      color: var(--text-sub);
      align-items: center;
      gap: 0.4rem;
    }

    .admin-nav-button span.icon {
      font-size: 1rem;
      width: 1.4rem;
      text-align: center;
    }

    .admin-nav-button.active {
      background: var(--primary-soft);
      color: var(--primary);
      font-weight: 600;
    }

    /* ë©”ì¸ ì»¨í…ì¸  ì¹´ë“œ */
    .admin-section {
      display: none;
    }
    .admin-section.active {
      display: block;
    }

    .card {
      background: var(--card-bg);
      border-radius: 0.9rem;
      border: 1px solid var(--border);
      padding: 1.2rem 1.3rem;
      margin-bottom: 1rem;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.8rem;
      gap: 0.75rem;
    }

    .card-title {
      font-size: 1rem;
      font-weight: 600;
    }
    .card-subtitle {
      font-size: 0.84rem;
      color: var(--text-sub);
      margin-top: 0.1rem;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 0.15rem 0.55rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-size: 0.75rem;
      color: var(--text-sub);
      gap: 0.25rem;
    }

    .pill-dot {
      width: 0.35rem;
      height: 0.35rem;
      border-radius: 999px;
      background: #10b981;
    }

    /* ëŒ€ì‹œë³´ë“œ ìœ„ì ¯ */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
      gap: 0.8rem;
      margin-bottom: 0.3rem;
    }

    .dashboard-stat {
      background: #f9fafb;
      border-radius: 0.75rem;
      padding: 0.8rem 0.9rem;
      border: 1px solid #e5e7eb;
    }

    .dashboard-stat-label {
      font-size: 0.8rem;
      color: var(--text-sub);
      margin-bottom: 0.25rem;
    }

    .dashboard-stat-value {
      font-size: 1.05rem;
      font-weight: 600;
    }

    .dashboard-stat-note {
      font-size: 0.75rem;
      color: var(--text-sub);
      margin-top: 0.2rem;
    }

    /* í…Œì´ë¸” */
    .table-wrapper {
      width: 100%;
      overflow-x: auto;
      border-radius: 0.75rem;
      border: 1px solid var(--border);
    }

    table.admin-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
      background: #ffffff;
    }

    .admin-table thead {
      background: #f9fafb;
    }

    .admin-table th,
    .admin-table td {
      padding: 0.55rem 0.75rem;
      border-bottom: 1px solid var(--border);
      text-align: left;
      white-space: nowrap;
    }

    .admin-table th {
      font-weight: 600;
      color: var(--text-sub);
      font-size: 0.8rem;
    }

    .admin-table tbody tr:hover {
      background: #f5f7ff;
    }

    .badge-key {
      display: inline-flex;
      padding: 0.1rem 0.4rem;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
      font-size: 0.75rem;
    }

    .text-muted {
      color: var(--text-sub);
      font-size: 0.8rem;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.35rem 0.7rem;
      border-radius: 999px;
      font-size: 0.8rem;
      border: 1px solid var(--border);
      background: #fff;
      cursor: pointer;
    }

    .btn-primary {
      border-color: var(--primary);
      background: var(--primary);
      color: #fff;
    }

    .btn-ghost {
      background: transparent;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .field-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      margin-bottom: 0.6rem;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
      flex: 1 1 180px;
      min-width: 0;
    }

    .field label {
      font-size: 0.78rem;
      color: var(--text-sub);
    }

    .field input,
    .field select,
    .field textarea {
      border-radius: 0.55rem;
      border: 1px solid var(--border);
      padding: 0.4rem 0.5rem;
      font-size: 0.84rem;
      font-family: inherit;
    }

    .field textarea {
      min-height: 70px;
      resize: vertical;
    }

    .small-help {
      font-size: 0.75rem;
      color: var(--text-sub);
    }

    .danger-text {
      color: var(--danger);
      font-size: 0.8rem;
    }
    .admin-form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      gap: 0.75rem 1rem;
      margin-bottom: 1rem;
    }
    
    .admin-field-full {
      grid-column: 1 / -1;
    }
    
    .admin-code-preview {
      margin-top: 0.5rem;
      padding: 0.75rem 1rem;
      border-radius: 0.75rem;
      background: #0f172a;
      color: #e5e7eb;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.85rem;
      max-height: 260px;
      overflow: auto;
      white-space: pre-wrap;
    }


    @media (max-width: 840px) {
      .admin-main {
        grid-template-columns: 1fr;
      }

      .admin-nav {
        position: static;
      }
    }
  </style>
</head>
<body>
  <div class="admin-shell">
    <!-- ìƒë‹¨ í—¤ë” -->
    <header class="admin-header">
      <div class="admin-logo">
        Cheese Quiz Admin
        <span>í€´ì¦ˆÂ·DB ê´€ë¦¬ìš© ê´€ë¦¬ì í˜ì´ì§€</span>
      </div>
      <div class="admin-badge">
        v0.1 Â· frontend only
      </div>
    </header>

    <div class="admin-main">
      <!-- ì¢Œì¸¡ ë„¤ë¹„ê²Œì´ì…˜ -->
      <aside class="admin-nav">
        <div class="admin-nav-group-title">ë©”ë‰´</div>
        <ul class="admin-nav-list">
          <li class="admin-nav-item">
            <button
              class="admin-nav-button active"
              data-target="dashboard"
            >
              <span class="icon">ğŸ“Š</span>
              <span>ëŒ€ì‹œë³´ë“œ</span>
            </button>
          </li>
          <li class="admin-nav-item">
            <button
              class="admin-nav-button"
              data-target="quizzes"
            >
              <span class="icon">ğŸ“</span>
              <span>í€´ì¦ˆ ì„¸íŠ¸ ê´€ë¦¬</span>
            </button>
          </li>
          <li class="admin-nav-item">
            <button
              class="admin-nav-button"
              data-target="tools"
            >
              <span class="icon">ğŸ§©</span>
              <span>ë„êµ¬ Â· ì„¤ì •</span>
            </button>
          </li>
        </ul>
      </aside>

      <!-- ì˜¤ë¥¸ìª½ ì»¨í…ì¸  ì˜ì—­ -->
      <main>
        <!-- 1) ëŒ€ì‹œë³´ë“œ -->
        <section
          id="section-dashboard"
          class="admin-section active"
          data-section="dashboard"
        >
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">ìš”ì•½</div>
                <div class="card-subtitle">
                  êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ë¶ˆëŸ¬ì˜¨ í€´ì¦ˆ ì„¸íŠ¸ í†µê³„ì™€ ìµœê·¼ ê¸°ë¡ì„ í•œëˆˆì— ë³´ëŠ” í™”ë©´
                </div>
              </div>
              <button class="btn btn-primary" id="btn-refresh-all">
                ğŸ”„ ì „ì²´ ìƒˆë¡œê³ ì¹¨
              </button>
            </div>

            <div class="dashboard-grid" id="dashboard-stats">
              <!-- JSì—ì„œ ì±„ì›Œ ë„£ìŒ -->
            </div>
            <div class="small-help">
              â€» ì§€ê¸ˆì€ ë”ë¯¸ ë°ì´í„° ê¸°ì¤€ìœ¼ë¡œ í‘œì‹œë˜ê³  ìˆìŒ.  
              Apps Script ì›¹ì•± ì—°ê²° í›„, ì‹¤ì œ ì‹œí—˜ í†µê³„ë¡œ ë°”ê¿€ ì˜ˆì •.
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">ìµœê·¼ ë“±ë¡ëœ examKey</div>
                <div class="card-subtitle">
                  ìì£¼ ì‚¬ìš©í•˜ëŠ” ì—°ìŠµë¬¸ì œ ì„¸íŠ¸ë§Œ ê°„ë‹¨íˆ í™•ì¸
                </div>
              </div>
              <button
                class="btn btn-ghost"
                data-target="quizzes"
                data-jump-nav
              >
                âœ í€´ì¦ˆ ì„¸íŠ¸ ê´€ë¦¬ë¡œ ì´ë™
              </button>
            </div>

            <div class="table-wrapper">
              <table class="admin-table" id="dashboard-recent-table">
                <thead>
                  <tr>
                    <th>examKey</th>
                    <th>ì œëª©</th>
                    <th>ë¶„ë¥˜</th>
                    <th>ë¬¸í•­ ìˆ˜</th>
                    <th>ìµœê·¼ ìˆ˜ì •</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- JSì—ì„œ ì±„ì›€ -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- 2) í€´ì¦ˆ ì„¸íŠ¸ ê´€ë¦¬ -->
        <section
          id="section-quizzes"
          class="admin-section"
          data-section="quizzes"
        >
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">í€´ì¦ˆ ì„¸íŠ¸ ëª©ë¡</div>
                <div class="card-subtitle">
                  êµ¬ê¸€ ì‹œíŠ¸ì— ìˆëŠ” examKey / ì œëª© / ì‹œíŠ¸ íƒ­ ë“±ì„ í•œëˆˆì— ê´€ë¦¬
                </div>
              </div>
              <button class="btn btn-primary" id="btn-reload-quizzes">
                ğŸ”„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
              </button>
            </div>

            <div class="field-row">
              <div class="field">
                <label for="filter-period">ì‹œëŒ€ / ì¹´í…Œê³ ë¦¬ í•„í„°</label>
                <select id="filter-period">
                  <option value="">ì „ì²´</option>
                  <option value="í•œêµ­ì‚¬-í†µì‚¬">í•œêµ­ì‚¬ í†µì‚¬</option>
                  <option value="í•œêµ­ì‚¬-ê·¼í˜„ëŒ€">í•œêµ­ì‚¬ ê·¼í˜„ëŒ€</option>
                  <option value="ì¼ë³¸ì‚¬">ì¼ë³¸ì‚¬</option>
                  <!-- í•„ìš”í•˜ë©´ ì—¬ê¸° ê³„ì† ì¶”ê°€ -->
                </select>
              </div>
              <div class="field">
                <label for="filter-search">ê²€ìƒ‰ (examKey / ì œëª©)</label>
                <input
                  type="text"
                  id="filter-search"
                  placeholder="ì˜ˆ: khs-era-01 / ì‹œëŒ€ ìˆœì„œ"
                />
              </div>
            </div>

            <div class="table-wrapper">
              <table class="admin-table" id="quiz-table">
                <thead>
                  <tr>
                    <th style="min-width: 120px;">examKey</th>
                    <th style="min-width: 180px;">ì œëª©</th>
                    <th>ì‹œëŒ€Â·ë¶„ë¥˜</th>
                    <th>ì¶œì œ ê°œìˆ˜</th>
                    <th>ì‹œíŠ¸ íƒ­ ì´ë¦„</th>
                    <th>ë¹„ê³ </th>
                  </tr>
                </thead>
                <tbody>
                  <!-- JSì—ì„œ ë Œë”ë§ -->
                </tbody>
              </table>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">ì„ íƒí•œ examKey ë¹ ë¥¸ ë³µë¶™ìš©</div>
                <div class="card-subtitle">
                  ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ìš© `.cheese-quiz` HTML ì½”ë“œë¥¼ ë°”ë¡œ ë³µì‚¬í•´ì„œ ì‚¬ìš©
                </div>
              </div>
              <button class="btn" id="btn-copy-snippet">
                ğŸ“‹ ì½”ë“œ ë³µì‚¬
              </button>
            </div>

            <div class="field">
              <label for="snippet-output">ì‚½ì…ìš© HTML ì½”ë“œ</label>
              <textarea
                id="snippet-output"
                spellcheck="false"
              ></textarea>
              <div class="small-help">
                ì‹œí—˜ ì„¸íŠ¸ í–‰ì„ í´ë¦­í•˜ë©´ ìœ„ ì½”ë“œê°€ ìë™ìœ¼ë¡œ ê°±ì‹ ë¨.  
                í•„ìš”ì— ë”°ë¼ `data-limit`, `data-period` ì†ì„±ì„ ìˆ˜ì •í•´ì„œ ì‚¬ìš©.
              </div>
            </div>
          </div>
        </section>

        <!-- 3) ë„êµ¬/ì„¤ì • í™”ë©´ -->
        <section
          id="section-tools"
          class="admin-section"
          data-section="tools"
        >
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">ì—°ê²° ì •ë³´</div>
                <div class="card-subtitle">
                  Apps Script ì›¹ì•± / ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ID ë“± ê´€ë¦¬ììš© ë©”ëª¨ ê³µê°„
                </div>
              </div>
            </div>

            <div class="field-row">
              <div class="field">
                <label>í€´ì¦ˆ ì¡°íšŒìš© Apps Script URL</label>
                <input
                  type="text"
                  id="config-api-base"
                  placeholder="https://script.google.com/macros/s/XXXXX/exec"
                />
                <div class="small-help">
                  ì‹¤ì œë¡œëŠ” ì½”ë“œ ì•ˆì˜ <code>CHEESE_ADMIN_API_BASE</code> ìƒìˆ˜ì™€
                  ì¼ì¹˜í•´ì•¼ í•¨.  
                  <br />ì—¬ê¸°ëŠ” ë©”ëª¨/ì°¸ê³ ìš© ì…ë ¥ í•„ë“œ.
                </div>
              </div>
            </div>

            <p class="danger-text">
              â€» ì´ í˜ì´ì§€ëŠ” ìˆœìˆ˜ í”„ë¡ íŠ¸ì—”ë“œì´ê¸° ë•Œë¬¸ì—,
              <strong>ì‹œíŠ¸ ìˆ˜ì •/ì‚­ì œ ê°™ì€ ê¸°ëŠ¥ì€ í˜„ì¬ í¬í•¨ë˜ì–´ ìˆì§€ ì•ŠìŒ</strong>.  
              ìˆ˜ì •/ì‚­ì œëŠ” ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ìì²´ì—ì„œ í•˜ê±°ë‚˜,  
              ë‚˜ì¤‘ì— ë³„ë„ ë³´í˜¸ëœ ì›¹ì•±(ì¸ì¦ í¬í•¨)ì„ ë§Œë“  ë’¤ ì—°ê²°í•˜ëŠ” í¸ì´ ì•ˆì „í•¨.
            </p>
          </div>
        </section>
        <section class="admin-section" data-section="tools">
  <h2 class="admin-section-title">ë„êµ¬ Â· ì„¤ì •</h2>

  <div class="admin-card">
    <div class="admin-card-header">
      <h3 class="admin-card-title">í€´ì¦ˆ API í…ŒìŠ¤íŠ¸</h3>
      <p class="admin-card-desc">
        Apps Script ì›¹ì•± URLê³¼ íŒŒë¼ë¯¸í„°ë¥¼ ë„£ê³  ì‹¤ì œë¡œ ì–´ë–¤ JSONì´ ë‚˜ì˜¤ëŠ”ì§€ í™•ì¸í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.
      </p>
    </div>

    <form id="quiz-test-form" class="admin-form-grid">
      <label class="admin-field">
        <span class="admin-label">API URL</span>
        <input
          id="quiz-api-url"
          type="text"
          class="admin-input"
          value="https://script.google.com/macros/s/AKfycbwuvooqtlk6c_Nv2_VgforohP5twqTLWGu5j8uf56D3qvKsUnioAhfbkNdTKIsQaaQF/exec"
        />
      </label>

      <label class="admin-field">
        <span class="admin-label">limit</span>
        <input
          id="quiz-limit"
          type="number"
          class="admin-input"
          value="5"
          min="1"
          max="50"
        />
      </label>

      <label class="admin-field">
        <span class="admin-label">period</span>
        <input
          id="quiz-period"
          type="text"
          class="admin-input"
          placeholder="ì˜ˆ: í•œêµ­ì‚¬-í†µì‚¬"
        />
      </label>

      <label class="admin-field">
        <span class="admin-label">topic</span>
        <input
          id="quiz-topic"
          type="text"
          class="admin-input"
          placeholder="ì˜ˆ: ì‹œëŒ€ìˆœì„œ"
        />
      </label>

      <div class="admin-field admin-field-full">
        <button type="submit" class="admin-button primary">
          í…ŒìŠ¤íŠ¸ í˜¸ì¶œ
        </button>
      </div>
    </form>

    <pre id="quiz-test-result" class="admin-code-preview">
// ìœ„ì—ì„œ 'í…ŒìŠ¤íŠ¸ í˜¸ì¶œ'ì„ ëˆ„ë¥´ë©´
// ì—¬ê¸° JSON ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
    </pre>
  </div>
</section>
      </main>
    </div>
  </div>


  <!-- ê´€ë¦¬ì í˜ì´ì§€ ì „ìš© JS -->
  <script>
    /************************************************************
     * 1) ì—¬ê¸°ë§Œ ë„¤ ì›¹ì•± ì£¼ì†Œë¡œ ë°”ê¿”ì£¼ë©´ ë¨
     *    ì˜ˆ) const CHEESE_ADMIN_API_BASE = 'https://script.google.com/macros/s/XXXX/exec';
     ************************************************************/
    const CHEESE_ADMIN_API_BASE = 'https://script.google.com/macros/s/AKfycbwuvooqtlk6c_Nv2_VgforohP5twqTLWGu5j8uf56D3qvKsUnioAhfbkNdTKIsQaaQF/exec'; 

    // exam_sets ì‹œíŠ¸ì—ì„œ ë¶ˆëŸ¬ì˜¨ ì‹¤ì œ ë°ì´í„°ê°€ ë‹´ê¸¸ ë°°ì—´
    let examSets = [];

    // í˜¹ì‹œ ì‹¤íŒ¨í–ˆì„ ë•Œ ì“¸ ìƒ˜í”Œ ë°ì´í„°(ì§€ê¸ˆ í™”ë©´ì— ë³´ì´ëŠ” ë”ë¯¸ë‘ ê°™ìŒ)
    const fallbackExamSets = [
      {
        examKey: "khs-era-01",
        title: "í•œêµ­ì‚¬ ì‹œëŒ€ ìˆœì„œ ì—°ìŠµë¬¸ì œ â‘ ",
        period: "í•œêµ­ì‚¬-í†µì‚¬",
        topic: "ì‹œëŒ€ìˆœì„œ",
        limit: 5,
        sheetTab: "khs-era-01",
        updatedAt: "2025-12-05",
      },
      {
        examKey: "khs-era-02",
        title: "í•œêµ­ì‚¬ ì‹œëŒ€ ìˆœì„œ ì—°ìŠµë¬¸ì œ â‘¡",
        period: "í•œêµ­ì‚¬-í†µì‚¬",
        topic: "ì‹œëŒ€ìˆœì„œ",
        limit: 5,
        sheetTab: "khs-era-02",
        updatedAt: "2025-12-05",
      },
      {
        examKey: "jhs-era-01",
        title: "ì¼ë³¸ì‚¬ ì£¼ìš” ì‹œëŒ€ ìˆœì„œ",
        period: "ì¼ë³¸ì‚¬-í†µì‚¬",
        topic: "ì‹œëŒ€ìˆœì„œ",
        limit: 5,
        sheetTab: "jhs-era-01",
        updatedAt: "2025-12-04",
      },
    ];

    /************************************************************
     * 2) exam_sets ì‹œíŠ¸ì—ì„œ ì‹¤ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
     *    (Apps Script: ?mode=examSets ë¡œ JSON ë‚´ë ¤ì£¼ëŠ” ë¶€ë¶„ì´ë‘ ì—°ê²°)
     ************************************************************/
    async function loadExamSetsFromSheet() {
      if (!CHEESE_ADMIN_API_BASE) {
        console.warn('CHEESE_ADMIN_API_BASEê°€ ë¹„ì–´ ìˆì–´ì„œ ë”ë¯¸ ë°ì´í„°ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.');
        examSets = fallbackExamSets;
        renderDashboard();
        renderQuizTable();
        return;
      }

      try {
        const url = CHEESE_ADMIN_API_BASE + '?mode=examSets';
        const res = await fetch(url);
        const json = await res.json();

        // ë‚´ê°€ ì•ˆë‚´í–ˆë˜ í˜•íƒœ: { examSets: [...] } or ê·¸ëƒ¥ [...]
        if (Array.isArray(json.examSets)) {
          examSets = json.examSets;
        } else if (Array.isArray(json)) {
          examSets = json;
        } else {
          throw new Error('ì‘ë‹µ í˜•ì‹ì´ examSets ë°°ì—´ì´ ì•„ë‹˜');
        }

        // ì •ìƒì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìœ¼ë©´ í™”ë©´ ë Œë”
        renderDashboard();
        renderQuizTable();
      } catch (err) {
        console.error('exam_sets ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨, ë”ë¯¸ ë°ì´í„° ì‚¬ìš©', err);
        examSets = fallbackExamSets;
        renderDashboard();
        renderQuizTable();
      }
    }

    /***********************
     * ë„¤ë¹„ê²Œì´ì…˜ ì „í™˜
     ***********************/
    function showSection(name) {
      document
        .querySelectorAll(".admin-section")
        .forEach((sec) => {
          sec.classList.toggle("active", sec.dataset.section === name);
        });

      document
        .querySelectorAll(".admin-nav-button")
        .forEach((btn) => {
          btn.classList.toggle("active", btn.dataset.target === name);
        });
    }

    /***********************
     * ëŒ€ì‹œë³´ë“œ ë Œë”ë§
     ***********************/
    function renderDashboard() {
      const statsEl = document.getElementById("dashboard-stats");
      const recentTbody = document.querySelector(
        "#dashboard-recent-table tbody"
      );
      if (!statsEl || !recentTbody) return;

      const totalSets = examSets.length;
      const koreaSets = examSets.filter(
        (x) => String(x.period || '').indexOf("í•œêµ­ì‚¬") === 0
      ).length;

      statsEl.innerHTML = `
        <div class="dashboard-stat">
          <div class="dashboard-stat-label">ë“±ë¡ëœ examKey</div>
          <div class="dashboard-stat-value">${totalSets}ê°œ</div>
          <div class="dashboard-stat-note">ì‹œíŠ¸ ê¸°ì¤€ ì—°ìŠµë¬¸ì œ ì„¸íŠ¸ ìˆ˜</div>
        </div>
        <div class="dashboard-stat">
          <div class="dashboard-stat-label">í•œêµ­ì‚¬ ì„¸íŠ¸</div>
          <div class="dashboard-stat-value">${koreaSets}ê°œ</div>
          <div class="dashboard-stat-note">periodê°€ "í•œêµ­ì‚¬-"ë¡œ ì‹œì‘í•˜ëŠ” ì„¸íŠ¸</div>
        </div>
        <div class="dashboard-stat">
          <div class="dashboard-stat-label">ìƒ˜í”Œ í†µê³„</div>
          <div class="dashboard-stat-value">ì¤€ë¹„ ì¤‘</div>
          <div class="dashboard-stat-note">Apps Script ì—°ê²° í›„ ì‹¤ì œ í†µê³„ë¡œ êµì²´ ì˜ˆì •</div>
        </div>
      `;

      const recent = [...examSets]
        .sort((a, b) =>
          String(b.updatedAt || "").localeCompare(String(a.updatedAt || ""))
        )
        .slice(0, 5);

      recentTbody.innerHTML = recent
        .map(
          (row) => `
        <tr>
          <td><span class="badge-key">${row.examKey}</span></td>
          <td>${row.title || ""}</td>
          <td>${row.period || ""}</td>
          <td>${row.limit || ""}</td>
          <td>${row.updatedAt || "-"}</td>
        </tr>
      `
        )
        .join("");
    }

    /***********************
     * í€´ì¦ˆ ì„¸íŠ¸ í…Œì´ë¸” ë Œë”ë§
     ***********************/
    function renderQuizTable() {
      const tbody = document.querySelector("#quiz-table tbody");
      if (!tbody) return;

      const periodFilter = document.getElementById("filter-period").value;
      const searchKeyword = document
        .getElementById("filter-search")
        .value.trim()
        .toLowerCase();

      const filtered = examSets.filter((row) => {
        if (periodFilter && row.period !== periodFilter) return false;

        if (searchKeyword) {
          const target =
            (String(row.examKey || "") + " " + String(row.title || "")).toLowerCase();
          if (!target.includes(searchKeyword)) return false;
        }
        return true;
      });

      tbody.innerHTML = filtered
        .map(
          (row, idx) => `
        <tr data-exam-key="${row.examKey}" data-idx="${idx}">
          <td><span class="badge-key">${row.examKey}</span></td>
          <td>${row.title || ""}</td>
          <td>${row.period || ""}</td>
          <td>${row.limit || ""}</td>
          <td>${row.sheetTab || ""}</td>
          <td class="text-muted">í–‰ í´ë¦­ ì‹œ ì‚½ì… ì½”ë“œ ìƒì„±</td>
        </tr>
      `
        )
        .join("");
    }

    /***********************
     * ì„ íƒí•œ examKey â†’ ë¸”ë¡œê·¸ ì‚½ì…ìš© ì½”ë“œ
     ***********************/
    function updateSnippet(examKey) {
      const textArea = document.getElementById("snippet-output");
      if (!textArea) return;

      const set = examSets.find((x) => x.examKey === examKey);
      if (!set) {
        textArea.value = "";
        return;
      }

      const snippet = [
        '<div',
        '  class="cheese-quiz"',
        `  data-exam-key="${set.examKey}"`,
        '  data-source="sheet"',
        `  data-limit="${set.limit || 5}"`,
        set.period ? `  data-period="${set.period}"` : '',
        set.topic  ? `  data-topic="${set.topic}"`   : '',
        '>',
        `  <h3>${set.title || 'ì—°ìŠµë¬¸ì œ'}</h3>`,
        '  <ol class="cheese-quiz-list"></ol>',
        '  <div class="cheese-quiz-buttons">',
        '    <button type="button" class="cheese-quiz-check">ì±„ì í•˜ê¸°</button>',
        '    <button type="button" class="cheese-quiz-reset">ë‹¤ì‹œ í’€ê¸°</button>',
        '  </div>',
        '  <div class="cheese-quiz-result"></div>',
        '</div>',
      ]
        .filter(Boolean) // ë¹ˆ ì¤„ ì œê±°
        .join("\n");

      textArea.value = snippet;
    }

    /***********************
     * ì´ˆê¸°í™”
     ***********************/
    document.addEventListener("DOMContentLoaded", () => {
      // ë„¤ë¹„ ë²„íŠ¼
      document
        .querySelectorAll(".admin-nav-button")
        .forEach((btn) => {
          btn.addEventListener("click", () =>
            showSection(btn.dataset.target)
          );
        });

      // "í€´ì¦ˆ ì„¸íŠ¸ ê´€ë¦¬ë¡œ ì´ë™" ë²„íŠ¼
      document
        .querySelectorAll("[data-jump-nav]")
        .forEach((btn) => {
          btn.addEventListener("click", () => {
            const target = btn.getAttribute("data-target");
            if (target) showSection(target);
          });
        });

      // í•„í„° ì´ë²¤íŠ¸
      const periodSel = document.getElementById("filter-period");
      const searchInput = document.getElementById("filter-search");
      if (periodSel) {
        periodSel.addEventListener("change", renderQuizTable);
      }
      if (searchInput) {
        searchInput.addEventListener("input", renderQuizTable);
      }

      // í…Œì´ë¸” í–‰ í´ë¦­ â†’ ì½”ë“œ ìƒì„±
      const quizTable = document.getElementById("quiz-table");
      if (quizTable) {
        quizTable.addEventListener("click", (e) => {
          const tr = e.target.closest("tr[data-exam-key]");
          if (!tr) return;
          const key = tr.dataset.examKey;
          updateSnippet(key);
        });
      }

      // ì½”ë“œ ë³µì‚¬ ë²„íŠ¼
      const copyBtn = document.getElementById("btn-copy-snippet");
      if (copyBtn) {
        copyBtn.addEventListener("click", () => {
          const ta = document.getElementById("snippet-output");
          if (!ta || !ta.value.trim()) return;
          ta.select();
          document.execCommand("copy");
          copyBtn.textContent = "âœ… ë³µì‚¬ë¨";
          setTimeout(() => {
            copyBtn.textContent = "ğŸ“‹ ì½”ë“œ ë³µì‚¬";
          }, 1200);
        });
      }

      // ëŒ€ì‹œë³´ë“œ/í…Œì´ë¸” ì´ˆê¸° ë°ì´í„° ë¡œë“œ
      loadExamSetsFromSheet();
    });
  </script>

</body>
</html>
