<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ëŒ€ì‹œë³´ë“œ Â· Cheese Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./admin.css" />
  <style>
    :root{
      --bg:#f3f4f6; --card:#ffffff; --text:#0f172a; --sub:#475569;
      --line:rgba(15,23,42,0.10); --shadow:0 10px 28px rgba(15,23,42,0.10); --r:18px;
    }
    body{ margin:0; background:var(--bg); color:var(--text);
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif; }

    .dash-title{ margin:10px 0 14px; display:flex; align-items:flex-end; justify-content:space-between; gap:10px; flex-wrap:wrap; }
    .dash-title .t{ font-size:20px; font-weight:1000; letter-spacing:-0.02em; }
    .dash-title .s{ margin-top:4px; color:var(--sub); font-size:12px; font-weight:650; }
    .dash-pill{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; font-size:12px; font-weight:900;
      border:1px solid rgba(15,23,42,0.10); background:rgba(15,23,42,0.04); white-space:nowrap; }

    .dash-grid{ display:grid; grid-template-columns:1.2fr 0.8fr; gap:14px; align-items:start; }
    .dash-col{ display:grid; gap:14px; }

    .dash-card{ background:var(--card); border:1px solid var(--line); border-radius:var(--r); box-shadow:var(--shadow); overflow:hidden; }
    .dash-card-h{ padding:14px 14px 10px; display:flex; align-items:center; justify-content:space-between; gap:10px; border-bottom:1px solid rgba(15,23,42,0.06); }
    .dash-card-title{ font-weight:1000; letter-spacing:-0.02em; font-size:14px; display:flex; align-items:center; gap:8px; }
    .dash-card-sub a{ text-decoration:none; font-size:12px; font-weight:800; color:var(--sub); }
    .dash-card-b{ padding:12px 14px 14px; }

    .dash-list{ margin:0; padding:0; list-style:none; display:flex; flex-direction:column; gap:10px; }
    .dash-row{ display:flex; gap:10px; align-items:flex-start; justify-content:space-between; padding:10px 10px; border-radius:14px;
      border:1px solid rgba(15,23,42,0.08); background:rgba(2,6,23,0.02); }
    .dash-row-left{ min-width:0; display:flex; flex-direction:column; gap:4px; }
    .dash-row-title{ font-weight:1000; font-size:13px; letter-spacing:-0.01em; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; max-width:100%; }
    .dash-row-meta{ color:var(--sub); font-size:12px; font-weight:650; display:flex; gap:8px; flex-wrap:wrap; }

    .tag{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; font-size:12px; font-weight:900;
      border:1px solid rgba(15,23,42,0.10); background:rgba(15,23,42,0.04); white-space:nowrap; }
    .tag--warn{ background:rgba(245,158,11,0.12); border-color:rgba(245,158,11,0.28); }
    .tag--ok{ background:rgba(34,197,94,0.10); border-color:rgba(34,197,94,0.25); }
    .tag--bad{ background:rgba(239,68,68,0.10); border-color:rgba(239,68,68,0.25); }

    .muted{ color:var(--sub); font-size:12px; font-weight:650; }

    .todo-kpis{ display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:10px; }
    .kpi{ border:1px solid rgba(15,23,42,0.10); background:rgba(2,6,23,0.02); border-radius:16px; padding:12px 12px; }
    .kpi .v{ font-size:18px; font-weight:1000; letter-spacing:-0.02em; }
    .kpi .l{ margin-top:4px; font-size:12px; color:var(--sub); font-weight:800; }

    .filterbar{ display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px; }
    .chip{ border:1px solid rgba(15,23,42,0.12); background:#fff; border-radius:999px; padding:6px 10px; font-size:12px; font-weight:900; cursor:pointer; }
    .chip.is-on{ background:rgba(15,23,42,0.06); border-color:rgba(15,23,42,0.22); }

    .skeleton{ height:12px; border-radius:999px; background:rgba(15,23,42,0.08); overflow:hidden; position:relative; }
    .skeleton::after{ content:""; position:absolute; inset:0; transform:translateX(-60%);
      background:linear-gradient(90deg, transparent, rgba(255,255,255,0.55), transparent); animation:shimmer 1.2s infinite; }
    @keyframes shimmer{ 0%{transform:translateX(-60%);} 100%{transform:translateX(160%);} }

    @media (max-width:980px){ .dash-grid{ grid-template-columns:1fr; } }
    @media (max-width:520px){ .todo-kpis{ grid-template-columns:1fr; } }
  </style>
</head>

<body>
  <div class="admin-shell">
    <div id="admin-header-slot"></div>

    <div class="admin-main">
      <aside id="admin-menu-slot" class="admin-sidebar"></aside>

      <main>
        <div class="dash-title">
          <div>
            <div class="t">ëŒ€ì‹œë³´ë“œ</div>
            <div class="s">ê³µì§€ + ë‚´ í•  ì¼(ìŠ¹ì¸í•¨) + ìŠ¹ì¸/ë°˜ë ¤ ì—…ë°ì´íŠ¸</div>
          </div>
          <div class="dash-pill" id="nowPill">ë¡œë”©ì¤‘â€¦</div>
        </div>

        <section class="dash-grid">
          <div class="dash-col">
            <div class="dash-card">
              <div class="dash-card-h">
                <div class="dash-card-title">ğŸ“Œ ê³µì§€ì‚¬í•­</div>
                <div class="dash-card-sub"><a href="./board.html">ì „ì²´ë³´ê¸° â†’</a></div>
              </div>
              <div class="dash-card-b">
                <ul class="dash-list" id="noticeList">
                  <li class="dash-row"><div style="flex:1"><div class="skeleton"></div><div style="height:8px"></div><div class="skeleton" style="width:70%"></div></div></li>
                  <li class="dash-row"><div style="flex:1"><div class="skeleton" style="width:85%"></div><div style="height:8px"></div><div class="skeleton" style="width:55%"></div></div></li>
                </ul>
                <div class="muted" style="margin-top:10px;">* â€œí•„ë…/ì¤‘ìš”â€ë§Œ ìƒë‹¨ì— ë…¸ì¶œë˜ê²Œ ìš´ì˜í•˜ë©´ ìœ ì§€ê°€ í¸í•´.</div>
              </div>
            </div>

            <div class="dash-card">
              <div class="dash-card-h">
                <div class="dash-card-title">ğŸ•’ ê²°ì¬ ì—…ë°ì´íŠ¸(ìŠ¹ì¸/ë°˜ë ¤)</div>
                <div class="dash-card-sub"><a href="./logs.html">ë¡œê·¸ ë³´ê¸° â†’</a></div>
              </div>
              <div class="dash-card-b">
                <div class="filterbar">
                  <button class="chip is-on" data-log-filter="all" type="button">ì „ì²´</button>
                  <button class="chip" data-log-filter="approved" type="button">ìŠ¹ì¸</button>
                  <button class="chip" data-log-filter="rejected" type="button">ë°˜ë ¤</button>
                </div>

                <ul class="dash-list" id="approvalLogList">
                  <li class="dash-row"><div style="flex:1"><div class="skeleton" style="width:76%"></div><div style="height:8px"></div><div class="skeleton" style="width:60%"></div></div></li>
                  <li class="dash-row"><div style="flex:1"><div class="skeleton" style="width:88%"></div><div style="height:8px"></div><div class="skeleton" style="width:50%"></div></div></li>
                </ul>

                <div class="muted" style="margin-top:10px;">* â€œìŠ¹ì¸/ë°˜ë ¤â€ë§Œ ë³´ì—¬ì£¼ë©´ íŒ€ì´ ë³€ê²½ì ì„ í•œ ë²ˆì— íŒŒì•… ê°€ëŠ¥.</div>
              </div>
            </div>
          </div>

          <div class="dash-col">
            <div class="dash-card">
              <div class="dash-card-h">
                <div class="dash-card-title">âœ… ë‚´ í•  ì¼ / ìŠ¹ì¸í•¨</div>
                <div class="dash-card-sub"><a href="./inbox.html">ìŠ¹ì¸í•¨ ì—´ê¸° â†’</a></div>
              </div>
              <div class="dash-card-b">
                <div class="todo-kpis">
                  <div class="kpi"><div class="v" id="kpiPending">-</div><div class="l">ë‚´ ê²°ì¬ ëŒ€ê¸°</div></div>
                  <div class="kpi"><div class="v" id="kpiNeedAction">-</div><div class="l">ë‚´ê°€ ì²˜ë¦¬í•  í•­ëª©</div></div>
                </div>

                <div class="muted" style="margin-bottom:10px;">â€œë‚´ê°€ ì§€ê¸ˆ í•´ì•¼ í•  ê²ƒâ€ë§Œ ëª¨ì•„ ë³´ì—¬ì£¼ëŠ” ì˜ì—­</div>

                <ul class="dash-list" id="todoList">
                  <li class="dash-row"><div style="flex:1"><div class="skeleton"></div><div style="height:8px"></div><div class="skeleton" style="width:68%"></div></div></li>
                  <li class="dash-row"><div style="flex:1"><div class="skeleton" style="width:82%"></div><div style="height:8px"></div><div class="skeleton" style="width:58%"></div></div></li>
                </ul>

                <div class="muted" style="margin-top:10px;">ì˜ˆ: ë°˜ë ¤ ì¬ì œì¶œ / ì²¨ë¶€ ëˆ„ë½ ë³´ì™„ / ë‚´ ê²°ì¬ ëŒ€ê¸° ì²˜ë¦¬</div>
              </div>
            </div>

            <div class="dash-card">
              <div class="dash-card-h">
                <div class="dash-card-title">ğŸš¨ ìµœê·¼ ë°˜ë ¤(ë‚´ ìš”ì²­)</div>
                <div class="dash-card-sub"><a href="./my-requests.html?filter=rejected">ë‚´ ìš”ì²­ ë³´ê¸° â†’</a></div>
              </div>
              <div class="dash-card-b">
                <ul class="dash-list" id="myRejectedList">
                  <li class="muted">ë°˜ë ¤ëœ í•­ëª©ì´ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ â€œì—†ìŒâ€ í‘œì‹œ</li>
                </ul>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <script src="./admin-common.js"></script>
  <script>
    // ===== Utils =====
    function pad2(n){ return String(n).padStart(2,'0'); }
    function ymd(d){ return d.getFullYear()+'-'+pad2(d.getMonth()+1)+'-'+pad2(d.getDate()); }
    function hm(d){ return pad2(d.getHours())+':'+pad2(d.getMinutes()); }
    function escapeHtml(s){
      return String(s ?? '')
        .replaceAll('&','&amp;').replaceAll('<','&lt;')
        .replaceAll('>','&gt;').replaceAll('"','&quot;')
        .replaceAll("'","&#039;");
    }
    function setNow(){
      const now = new Date();
      document.getElementById('nowPill').textContent = ymd(now)+' '+hm(now);
    }

    // ===== Shell mount (header/menu) =====
    function tryCall(names, args){
      for(const n of names){
        const fn = window[n];
        if(typeof fn === 'function'){
          try{ fn(args); }catch(e){ console.warn('[shell]', n, e); }
          return;
        }
      }
    }
    function mountShell(){
      // header
      tryCall(['renderAdminHeader','mountAdminHeader'], {
        mountId: 'admin-header-slot',
        badgeText: 'dashboard',
        subtitle: 'ëŒ€ì‹œë³´ë“œ'
      });
      // menu (ìˆìœ¼ë©´)
      tryCall(['renderAdminMenu','renderAdminSidebar','mountAdminMenu'], {
        mountId: 'admin-menu-slot',
        active: 'dashboard'
      });
    }

    // ===== Renderers =====
    function renderNotices(items){
      const ul = document.getElementById('noticeList');
      ul.innerHTML = '';
      if(!items || !items.length){
        ul.innerHTML = '<li class="muted">ê³µì§€ ì—†ìŒ</li>';
        return;
      }
      items.slice(0,5).forEach(it=>{
        // (ì„œë²„í˜•/ë”ë¯¸í˜• ëª¨ë‘ ëŒ€ì‘)
        const title = it.title || '';
        const date = it.date || (it.updatedAt ? String(it.updatedAt).slice(0,10) : '');
        const author = it.author || it.authorEmpNo || '';
        const href = it.href || (it.noticeId ? ('./notice.html?id='+encodeURIComponent(it.noticeId)) : '');

        const level = (it.level || '').toLowerCase();
        const tag =
          level === 'danger' ? '<span class="tag tag--bad">í•„ë…</span>' :
          level === 'warn'   ? '<span class="tag tag--warn">ì¤‘ìš”</span>' :
                               '<span class="tag">ê³µì§€</span>';

        const li = document.createElement('li');
        li.className = 'dash-row';
        li.innerHTML = `
          <div class="dash-row-left">
            <div class="dash-row-title">${escapeHtml(title)}</div>
            <div class="dash-row-meta">
              <span>${escapeHtml(date)}</span>
              <span>${escapeHtml(author)}</span>
            </div>
          </div>
          <div>${tag}</div>
        `;
        if(href){
          li.style.cursor = 'pointer';
          li.addEventListener('click', ()=>location.href = href);
        }
        ul.appendChild(li);
      });
    }

    function renderTodo({pending=0, needAction=0, items=[]}){
      document.getElementById('kpiPending').textContent = String(pending);
      document.getElementById('kpiNeedAction').textContent = String(needAction);

      const ul = document.getElementById('todoList');
      ul.innerHTML = '';
      if(!items || !items.length){
        ul.innerHTML = '<li class="muted">ì§€ê¸ˆ ë‹¹ì¥ ì²˜ë¦¬í•  í•­ëª©ì´ ì—†ì–´ìš”.</li>';
        return;
      }

      items.slice(0,6).forEach(it=>{
        const tagHtml =
          it.kind === 'pending' ? '<span class="tag tag--warn">ëŒ€ê¸°</span>' :
          it.kind === 'rejected'? '<span class="tag tag--bad">ë°˜ë ¤</span>' :
                                  '<span class="tag">í™•ì¸</span>';

        const li = document.createElement('li');
        li.className = 'dash-row';
        li.innerHTML = `
          <div class="dash-row-left">
            <div class="dash-row-title">${escapeHtml(it.title)}</div>
            <div class="dash-row-meta">
              <span>${escapeHtml(it.type || '')}</span>
              <span>${escapeHtml(it.date || '')}</span>
              ${it.hint ? `<span>Â· ${escapeHtml(it.hint)}</span>` : ''}
            </div>
          </div>
          <div>${tagHtml}</div>
        `;
        if(it.href){
          li.style.cursor = 'pointer';
          li.addEventListener('click', ()=>location.href = it.href);
        }
        ul.appendChild(li);
      });
    }

    let __approvalLogs = [];
    let __logFilter = 'all';

    function renderApprovalLogs(items){
      __approvalLogs = Array.isArray(items) ? items : [];
      applyLogFilter();
    }

    function applyLogFilter(){
      const ul = document.getElementById('approvalLogList');
      ul.innerHTML = '';

      let filtered = __approvalLogs;
      if(__logFilter === 'approved') filtered = __approvalLogs.filter(x=>x.result==='approved');
      if(__logFilter === 'rejected') filtered = __approvalLogs.filter(x=>x.result==='rejected');

      if(!filtered.length){
        ul.innerHTML = '<li class="muted">í‘œì‹œí•  ë¡œê·¸ê°€ ì—†ì–´ìš”.</li>';
        return;
      }

      filtered.slice(0,10).forEach(it=>{
        const tag =
          it.result === 'approved' ? '<span class="tag tag--ok">ìŠ¹ì¸</span>' :
          it.result === 'rejected' ? '<span class="tag tag--bad">ë°˜ë ¤</span>' :
                                    '<span class="tag">ë³€ê²½</span>';

        const li = document.createElement('li');
        li.className = 'dash-row';
        li.innerHTML = `
          <div class="dash-row-left">
            <div class="dash-row-title">${escapeHtml(it.title)}</div>
            <div class="dash-row-meta">
              <span>${escapeHtml(it.type || '')}</span>
              <span>${escapeHtml(it.date || '')}</span>
              ${it.actor ? `<span>Â· ${escapeHtml(it.actor)}</span>` : ''}
            </div>
          </div>
          <div>${tag}</div>
        `;
        if(it.href){
          li.style.cursor = 'pointer';
          li.addEventListener('click', ()=>location.href = it.href);
        }
        ul.appendChild(li);
      });
    }

    function renderMyRejected(items){
      const ul = document.getElementById('myRejectedList');
      ul.innerHTML = '';

      if(!items || !items.length){
        ul.innerHTML = '<li class="muted">ìµœê·¼ ë°˜ë ¤ëœ ë‚´ ìš”ì²­ì´ ì—†ì–´ìš”.</li>';
        return;
      }

      items.slice(0,4).forEach(it=>{
        const li = document.createElement('li');
        li.className = 'dash-row';
        li.innerHTML = `
          <div class="dash-row-left">
            <div class="dash-row-title">${escapeHtml(it.title)}</div>
            <div class="dash-row-meta">
              <span>${escapeHtml(it.type || '')}</span>
              <span>${escapeHtml(it.date || '')}</span>
              ${it.reason ? `<span>Â· ${escapeHtml(it.reason)}</span>` : ''}
            </div>
          </div>
          <div><span class="tag tag--bad">ë°˜ë ¤</span></div>
        `;
        if(it.href){
          li.style.cursor = 'pointer';
          li.addEventListener('click', ()=>location.href = it.href);
        }
        ul.appendChild(li);
      });
    }

    // ===== Data (ë”ë¯¸) =====
    async function loadDashboard(){
      const notices = [
        { title:'[í•„ë…] 12ì›” ë§ˆê°: ì§€ì¶œ ì¦ë¹™ ì²¨ë¶€ ê¸°ì¤€', date:'2025-12-14', author:'CL25-0001', level:'danger', href:'./notice.html?id=NOTICE-0001' },
        { title:'ì˜ˆì‚°/ì§€ì¶œ ê²°ì¬ ì²˜ë¦¬ ì‹œê°„ ì•ˆë‚´', date:'2025-12-13', author:'CL25-0002', level:'warn', href:'./notice.html?id=NOTICE-0002' },
        { title:'ì¬ì§ì¦ëª…ì„œ ì–‘ì‹ ì—…ë°ì´íŠ¸ ê³µì§€', date:'2025-12-10', author:'CL25-0003', level:'ok', href:'./notice.html?id=NOTICE-0003' },
      ];

      const todo = {
        pending: 2, needAction: 3,
        items: [
          { kind:'pending', title:'[ì˜ˆì‚°] ë„ë©”ì¸/í˜¸ìŠ¤íŒ… ë¹„ìš© ìš”ì²­', type:'ì˜ˆì‚°ìš”ì²­', date:'2025-12-14', hint:'ê²°ì¬ ëŒ€ê¸°', href:'#' },
          { kind:'pending', title:'[ì§€ì¶œ] ì´ë¯¸ì§€ êµ¬ë§¤(ìë£Œ ì œì‘)', type:'ì§€ì¶œ', date:'2025-12-13', hint:'ê²°ì¬ ëŒ€ê¸°', href:'#' },
          { kind:'rejected', title:'[ì˜ˆì‚°] ì™¸ì£¼ ë””ìì¸ ë¹„ìš©', type:'ì˜ˆì‚°ìš”ì²­', date:'2025-12-12', hint:'ë³´ì™„ í›„ ì¬ì œì¶œ', href:'#' },
        ]
      };

      const approvalLogs = [
        { result:'approved', title:'[ì§€ì¶œ] ì´ë¯¸ì§€ êµ¬ë§¤ ìŠ¹ì¸ ì²˜ë¦¬', type:'ì§€ì¶œ', date:'2025-12-14 18:20', actor:'FIN', href:'#' },
        { result:'rejected', title:'[ì˜ˆì‚°] ì™¸ì£¼ ë””ìì¸ ë¹„ìš© ë°˜ë ¤', type:'ì˜ˆì‚°ìš”ì²­', date:'2025-12-12 20:02', actor:'ADMIN', href:'#' },
        { result:'approved', title:'[ì˜ˆì‚°] êµ¬ë… ì„œë¹„ìŠ¤ ë¹„ìš© ìŠ¹ì¸', type:'ì˜ˆì‚°ìš”ì²­', date:'2025-12-11 10:40', actor:'FIN', href:'#' },
      ];

      const myRejected = [
        { title:'[ì˜ˆì‚°] ì™¸ì£¼ ë””ìì¸ ë¹„ìš©', type:'ì˜ˆì‚°ìš”ì²­', date:'2025-12-12', reason:'ê²¬ì /ê·¼ê±° ìë£Œ ëˆ„ë½', href:'#' }
      ];

      renderNotices(notices);
      renderTodo(todo);
      renderApprovalLogs(approvalLogs);
      renderMyRejected(myRejected);
    }

    function wireLogFilter(){
      document.querySelectorAll('[data-log-filter]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          document.querySelectorAll('[data-log-filter]').forEach(x=>x.classList.remove('is-on'));
          btn.classList.add('is-on');
          __logFilter = btn.getAttribute('data-log-filter');
          applyLogFilter();
        });
      });
    }

    (function init(){
      setNow(); setInterval(setNow, 1000*30);
      mountShell();
      wireLogFilter();
      loadDashboard();
    })();
  </script>
</body>
</html>
