<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>í…ìŠ¤íŠ¸ E-Book ë·°ì–´ Â· Cheese Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <link rel="stylesheet" href="./admin.css" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> 

  <style>
    /* =========================================
       Lightweight Text E-Book Viewer Styles
    ========================================= */
    .dash-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }
    .dash-title .t { font-size: 1.5rem; font-weight: 800; color: var(--text-main); letter-spacing: -0.02em; line-height: 1.2; }
    .dash-title .s { font-size: 0.85rem; color: var(--text-sub); margin-top: 0.25rem; font-weight: 500; }
    
    .status-pill { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 8px; font-size: 0.8rem; font-weight: 600; background: #fff; border: 1px solid var(--border); color: var(--text-sub); }

    /* ë·°ì–´ ì „ì²´ ë ˆì´ì•„ì›ƒ */
    .ebook-layout { display: flex; flex-direction: column; height: calc(100vh - 160px); min-height: 500px; background: #fff; border-radius: 1rem; border: 1px solid var(--border); overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.02); }
    
    /* ìƒë‹¨ íˆ´ë°” */
    .ebook-toolbar { display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8fafc; border-bottom: 1px solid var(--border); flex-wrap: wrap; gap: 10px; }
    .toolbar-group { display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; }
    
    .tool-btn { padding: 0.5rem 0.8rem; border: 1px solid #cbd5e1; border-radius: 0.5rem; background: #fff; cursor: pointer; font-size: 0.85rem; font-weight: 600; color: #475569; transition: all 0.2s; display: inline-flex; align-items: center; gap: 4px; }
    .tool-btn:hover { background: #f1f5f9; }
    
    .file-upload-wrapper { position: relative; overflow: hidden; display: inline-block; }
    .file-upload-wrapper input[type=file] { font-size: 100px; position: absolute; left: 0; top: 0; opacity: 0; cursor: pointer; height: 100%; }

    .book-meta { font-size: 0.95rem; font-weight: 700; color: #0f172a; max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    /* ë·°ì–´ ë³¸ë¬¸ ì»¨í…Œì´ë„ˆ */
    .ebook-body { flex: 1; display: flex; position: relative; background: #fdfdfd; transition: background 0.3s; align-items: center; }
    
    .nav-btn { width: 50px; height: 100%; background: transparent; border: none; font-size: 2rem; color: #94a3b8; cursor: pointer; z-index: 10; touch-action: manipulation; display: flex; align-items: center; justify-content: center; transition: background 0.2s; }
    .nav-btn:hover { background: rgba(0,0,0,0.03); color: var(--primary, #3b82f6); }
    
    /* â­ í•µì‹¬: CSS ë‹¤ë‹¨ í¸ì§‘(Column) ì˜ì—­ â­ */
    .viewer-window {
        flex: 1;
        height: calc(100% - 40px);
        margin: 20px 0;
        overflow-x: hidden; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ìˆ¨ê¹€ (JSë¡œ ì œì–´) */
        overflow-y: hidden; /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ ê¸ˆì§€ (ë¬´ì¡°ê±´ ì˜†ìœ¼ë¡œ ë„˜ê¹€) */
        scroll-behavior: smooth; /* ë¶€ë“œëŸ¬ìš´ í˜ì´ì§€ ì „í™˜ */
        position: relative;
    }

    .viewer-content {
        height: 100%;
        box-sizing: border-box;
        /* í•µì‹¬ CSS: ì»¨í…Œì´ë„ˆ ë„ˆë¹„ë§Œí¼ 1ë‹¨ìœ¼ë¡œ ë‚˜ëˆ„ê¸° */
        column-width: 100%; 
        column-gap: 20px; /* í˜ì´ì§€ ì‚¬ì´ ê°„ê²© */
        column-fill: auto;
        
        /* í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ ê¸°ë³¸ê°’ */
        font-size: 16px;
        line-height: 1.8;
        color: #333;
        font-family: 'Gowun Batang', 'Noto Serif KR', serif; /* ëª…ì¡°ì²´ ëŠë‚Œ */
        padding-bottom: 10px;
    }

    /* ì œëª©ì´ë‚˜ ì´ë¯¸ì§€ê°€ í˜ì´ì§€ ì¤‘ê°„ì— ì˜ë¦¬ì§€ ì•Šê²Œ ë³´í˜¸ */
    .viewer-content h1, .viewer-content h2, .viewer-content h3, .viewer-content img {
        break-inside: avoid;
    }
    .viewer-content img { max-width: 100%; height: auto; border-radius: 8px; }

    /* í˜ì´ì§€ í‘œì‹œê¸° */
    .page-indicator { position: absolute; bottom: 10px; width: 100%; text-align: center; font-size: 0.8rem; color: #94a3b8; pointer-events: none; font-family: monospace; }

    /* ë‹¤í¬ ëª¨ë“œ */
    .ebook-body.dark-theme { background: #1e293b; }
    .ebook-body.dark-theme .viewer-content { color: #cbd5e1; }
    .ebook-body.dark-theme .nav-btn { color: #64748b; }

    /* ëª¨ë°”ì¼ ëŒ€ì‘ */
    @media (max-width: 768px) {
        .nav-btn { display: none; } /* ìŠ¤ì™€ì´í”„ë¡œ ëŒ€ì²´ */
        .ebook-layout { height: calc(100vh - 120px); border-radius: 0; border: none; }
        .viewer-window { margin: 10px 0; }
        .viewer-content { column-gap: 10px; font-size: 15px; } /* í°íŠ¸ ë° ê°„ê²© ì¶•ì†Œ */
    }
  </style>
  
  <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang&display=swap" rel="stylesheet">
</head>

<body>
  <div class="admin-shell">
    <div id="admin-header-slot"></div>
    <div class="admin-main">
      <aside id="admin-menu-slot" class="admin-sidebar"></aside>

      <main style="position: relative; padding: 1rem;">
        <header class="dash-header">
          <div class="dash-title">
            <h1 class="t">Cheese í…ìŠ¤íŠ¸ ë·°ì–´</h1>
            <p class="s">TXT ë° HTML íŒŒì¼ì„ ìë™ìœ¼ë¡œ í˜ì´ì§€ë¡œ ë‚˜ëˆ„ì–´ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
          </div>
          <div class="status-pill">
            <span style="display:inline-block; width:8px; height:8px; background:#10b981; border-radius:50%;"></span>
            <span id="nowPill">ì¤€ë¹„ ì™„ë£Œ</span>
          </div>
        </header>

        <section class="ebook-layout">
          <div class="ebook-toolbar">
            <div class="toolbar-group">
              <div class="file-upload-wrapper">
                <button class="tool-btn">ğŸ“‚ TXT / HTML ë¶ˆëŸ¬ì˜¤ê¸°</button>
                <input type="file" id="file-input" accept=".txt, .html, .htm" />
              </div>
              <div class="book-meta" id="meta-title">ìƒ˜í”Œ ë¬¸ì„œ ì½ëŠ” ì¤‘</div>
            </div>

            <div class="toolbar-group">
              <button class="tool-btn" id="btn-zoom-out">A-</button>
              <button class="tool-btn" id="btn-zoom-in">A+</button>
              <button class="tool-btn" id="btn-theme">ğŸŒ™ ëª¨ë“œ</button>
            </div>
          </div>

          <div class="ebook-body" id="ebook-body">
            <button class="nav-btn" id="prev-btn">â€¹</button>
            
            <div class="viewer-window" id="viewer-window">
                <div class="viewer-content" id="viewer-content">
                    <h2>í™˜ì˜í•©ë‹ˆë‹¤</h2>
                    <p>ì´ê³³ì€ ìˆœìˆ˜ CSS ë‹¤ë‹¨ í¸ì§‘(Column) ê¸°ëŠ¥ì„ í™œìš©í•˜ì—¬ ë§Œë“¤ì–´ì§„ ì´ˆê²½ëŸ‰ E-Book ë·°ì–´ì…ë‹ˆë‹¤.</p>
                    <p>ë¬´ê±°ìš´ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ì´ë„ í…ìŠ¤íŠ¸ê°€ í™”ë©´ ë†’ì´ì— ë§ì¶° ìë™ìœ¼ë¡œ ì˜ë¦¬ë©°, ë‹¤ìŒ í˜ì´ì§€ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.</p>
                    <br>
                    <h3>ì‚¬ìš© ë°©ë²•</h3>
                    <p>1. ì¢Œì¸¡ ìƒë‹¨ì˜ <b>[TXT / HTML ë¶ˆëŸ¬ì˜¤ê¸°]</b> ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¡œì»¬ PCì— ìˆëŠ” í…ìŠ¤íŠ¸ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.</p>
                    <p>2. ë‚´ìš©ì´ ê¸¸ì–´ì§€ë©´ ìë™ìœ¼ë¡œ í˜ì´ì§€ê°€ ìƒì„±ë©ë‹ˆë‹¤.</p>
                    <p>3. ë§ˆìš°ìŠ¤ íœ , ì¢Œìš° ë²„íŠ¼, í˜¹ì€ ëª¨ë°”ì¼ í™”ë©´ ìŠ¤ì™€ì´í”„ë¥¼ í†µí•´ ì±…ì¥ì„ ë„˜ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    <br><br><br><br><br><br><br><br><br><br><br><br> <h3>ë‘ ë²ˆì§¸ í˜ì´ì§€ì…ë‹ˆë‹¤.</h3>
                    <p>ì„±ê³µì ìœ¼ë¡œ í™”ë©´ì´ ë¶„í• ë˜ì—ˆìŠµë‹ˆë‹¤!</p>
                </div>
            </div>

            <button class="nav-btn" id="next-btn">â€º</button>

            <div class="page-indicator"><span id="current-page">1</span> / <span id="total-pages">1</span></div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <script src="./admin-common.js"></script>
  <script>
    // --- ì‹œìŠ¤í…œ ê³µí†µ ì„¤ì • ---
    function pad2(n){ return String(n).padStart(2,'0'); }
    function hm(d){ return pad2(d.getHours())+':'+pad2(d.getMinutes()); }
    function setNow(){ document.getElementById('nowPill').innerHTML = `ìµœê·¼ ë™ê¸°í™”: ${hm(new Date())}`; }
    function mountShell(){
      if(window.renderAdminHeader) window.renderAdminHeader({ mountId:'admin-header-slot', badgeText:'E-Book', subtitle:'í…ìŠ¤íŠ¸ ë·°ì–´' });
      if(window.renderAdminMenu) window.renderAdminMenu({ mountId:'admin-menu-slot', active:'ebook' });
    }

    // --- ë·°ì–´ ì œì–´ ë¡œì§ ---
    const viewerWindow = document.getElementById('viewer-window');
    const viewerContent = document.getElementById('viewer-content');
    
    let currentPage = 0;
    let totalPages = 1;
    let currentTheme = 'light';
    let currentFontSize = 16;
    
    // ëª¨ë°”ì¼ì— ë”°ë¥¸ ì—¬ë°±(gap) ì„¤ì • ë§ì¶¤
    function getColumnGap() {
        return window.innerWidth <= 768 ? 10 : 20;
    }

    // ì „ì²´ í˜ì´ì§€ ìˆ˜ ê³„ì‚°
    function calculatePages() {
        const gap = getColumnGap();
        // ë·°ì–´ì˜ ì „ì²´ ê°€ë¡œ ìŠ¤í¬ë¡¤ ê¸¸ì´ / (í™”ë©´ì— ë³´ì´ëŠ” ë„ˆë¹„ + ì—¬ë°±)
        const pageWidth = viewerWindow.clientWidth + gap;
        totalPages = Math.ceil((viewerContent.scrollWidth + gap) / pageWidth) || 1;
        
        // ê¸€ì í¬ê¸°ë¥¼ ë°”ê¾¸ê±°ë‚˜ ì°½ í¬ê¸°ë¥¼ ì¡°ì ˆí•  ë•Œ í˜„ì¬ í˜ì´ì§€ê°€ ì „ì²´ í˜ì´ì§€ë¥¼ ë„˜ì§€ ì•Šê²Œ ì¡°ì •
        if(currentPage >= totalPages) currentPage = totalPages - 1;
        
        updatePageIndicator();
        goToPage(currentPage); // ë ˆì´ì•„ì›ƒ ë³€ê²½ ì‹œ í˜„ì¬ í˜ì´ì§€ ìœ„ì¹˜ ë³´ì •
    }

    // í˜ì´ì§€ ì´ë™ í•¨ìˆ˜
    function goToPage(page) {
        if (page < 0) page = 0;
        if (page >= totalPages) page = totalPages - 1;
        
        currentPage = page;
        const gap = getColumnGap();
        const pageWidth = viewerWindow.clientWidth + gap;
        
        // CSS Columnì„ ì‚¬ìš©í•˜ë©´ ìŠ¤í¬ë¡¤ì„ ì´ë™ì‹œí‚¤ëŠ” ê²ƒìœ¼ë¡œ í˜ì´ì§€ë¥¼ ë„˜ê¹€
        viewerWindow.scrollLeft = currentPage * pageWidth;
        updatePageIndicator();
    }

    function updatePageIndicator() {
        document.getElementById('current-page').innerText = currentPage + 1;
        document.getElementById('total-pages').innerText = totalPages;
    }

    // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---

    // 1. ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼
    document.getElementById("prev-btn").addEventListener("click", () => goToPage(currentPage - 1));
    document.getElementById("next-btn").addEventListener("click", () => goToPage(currentPage + 1));

    // 2. í‚¤ë³´ë“œ ë°©í–¥í‚¤ ë° ë§ˆìš°ìŠ¤ íœ  ì§€ì›
    document.addEventListener("keyup", (e) => {
        if(e.key === "ArrowLeft") goToPage(currentPage - 1);
        if(e.key === "ArrowRight") goToPage(currentPage + 1);
    });

    // ê°€ë¡œ íœ  ìŠ¤í¬ë¡¤ ì§€ì› (í„°ì¹˜íŒ¨ë“œìš©)
    viewerWindow.addEventListener('wheel', (e) => {
        // ê¸°ë³¸ ì„¸ë¡œ ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ë¥¼ ê°€ë¡œ í˜ì´ì§€ ë„˜ê¹€ìœ¼ë¡œ ë³€í™˜
        if(Math.abs(e.deltaY) > 20 || Math.abs(e.deltaX) > 20) {
            e.preventDefault();
            if(e.deltaY > 0 || e.deltaX > 0) goToPage(currentPage + 1);
            else goToPage(currentPage - 1);
        }
    }, { passive: false });

    // 3. íŒŒì¼ ì—…ë¡œë“œ (.txt, .html)
    document.getElementById("file-input").addEventListener("change", function(e) {
        const file = e.target.files[0];
        if (!file) return;

        document.getElementById('meta-title').textContent = file.name;

        const reader = new FileReader();
        reader.onload = function(e) {
            const content = e.target.result;
            
            // HTML íŒŒì¼ì´ë©´ ê·¸ëŒ€ë¡œ ë„£ê³ , TXT íŒŒì¼ì´ë©´ ì¤„ë°”ê¿ˆì„ <br>ë¡œ ë³€í™˜
            if(file.name.toLowerCase().endsWith('.html') || file.name.toLowerCase().endsWith('.htm')) {
                viewerContent.innerHTML = content;
            } else {
                // í…ìŠ¤íŠ¸ëŠ” <p> íƒœê·¸ë¡œ ê°ì‹¸ì„œ ì˜ˆì˜ê²Œ ì¶œë ¥
                const formattedText = content.split('\n').map(line => `<p>${line}</p>`).join('');
                viewerContent.innerHTML = formattedText;
            }
            
            // ë‚´ìš©ì´ ë°”ë€Œì—ˆìœ¼ë¯€ë¡œ í˜ì´ì§€ ì¬ê³„ì‚°
            setTimeout(() => {
                currentPage = 0;
                calculatePages();
            }, 100);
        };
        reader.readAsText(file);
    });

    // 4. ëª¨ë°”ì¼ í„°ì¹˜ ìŠ¤ì™€ì´í”„ ì§€ì›
    let touchStartX = 0;
    let touchEndX = 0;
    
    viewerWindow.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; }, {passive: true});
    viewerWindow.addEventListener('touchend', e => {
        touchEndX = e.changedTouches[0].screenX;
        if (touchStartX - touchEndX > 50) goToPage(currentPage + 1); // ì™¼ìª½ìœ¼ë¡œ ë°€ê¸° (ë‹¤ìŒì¥)
        if (touchEndX - touchStartX > 50) goToPage(currentPage - 1); // ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë°€ê¸° (ì´ì „ì¥)
    }, {passive: true});

    // 5. ê¸€ì í¬ê¸° ì¡°ì ˆ ë° í…Œë§ˆ (í˜ì´ì§€ ì¬ê³„ì‚° í•„ìˆ˜)
    document.getElementById("btn-zoom-in").addEventListener("click", () => {
        currentFontSize += 2;
        viewerContent.style.fontSize = `${currentFontSize}px`;
        setTimeout(calculatePages, 50); // ê¸€ì í¬ê¸°ê°€ ë³€í•˜ë©´ í˜ì´ì§€ ìˆ˜ë„ ë³€í•¨
    });

    document.getElementById("btn-zoom-out").addEventListener("click", () => {
        currentFontSize = Math.max(12, currentFontSize - 2);
        viewerContent.style.fontSize = `${currentFontSize}px`;
        setTimeout(calculatePages, 50);
    });

    document.getElementById("btn-theme").addEventListener("click", function() {
        const bodyEl = document.getElementById("ebook-body");
        if (currentTheme === 'light') {
            currentTheme = 'dark';
            this.innerHTML = 'â˜€ï¸ ëª¨ë“œ';
            bodyEl.classList.add('dark-theme');
        } else {
            currentTheme = 'light';
            this.innerHTML = 'ğŸŒ™ ëª¨ë“œ';
            bodyEl.classList.remove('dark-theme');
        }
    });

    // ì°½ í¬ê¸°ê°€ ì¡°ì ˆë  ë•Œ (ëª¨ë°”ì¼ ê°€ë¡œ/ì„¸ë¡œ ì „í™˜ ë“±) í˜ì´ì§€ ìˆ˜ ë‹¤ì‹œ ê³„ì‚°
    window.addEventListener('resize', () => {
        clearTimeout(window.resizeTimer);
        window.resizeTimer = setTimeout(calculatePages, 200);
    });

    // --- ì´ˆê¸° ì‹¤í–‰ ---
    (function init(){
      setNow(); 
      setInterval(setNow, 1000*60);
      mountShell();
      
      // í°íŠ¸ ë¡œë”© ì‹œê°„ì„ ê³ ë ¤í•´ ì•½ê°„ ì§€ì—° í›„ ìµœì´ˆ í˜ì´ì§€ ê³„ì‚°
      setTimeout(calculatePages, 300);
    })();
  </script>
</body>
</html>
