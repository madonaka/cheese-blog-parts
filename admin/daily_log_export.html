<!-- ✅ daily_log_export.html (필요 부분만 교체/추가) -->
<div class="form-row">
  <label>연도</label>
  <input id="year" type="number" value="2026" style="width:100px">

  <label style="margin-left:12px">월</label>
  <input id="month" type="number" value="1" style="width:80px">

  <!-- ✅ 추가: 일별 -->
  <label style="margin-left:12px">일</label>
  <input id="day" type="text" placeholder="YYYY-MM-DD" style="width:140px">

  <!-- ✅ 추가: id -->
  <label style="margin-left:12px">id</label>
  <input id="ids" type="text" placeholder="EVT001,EVT002" style="width:180px">

  <button id="btnGenerate" class="btn primary" style="margin-left:12px">
    HTML 생성
  </button>

  <button id="btnCopy" class="btn" style="margin-left:8px">
    복사
  </button>
</div>

<script>
  // ✅ 너의 웹앱 URL로 바꿔 넣기
  const API_BASE = "https://script.google.com/macros/s/AKfycbyuC0qHyRdDKL2fC5fmRy66l0y1baCLbXuf9pNlPh0rBde_HQMzaqQv5NK06H_n7WFk/exec";

  document.getElementById("btnGenerate").addEventListener("click", generate);
  document.getElementById("btnCopy").addEventListener("click", copyOutput);

  async function generate() {
    const year  = String(document.getElementById("year").value || "").trim();
    const month = String(document.getElementById("month").value || "").trim();
    const day   = String(document.getElementById("day").value || "").trim();
    const ids   = String(document.getElementById("ids").value || "").trim();

    // 월 추출(기존): year+month 필요
    // 일 추출: day만 있으면 됨
    if (!day && (!year || !month)) {
      alert("월 추출은 연도/월이 필요하고, 일별 추출은 day(YYYY-MM-DD)가 필요합니다.");
      return;
    }

    const params = new URLSearchParams();
    params.set("mode", "exportDailyLog");

    if (day) params.set("day", day);
    else {
      params.set("year", year);
      params.set("month", month);
    }

    if (ids) params.set("id", ids);

    const url = `${API_BASE}?${params.toString()}`;

    try {
      document.getElementById("output").value = "생성 중...";

      const res = await fetch(url, { method: "GET" });
      if (!res.ok) throw new Error("API 호출 실패 (HTTP " + res.status + ")");

      const text = await res.text();

      // 혹시 HTML 화면이 그대로 내려오는 경우 감지
      if (text && /<!doctype html|<html/i.test(text)) {
        throw new Error("API가 HTML 화면을 반환했습니다. (doGet(e) 분기/배포 확인 필요)");
      }

      document.getElementById("output").value = text || "<!-- empty -->";
    } catch (e) {
      document.getElementById("output").value = "";
      alert("HTML 생성 실패: " + e.message);
    }
  }

  async function copyOutput() {
    const ta = document.getElementById("output");
    const val = ta.value || "";
    if (!val.trim()) {
      alert("복사할 내용이 없습니다.");
      return;
    }
    try {
      await navigator.clipboard.writeText(val);
      alert("복사 완료");
    } catch (e) {
      ta.focus();
      ta.select();
      document.execCommand("copy");
      alert("복사 완료");
    }
  }
</script>
