<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë¬¸ì„œ ì•„ì¹´ì´ë¸Œ - Cheese Lab</title>
  
  <link rel="stylesheet" href="./admin.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>

  <script>
    // âœ… ì„œë²„ API ì£¼ì†Œ
    window.CHEESE_ADMIN_API_BASE = "https://script.google.com/macros/s/AKfycbwn1TrLeSIAe570LRWMJxRzx88u3LQYF38Kme9WhMd-YQsrMsSggrNy3I_2SGKGXTpS/exec";
    
    // ğŸš¨ í•„ìˆ˜ ì„¤ì •: ìƒì„±ëœ ë¬¸ì„œ(íŒŒì¼)ê°€ ì €ì¥ë  êµ¬ê¸€ ë“œë¼ì´ë¸Œ í´ë” ID
    const ARCHIVE_FOLDER_ID = "1MpTCfw8B1Y-77QFr4k5SCPfVQgso8fKi"; 
  </script>
  <script src="./admin-common.js" defer></script>

  <style>
    /* --- ì•„ì¹´ì´ë¸Œ ì „ìš© ë””ìì¸ --- */
    .archive-header {
      display: flex; justify-content: space-between; align-items: flex-end;
      margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #e2e8f0;
    }
    .archive-title h2 { margin: 0 0 8px 0; font-size: 1.5rem; color: #1e293b; font-weight: 800; }
    .archive-title p { margin: 0; color: #64748b; font-size: 0.95rem; }
    
    .report-generator-group {
      display: flex; gap: 10px; background: #f8fafc; padding: 10px; border-radius: 12px; border: 1px solid #e2e8f0;
    }
    .btn-gen {
      background: #fff; color: #3b82f6; border: 1px solid #bfdbfe; font-weight: 700; padding: 8px 16px;
      border-radius: 8px; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 6px;
    }
    .btn-gen:hover { background: #eff6ff; border-color: #3b82f6; transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(59,130,246,0.1); }
    .btn-new { background: #3b82f6; color: white; border: none; }
    .btn-new:hover { background: #2563eb; }

    /* ë¬¸ì„œ ê·¸ë¦¬ë“œ ë·° */
    .doc-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
    .doc-card {
      background: #fff; border: 1px solid #e2e8f0; border-radius: 12px; padding: 20px;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); transition: 0.2s; position: relative; cursor: pointer;
      display: flex; flex-direction: column; height: 220px;
    }
    .doc-card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); border-color: #cbd5e1; }
    .doc-type-badge {
      position: absolute; top: 20px; right: 20px; background: #f1f5f9; color: #475569; font-size: 0.75rem;
      padding: 4px 8px; border-radius: 4px; font-weight: 700;
    }
    .doc-card-title { font-size: 1.15rem; font-weight: 800; color: #1e293b; margin: 0 0 10px 0; padding-right: 50px; line-height: 1.4; }
    .doc-card-date { font-size: 0.8rem; color: #94a3b8; margin-bottom: 12px; }
    
    .doc-card-actions { margin-top: auto; display: flex; justify-content: flex-end; gap: 8px; border-top: 1px solid #f1f5f9; padding-top: 12px; }
    
    /* ì—ë””í„° ëª¨ë‹¬ (ë„“ê²Œ ì¾Œì í•˜ê²Œ) */
    .modal-box.large-modal { max-width: 900px; height: 90vh; display: flex; flex-direction: column; }
    .note-editor.note-frame { border-color: #e2e8f0; border-radius: 8px; overflow: hidden; }
  </style>
</head>
<body>

<div class="admin-container">
  <div id="header-slot"></div>
  <div class="admin-main">
    <div id="menu-slot"></div>
    <div class="content-area">
      <div class="content-header"></div>
      
      <div class="archive-header">
        <div class="archive-title">
          <h2>ğŸ“‚ ë³´ê³ ì„œ & ê¸°íšì„œ ì•„ì¹´ì´ë¸Œ</h2>
          <p>ë‚´ìš©ì€ ë“œë¼ì´ë¸Œ íŒŒì¼ë¡œ ì•ˆì „í•˜ê²Œ, ê´€ë¦¬ëŠ” ê°€ë³ê²Œ!</p>
        </div>
        <div class="report-generator-group">
          <button class="btn-gen" onclick="generateAutoReport('daily')">ğŸ“ ì¼ì¼ ë³´ê³ ì„œ</button>
          <button class="btn-gen" onclick="generateAutoReport('weekly')">ğŸ“Š ì£¼ê°„ ë³´ê³ ì„œ</button>
          <button class="btn-gen" onclick="generateAutoReport('monthly')">ğŸ“… ì›”ê°„ ë³´ê³ ì„œ</button>
          <div style="width:1px; background:#e2e8f0; margin: 0 4px;"></div>
          <button class="btn-gen btn-new" onclick="openDocModal()">+ ë¹ˆ ë¬¸ì„œ ì‘ì„±</button>
        </div>
      </div>

      <div class="doc-grid" id="doc-grid">
        <div style="grid-column: 1 / -1; text-align: center; padding: 60px 0; color: #94a3b8;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
      </div>
    </div>
  </div>
</div>

<div id="doc-modal" class="custom-modal">
  <div class="modal-box large-modal">
    <div class="modal-header-custom">
      <span class="modal-title-custom" id="doc-modal-title">ìƒˆ ë¬¸ì„œ ì‘ì„±</span>
    </div>
    
    <form id="doc-form" style="display: flex; flex-direction: column; flex: 1; overflow: hidden; margin:0;">
      <div class="modal-body-custom" style="flex: 1; overflow-y: auto; padding-bottom: 20px;">
        <input type="hidden" id="doc-id" value="">
        <input type="hidden" id="doc-drive-id" value="">
        
        <div class="field" style="display:flex; gap:12px; margin-bottom:16px;">
          <div style="flex: 1;">
            <label class="input-label">ë¬¸ì„œ ì œëª©</label>
            <input type="text" id="doc-title" class="styled-input" placeholder="ë³´ê³ ì„œ ë˜ëŠ” ê¸°íšì„œ ì œëª©" required style="font-size:1.1rem; font-weight:700;">
          </div>
          <div style="width: 150px;">
            <label class="input-label">ë¬¸ì„œ ìœ í˜•</label>
            <select id="doc-type" class="styled-input">
              <option value="ë³´ê³ ì„œ">ğŸ“Š ë³´ê³ ì„œ</option>
              <option value="ê¸°íšì„œ">ğŸ’¡ ê¸°íšì„œ</option>
            </select>
          </div>
        </div>

        <div class="field" style="flex: 1; display:flex; flex-direction:column;">
          <label class="input-label">ë³¸ë¬¸ ë‚´ìš©</label>
          <textarea id="doc-content" required></textarea>
        </div>
      </div>
      
      <div class="modal-footer-custom" style="justify-content: flex-end; padding-top: 16px;">
        <button type="button" class="btn-close-custom" onclick="closeModal('doc-modal')">ì·¨ì†Œ</button>
        <button type="submit" class="btn-save-custom" id="btn-save-doc" style="background:#3b82f6;">ğŸ’¾ ë“œë¼ì´ë¸Œì— ì €ì¥</button>
      </div>
    </form>
  </div>
</div>

<script>
  let g_docs = [];
  let g_logs = [];
  let g_goals = [];
  let g_tasks = [];

  // ==========================================
  // 1. ì´ˆê¸°í™” ë° ë°ì´í„° ë¡œë“œ
  // ==========================================
  $(document).ready(async function() {
    await loadHeaderMenu();
    $('#doc-content').summernote({
      height: 450, lang: 'ko-KR',
      toolbar: [
        ['style', ['style']], ['font', ['bold', 'underline', 'clear']],
        ['color', ['color']], ['para', ['ul', 'ol', 'paragraph']],
        ['table', ['table']], ['insert', ['link']], ['view', ['codeview']]
      ]
    });
    loadAllData();
  });

  async function loadAllData() {
    if(typeof showAdminLoading==='function') showAdminLoading("ë¬¸ì„œ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...");
    try {
      const res = await fetch(window.CHEESE_ADMIN_API_BASE + "?mode=getAllData");
      const json = await res.json();
      if(json.result === "success") {
        g_logs = json.logs || []; g_goals = json.goals || []; g_tasks = json.tasks || [];
        g_docs = g_tasks.filter(t => t['ìœ í˜•'] === 'ë³´ê³ ì„œ' || t['ìœ í˜•'] === 'ê¸°íšì„œ');
        g_docs.sort((a, b) => b.ID.localeCompare(a.ID));
        renderDocs();
      }
    } catch(e) { console.error(e); }
    finally { if(typeof hideAdminLoading==='function') hideAdminLoading(); }
  }

  // ==========================================
  // 2. ì•„ì¹´ì´ë¸Œ ë Œë”ë§ (ê·¸ë¦¬ë“œ)
  // ==========================================
  function renderDocs() {
    const root = document.getElementById('doc-grid');
    root.innerHTML = "";
    
    if(g_docs.length === 0) {
        root.innerHTML = `<div style="grid-column: 1/-1; text-align:center; padding: 60px; color:#94a3b8; background:#f8fafc; border-radius:12px; border:2px dashed #cbd5e1;">ë³´ê´€ëœ ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
        return;
    }

    g_docs.forEach(doc => {
      const card = document.createElement('div'); card.className = "doc-card";
      const isReport = doc['ìœ í˜•'] === 'ë³´ê³ ì„œ';
      const badgeColor = isReport ? '#eff6ff' : '#f0fdf4';
      const textColor = isReport ? '#2563eb' : '#16a34a';
      const rawDate = doc['ê¸°í•œ'] ? doc['ê¸°í•œ'].split('T')[0] : 'ë‚ ì§œ ì—†ìŒ';

      // ğŸš€ ë“œë¼ì´ë¸Œì— ì €ì¥ëœ ë¬¸ì„œì¸ì§€ ì²´í¬ (ìƒì„¸ë‚´ìš©ì— DRIVE:ID í˜•ì‹ìœ¼ë¡œ ì €ì¥ë¨)
      let previewHtml = "";
      if (doc['ìƒì„¸ë‚´ìš©'] && doc['ìƒì„¸ë‚´ìš©'].startsWith("DRIVE:")) {
          previewHtml = `
            <div style="flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center;">
              <div style="background:#eff6ff; color:#3b82f6; padding:8px 16px; border-radius:8px; font-weight:bold; font-size:0.9rem;">
                â˜ï¸ ë“œë¼ì´ë¸Œ íŒŒì¼ ì—°ê²°ë¨
              </div>
            </div>`;
      } else {
          previewHtml = `<div style="color:#ef4444; font-size:0.85rem; padding:10px;">(êµ¬í˜• ë°ì´í„° í˜•ì‹ì…ë‹ˆë‹¤)</div>`;
      }

      card.innerHTML = `
        <div class="doc-type-badge" style="background:${badgeColor}; color:${textColor};">${doc['ìœ í˜•']}</div>
        <h3 class="doc-card-title">${doc['ì œëª©'] || '(ì œëª© ì—†ìŒ)'}</h3>
        <div class="doc-card-date">ğŸ—“ ìµœì¢… ìˆ˜ì •: ${rawDate}</div>
        ${previewHtml}
        <div class="doc-card-actions">
           <button class="btn" style="background:#f1f5f9; color:#475569; border:none; padding:6px 12px; border-radius:6px; cursor:pointer;" onclick="openDocModal('${doc.ID}'); event.stopPropagation();">ğŸ“ ì—´ê¸° / ìˆ˜ì •</button>
           <button class="btn" style="background:#fee2e2; color:#ef4444; border:none; padding:6px 12px; border-radius:6px; cursor:pointer;" onclick="deleteDoc('${doc.ID}'); event.stopPropagation();">ğŸ—‘ï¸</button>
        </div>
      `;
      card.onclick = () => openDocModal(doc.ID);
      root.appendChild(card);
    });
  }

  // ==========================================
  // 3. ëª¨ë‹¬ ì œì–´ (ë“œë¼ì´ë¸Œì—ì„œ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°)
  // ==========================================
  async function openDocModal(docId = null, defaultTitle = "", defaultHtml = "", defaultType = "ë³´ê³ ì„œ") {
    const modal = document.getElementById('doc-modal');
    modal.classList.add('open');
    document.getElementById('doc-form').reset();
    document.getElementById('doc-drive-id').value = ""; // ë“œë¼ì´ë¸Œ ID ì´ˆê¸°í™”
    $('#doc-content').summernote('code', '');

    if (docId) {
        const doc = g_docs.find(d => d.ID === docId);
        if (doc) {
            document.getElementById('doc-modal-title').textContent = "ë¬¸ì„œ ìˆ˜ì •";
            document.getElementById('doc-id').value = doc.ID;
            document.getElementById('doc-title').value = doc['ì œëª©'];
            document.getElementById('doc-type').value = doc['ìœ í˜•'];
            
            // ğŸš€ DBì— ì €ì¥ëœ ê°’ì´ DRIVE íŒŒì¼ IDì¼ ê²½ìš° ì„œë²„ì—ì„œ ë‚´ìš© ê¸ì–´ì˜¤ê¸°
            if (doc['ìƒì„¸ë‚´ìš©'] && doc['ìƒì„¸ë‚´ìš©'].startsWith("DRIVE:")) {
                const fileId = doc['ìƒì„¸ë‚´ìš©'].split("DRIVE:")[1];
                document.getElementById('doc-drive-id').value = fileId;
                
                if(typeof showAdminLoading==='function') showAdminLoading("ë“œë¼ì´ë¸Œì—ì„œ ì›ë³¸ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì¤‘...");
                try {
                    const res = await fetch(window.CHEESE_ADMIN_API_BASE, { method: "POST", body: JSON.stringify({ mode: "getReportContent", fileId: fileId }) });
                    const json = await res.json();
                    if(json.result === "success") $('#doc-content').summernote('code', json.content);
                    else throw new Error("íŒŒì¼ ì½ê¸° ì‹¤íŒ¨");
                } catch(e) {
                    alert("ë¬¸ì„œ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜: íŒŒì¼ì´ ì‚­ì œë˜ì—ˆê±°ë‚˜ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
                } finally {
                    if(typeof hideAdminLoading==='function') hideAdminLoading();
                }
            } else {
                $('#doc-content').summernote('code', doc['ìƒì„¸ë‚´ìš©'] || "");
            }
        }
    } else {
        document.getElementById('doc-modal-title').textContent = "ìƒˆ ë¬¸ì„œ ì‘ì„±";
        document.getElementById('doc-id').value = "";
        document.getElementById('doc-title').value = defaultTitle;
        document.getElementById('doc-type').value = defaultType;
        if(defaultHtml) $('#doc-content').summernote('code', defaultHtml);
    }
  }

  // ==========================================
  // 4. ì €ì¥ (1:ë“œë¼ì´ë¸Œ íŒŒì¼ ìƒì„± -> 2:DBì—ëŠ” IDë§Œ ê¸°ë¡)
  // ==========================================
  document.getElementById('doc-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const btn = document.getElementById('btn-save-doc');
    const originalText = btn.textContent;
    btn.textContent = "ì²˜ë¦¬ ì¤‘..."; btn.disabled = true;

    try {
        const docId = document.getElementById('doc-id').value;
        const title = document.getElementById('doc-title').value;
        const type = document.getElementById('doc-type').value;
        const contentHtml = $('#doc-content').summernote('code');
        const driveId = document.getElementById('doc-drive-id').value;
        const now = new Date().toISOString().split('T')[0];

        // ğŸš€ STEP 1: ë“œë¼ì´ë¸Œì— HTML íŒŒì¼ ì—…ë¡œë“œ
        if(typeof showAdminLoading==='function') showAdminLoading("êµ¬ê¸€ ë“œë¼ì´ë¸Œì— íŒŒì¼ ìƒì„± ì¤‘...");
        let savedFileId = driveId;
        
        const drivePayload = {
            mode: "uploadReportContent",
            folderId: ARCHIVE_FOLDER_ID,
            fileId: driveId,
            title: title,
            content: contentHtml
        };
        const driveRes = await fetch(window.CHEESE_ADMIN_API_BASE, { method: "POST", body: JSON.stringify(drivePayload) });
        const driveJson = await driveRes.json();
        
        if (driveJson.result === "success") {
            savedFileId = driveJson.fileId;
        } else {
            throw new Error("ë“œë¼ì´ë¸Œ ì—…ë¡œë“œ ì‹¤íŒ¨");
        }

        // ğŸš€ STEP 2: DBì—ëŠ” ë“œë¼ì´ë¸Œ IDë§Œ ê°€ë³ê²Œ ì €ì¥
        if(typeof showAdminLoading==='function') showAdminLoading("ë°ì´í„°ë² ì´ìŠ¤ ë©”íƒ€ë°ì´í„° ê¸°ë¡ ì¤‘...");
        const dbPayload = {
            mode: docId ? "editItem" : "addItem",
            id: docId,
            type: type,
            title: title,
            detail: "DRIVE:" + savedFileId, // ë³¸ë¬¸ ëŒ€ì‹  "DRIVE:íŒŒì¼ID" í˜•íƒœ ì €ì¥
            priority: "ë³´í†µ",
            dueDate: now, 
            connectedId: "",
            color: ""
        };
        
        const dbRes = await fetch(window.CHEESE_ADMIN_API_BASE, { method: "POST", body: JSON.stringify(dbPayload) });
        const dbJson = await dbRes.json();
        
        if(dbJson.result === "success") {
            closeModal('doc-modal');
            await loadAllData(); 
        } else {
            alert("DB ì €ì¥ ì‹¤íŒ¨: " + dbJson.msg);
        }
    } catch(err) {
        console.error(err); alert("ì˜¤ë¥˜ ë°œìƒ: " + err.message);
    } finally {
        btn.textContent = originalText; btn.disabled = false;
        if(typeof hideAdminLoading==='function') hideAdminLoading();
    }
  });

  // ==========================================
  // 5. ìë™ ë³´ê³ ì„œ ìƒì„± ë¡œì§ (ê¸°ì¡´ê³¼ ë™ì¼)
  // ==========================================
  function generateAutoReport(rangeType) {
    const today = new Date(); today.setHours(23,59,59,999);
    let startDate = new Date(); startDate.setHours(0,0,0,0);
    let titlePrefix = "";

    if (rangeType === 'daily') {
        titlePrefix = `[ì¼ì¼ ë³´ê³ ì„œ] ${today.getFullYear()}ë…„ ${today.getMonth()+1}ì›” ${today.getDate()}ì¼`;
    } else if (rangeType === 'weekly') {
        const day = startDate.getDay() || 7; startDate.setDate(startDate.getDate() - day + 1);
        titlePrefix = `[ì£¼ê°„ ë³´ê³ ì„œ] ${today.getMonth()+1}ì›” ${Math.ceil(today.getDate()/7)}ì£¼ì°¨`;
    } else if (rangeType === 'monthly') {
        startDate.setDate(1); 
        titlePrefix = `[ì›”ê°„ ë³´ê³ ì„œ] ${today.getFullYear()}ë…„ ${today.getMonth()+1}ì›” ê²°ì‚°`;
    }

    const targetLogs = g_logs.filter(log => {
        if (!log['ë‚ ì§œ']) return false;
        const d = new Date(log['ë‚ ì§œ']); return d >= startDate && d <= today;
    });

    if (targetLogs.length === 0) { alert("ì„ íƒí•˜ì‹  ê¸°ê°„ ë‚´ì— ì‘ì„±ëœ ì‘ì—… ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤."); return; }

    const grouped = {}; let totalLogs = 0;
    targetLogs.forEach(log => {
        const goalId = log['ê´€ë ¨_ëª©í‘œID'] || 'ê¸°íƒ€ ì—…ë¬´';
        if (!grouped[goalId]) grouped[goalId] = [];
        grouped[goalId].push(log); totalLogs++;
    });

    let htmlStr = `
        <div style="font-family: sans-serif; color: #333; max-width:800px; margin:0 auto; padding:20px;">
            <h2 style="color: #2563eb; border-bottom: 2px solid #bfdbfe; padding-bottom: 10px;">${titlePrefix}</h2>
            <p style="background:#f8fafc; padding:12px; border-radius:8px;"><strong>ğŸ”¹ ìš”ì•½:</strong> ì„¤ì •ëœ ê¸°ê°„ ë‚´ ì´ <strong>${totalLogs}ê±´</strong>ì˜ ì‘ì—… ë¡œê·¸ê°€ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            <br/>
            <h3 style="background: #f1f5f9; padding: 8px 12px; border-left: 4px solid #3b82f6;">ìƒì„¸ ì—…ë¬´ ë‚´ì—­</h3>
    `;

    for (const [gId, logs] of Object.entries(grouped)) {
        let goalName = "ê¸°íƒ€ (ë¯¸ë¶„ë¥˜ ì‘ì—…)";
        if (gId !== 'ê¸°íƒ€ ì—…ë¬´') {
            const goalObj = g_goals.find(g => g.ID === gId) || g_tasks.find(t => t.ID === gId);
            if (goalObj) goalName = `[${goalObj['ìœ í˜•']}] ${goalObj['ì œëª©']}`;
        }
        
        htmlStr += `<h4 style="color: #1e293b; margin-top: 20px; border-bottom:1px dashed #e2e8f0; padding-bottom:4px;">ğŸ“Œ ${goalName}</h4>`;
        htmlStr += `<ul style="line-height: 1.6; color: #475569;">`;
        logs.forEach(l => {
            const dateStr = l['ë‚ ì§œ'] ? l['ë‚ ì§œ'].substring(5,10) : '';
            const duration = l['ì†Œìš”ì‹œê°„'] ? `<span style="color:#059669; font-size:0.9em; background:#ecfdf5; padding:2px 6px; border-radius:4px; margin-left:4px;">â±${l['ì†Œìš”ì‹œê°„']}</span>` : '';
            const logTitle = l['ì œëª©'] ? `<b>${l['ì œëª©']}</b> - ` : '';
            const logContent = l['ë‚´ìš©'].replace(/\n/g, '<br>');
            htmlStr += `<li style="margin-bottom: 8px;">[${dateStr}] ${logTitle}${logContent} ${duration}</li>`;
        });
        htmlStr += `</ul>`;
    }
    htmlStr += `<br/><hr style="border:0; border-top:1px solid #e2e8f0;"/><p style="color:#94a3b8; font-size:0.85em; text-align:right;">â€» Cheese Lab ì‹œìŠ¤í…œì— ì˜í•´ ìë™ ìƒì„±ë¨.</p></div>`;

    openDocModal(null, titlePrefix, htmlStr, 'ë³´ê³ ì„œ');
  }

  // ì‚­ì œ ë¡œì§ (DB ë©”íƒ€ë°ì´í„°ë§Œ ì‚­ì œ, ë“œë¼ì´ë¸Œ íŒŒì¼ì€ ë³´ì¡´ë¨)
  async function deleteDoc(id) {
    if(!confirm("ëª©ë¡ì—ì„œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ë“œë¼ì´ë¸Œì˜ ì›ë³¸ íŒŒì¼ì€ ìœ ì§€ë©ë‹ˆë‹¤)")) return;
    if(typeof showAdminLoading==='function') showAdminLoading("ì‚­ì œ ì¤‘...");
    try {
      await fetch(window.CHEESE_ADMIN_API_BASE, { method: "POST", body: JSON.stringify({ mode: "deleteItem", id: id }) });
      await loadAllData();
    } catch(e) { alert("ì‚­ì œ ì˜¤ë¥˜"); }
    finally { if(typeof hideAdminLoading==='function') hideAdminLoading(); }
  }

  function closeModal(id) { document.getElementById(id).classList.remove('open'); }
</script>

</body>
</html>
