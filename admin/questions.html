<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>문제 관리 · Cheese Quiz Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- 같은 CSS 재사용 -->
  <link rel="stylesheet" href="./admin.css" />
</head>
<body>
  <div class="admin-shell">
    <header class="admin-header">
      <div class="admin-logo">
        Cheese Quiz Admin
        <span>문제 관리</span>
      </div>
      <div class="admin-badge">
        questions
      </div>
    </header>

    <div class="admin-main">
      <!-- 좌측 네비 (간단 버전) -->
      <aside class="admin-nav">
        <div class="admin-nav-group-title">메뉴</div>
        <ul class="admin-nav-list">
          <li class="admin-nav-item">
            <a class="admin-nav-button" href="../index.html">
              <span class="icon">🏠</span>
              <span>대시보드</span>
            </a>
          </li>
          <li class="admin-nav-item">
            <button class="admin-nav-button active">
              <span class="icon">📚</span>
              <span>문제 관리</span>
            </button>
          </li>
        </ul>
      </aside>

      <main>
        <!-- 필터 + 목록 -->
        <section class="admin-section active" data-section="questions">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">문제 목록</div>
                <div class="card-subtitle">
                  questions 시트의 활성( active=1 ) 문제를 게시판처럼 조회
                </div>
              </div>
            </div>

            <!-- 필터 영역 -->
            <div class="field-row">
              <div class="field">
                <label for="q-period">시대 / 카테고리</label>
                <select id="q-period">
                  <option value="">전체</option>
                  <option value="한국사-통사">한국사 통사</option>
                  <option value="한국사-근현대">한국사 근현대</option>
                  <option value="일본사-통사">일본사 통사</option>
                </select>
              </div>
              <div class="field">
                <label for="q-topic">토픽</label>
                <input id="q-topic" type="text" placeholder="예: 시대순서" />
              </div>
              <div class="field">
                <label for="q-diff">난이도</label>
                <select id="q-diff">
                  <option value="">전체</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                </select>
              </div>
              <div class="field">
                <label for="q-search">검색어 (질문/해설/힌트)</label>
                <input id="q-search" type="text" placeholder="키워드 검색" />
              </div>
            </div>

            <!-- 목록 테이블 -->
            <div class="table-wrapper">
              <table class="admin-table" id="question-table">
                <thead>
                  <tr>
                    <th style="min-width:60px;">ID</th>
                    <th style="min-width:180px;">질문</th>
                    <th style="min-width:120px;">시대</th>
                    <th style="min-width:90px;">토픽</th>
                    <th style="min-width:70px;">난이도</th>
                    <th style="min-width:80px;">정답</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- JS에서 채움 -->
                </tbody>
              </table>
            </div>

            <!-- 페이지네이션 -->
            <div class="cheese-pagination" id="question-pagination">
              <!-- JS에서 채움 -->
            </div>
          </div>

          <!-- 상세 보기 카드(일단 안씀) -->
          <div class="card" id="question-detail-card" style="display:none;">
            <div class="card-header">
              <div>
                <div class="card-title">문제 상세</div>
                <div class="card-subtitle" id="detail-meta"></div>
              </div>
            </div>
            <div id="detail-body" class="small-help">
              <!-- JS에서 채움 -->
            </div>
          </div>
          
        </section>
      </main>
    </div>
  </div>

  <script src="./admin-common.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    // ▼ 1) 폼 요소들 가져오기 (id 이름은 네 파일에 맞게 확인만 한 번 해줘)
    const spanId      = document.getElementById('q-id-display');     // ID: - 라고 찍히는 부분
    const fInternalId = document.getElementById('q-internal-id');    // 내부 ID
    const fPeriod     = document.getElementById('q-period');         // 시대
    const fTopic      = document.getElementById('q-topic');          // 주제
    const fDiff       = document.getElementById('q-difficulty');     // 난이도
    const fQuestion   = document.getElementById('q-question');       // 문제문
    const fChoice1    = document.getElementById('q-choice1');
    const fChoice2    = document.getElementById('q-choice2');
    const fChoice3    = document.getElementById('q-choice3');
    const fChoice4    = document.getElementById('q-choice4');
    const fAnswer     = document.getElementById('q-answer');
    const fActive     = document.getElementById('q-active');
    const fExplanation= document.getElementById('q-explanation');
    const fHint       = document.getElementById('q-hint');

    const errorEl     = document.getElementById('detail-error');     // 아래 빨간 문구 나오는 곳
    const form        = document.getElementById('detail-form');      // 전체 폼
    const resetBtn    = document.getElementById('btn-reset-original');
    const backBtn     = document.getElementById('btn-back-list');

    // ▼ 2) 목록 화면에서 저장해 둔 데이터 꺼내기
    let raw = null;
    try {
      raw = sessionStorage.getItem('cheese_admin_question_detail');
    } catch (e) {
      console.error(e);
    }

    if (!raw) {
      // 세션에 데이터가 없으면 안내만 띄우고 끝
      if (errorEl) {
        errorEl.textContent = '목록 화면에서 문제를 선택한 뒤 들어와 주세요. (저장된 데이터가 없습니다)';
        errorEl.style.display = 'block';
      }
      return;
    }

    let q;
    try {
      q = JSON.parse(raw);
    } catch (e) {
      console.error(e);
      if (errorEl) {
        errorEl.textContent = '저장된 문제 정보를 해석할 수 없습니다.';
        errorEl.style.display = 'block';
      }
      return;
    }

    // ▼ 3) 폼에 값 채워 넣기
    if (spanId)      spanId.textContent      = q.id || '-';
    if (fInternalId) fInternalId.value       = q.internalId || '';
    if (fPeriod)     fPeriod.value           = q.period || '';
    if (fTopic)      fTopic.value            = q.topic || '';
    if (fDiff)       fDiff.value             = q.difficulty || '';
    if (fQuestion)   fQuestion.value         = q.question || '';
    if (fChoice1)    fChoice1.value          = q.choice1 || '';
    if (fChoice2)    fChoice2.value          = q.choice2 || '';
    if (fChoice3)    fChoice3.value          = q.choice3 || '';
    if (fChoice4)    fChoice4.value          = q.choice4 || '';
    if (fAnswer)     fAnswer.value           = q.answer || '';
    if (fActive)     fActive.value           = q.active || '';
    if (fExplanation)fExplanation.value      = q.explanation || '';
    if (fHint)       fHint.value             = q.hint || '';

    if (errorEl) errorEl.style.display = 'none';

    // ▼ 4) "원래 값으로 되돌리기" 버튼
    if (resetBtn) {
      resetBtn.addEventListener('click', (e) => {
        e.preventDefault();

        if (fInternalId) fInternalId.value  = q.internalId || '';
        if (fPeriod)     fPeriod.value      = q.period || '';
        if (fTopic)      fTopic.value       = q.topic || '';
        if (fDiff)       fDiff.value        = q.difficulty || '';
        if (fQuestion)   fQuestion.value    = q.question || '';
        if (fChoice1)    fChoice1.value     = q.choice1 || '';
        if (fChoice2)    fChoice2.value     = q.choice2 || '';
        if (fChoice3)    fChoice3.value     = q.choice3 || '';
        if (fChoice4)    fChoice4.value     = q.choice4 || '';
        if (fAnswer)     fAnswer.value      = q.answer || '';
        if (fActive)     fActive.value      = q.active || '';
        if (fExplanation)fExplanation.value = q.explanation || '';
        if (fHint)       fHint.value        = q.hint || '';
      });
    }

    // ▼ 5) "목록으로 돌아가기" 버튼
    if (backBtn) {
      backBtn.addEventListener('click', (e) => {
        e.preventDefault();
        window.location.href = './questions.html';
      });
    }

    // ▼ 6) "수정 내용 저장" (지금은 아직 DB 연동 안 함)
    if (form) {
      form.addEventListener('submit', (e) => {
        e.preventDefault();

        // 나중에 Apps Script로 POST 던질 때 여기서 form 값 읽어서 보낼 예정
        alert('지금은 프론트엔드 화면만 있어서, 실제 저장은 아직 구현 전입니다.\n' +
              'Apps Script와 연동할 때 여기에서 저장 로직을 추가하면 됩니다.');
      });
    }
  });
</script>

</body>
</html>
