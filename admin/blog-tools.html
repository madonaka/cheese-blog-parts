<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë¸”ë¡œê·¸ ë„êµ¬ Â· ì½”ë“œ ìƒì„±ê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./admin.css" />
  <style>
    body{ margin:0; background:#f3f4f6; font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif; color:#0f172a; }
    .wrap{ max-width:1100px; margin:0 auto; padding:18px 18px 28px; box-sizing:border-box; }
    .card{ background:#fff; border:1px solid rgba(15,23,42,.10); border-radius:18px; box-shadow:0 10px 28px rgba(15,23,42,.10); overflow:hidden; margin-bottom:14px; }
    .h{ padding:14px 14px 10px; border-bottom:1px solid rgba(15,23,42,.06); display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .t{ font-weight:1000; letter-spacing:-0.02em; }
    .s{ color:#475569; font-size:12px; font-weight:650; }
    .b{ padding:14px; }
    .tabs{ display:flex; gap:8px; flex-wrap:wrap; }
    .tab{ border:1px solid rgba(15,23,42,.14); background:#fff; border-radius:999px; padding:8px 12px; font-weight:900; cursor:pointer; }
    .tab.on{ background:rgba(15,23,42,.92); color:#fff; border-color:rgba(15,23,42,.92); }
    .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    @media (max-width:900px){ .grid{ grid-template-columns:1fr; } }

    label{ font-size:12px; color:#475569; font-weight:900; }
    .field{ display:flex; flex-direction:column; gap:8px; }
    .input, .ta{
      border:1px solid rgba(15,23,42,.14); border-radius:12px; padding:10px 12px;
      font-size:13px; font-weight:650; outline:none; background:#fff;
    }
    .ta{ min-height:220px; resize:vertical; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .ta.out{ min-height:320px; }
    .btns{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; margin-top:10px; }
    .btn{
      border:1px solid rgba(15,23,42,.14); background:#fff; border-radius:12px;
      padding:10px 12px; font-size:13px; font-weight:900; cursor:pointer;
    }
    .btn.primary{ background:rgba(15,23,42,.92); color:#fff; border-color:rgba(15,23,42,.92); }
    .hint{ font-size:12px; color:#475569; font-weight:650; }
    .err{ color:#b91c1c; font-weight:900; }
    .ok{ color:#15803d; font-weight:900; }
    .row2{ grid-column: 1 / -1; }
    .hide{ display:none; }
    .rows { display:flex; flex-direction:column; gap:.5rem; margin:.6rem 0; }
    .row  { display:flex; gap:.5rem; align-items:center; }
    .row input { flex:1; padding:.55rem .7rem; border:1px solid #e5e7eb; border-radius:10px; }
    .row .mini { padding:.5rem .7rem; border-radius:10px; border:1px solid #e5e7eb; background:#fff; cursor:pointer; }
    .row-head { display:flex; justify-content:flex-end; margin-top:.25rem; }
    .ta.small{ min-height:140px; }

  </style>
</head>
<body>
  <div class="admin-shell">
    <div id="admin-header-slot"></div>
    <div class="admin-main">
      <aside id="admin-menu-slot" class="admin-sidebar"></aside>

      <main class="wrap">
        <div class="card">
          <div class="h">
            <div>
              <div class="t">ë¸”ë¡œê·¸ ì½”ë“œ ìƒì„±ê¸°</div>
              <div class="s">ê°’ë§Œ ë„£ê³  â€œìƒì„±â€ â†’ â€œë³µì‚¬â€ â†’ ë¸”ë¡œê·¸ HTMLì— ë¶™ì—¬ë„£ê¸°</div>
            </div>
            <div class="tabs">
              <button class="tab on" id="tabFlash" type="button">í”Œë˜ì‹œì¹´ë“œ</button>
              <button class="tab" id="tabOrder" type="button">ë“œë˜ê·¸ ì •ë ¬</button>
            </div>
          </div>

          <div class="b">
            <!-- Flashcard -->
            <section id="secFlash">
              <div class="grid">
                <div class="field">
                  <label>ì¹´ë“œ ë°ì´í„° (í–‰ ì¶”ê°€ ë°©ì‹)</label>
                  <textarea class="ta small" id="fcBulk" placeholder="ì¼ê´„ ë¶™ì—¬ë„£ê¸° (í•œ ì¤„ = 1ì¹´ë“œ)&#10;ì˜ˆ) ì•ë©´\të’·ë©´  ë˜ëŠ”  ì•ë©´ | ë’·ë©´  ë˜ëŠ”  ì•ë©´,ë’·ë©´"></textarea>
                  <div class="btns" style="justify-content:flex-start;margin-top:8px;">
                    <button type="button" class="btn" id="fcBulkApply">ì¼ê´„ ë°˜ì˜</button>
                    <button type="button" class="btn" id="fcBulkClear">ë¹„ìš°ê¸°</button>
                  </div>
                  <div class="hint">íƒ­(TSV) / | / , ì¤‘ ì•„ë¬´ êµ¬ë¶„ìë‚˜ ì‚¬ìš© ê°€ëŠ¥. êµ¬ë¶„ìê°€ ì—†ìœ¼ë©´ â€œì•ë©´ë§Œâ€ìœ¼ë¡œ ì²˜ë¦¬.</div>

                  <div class="row-head">
                    <button type="button" class="btn" id="fcAdd">+ ì¹´ë“œ ì¶”ê°€</button>
                  </div>
                  <div id="fcRows" class="rows"></div>
                  <div class="hint">ì•ë©´/ë’·ë©´ì„ ì…ë ¥í•˜ê³ , í•„ìš”í•˜ë©´ â€œ+ ì¹´ë“œ ì¶”ê°€â€ë¡œ ëŠ˜ë ¤ì¤˜.</div>
                </div>

                <div class="field">
                  <label>ì¶œë ¥</label>
                  <textarea class="ta out" id="out" readonly></textarea>
                  <div class="hint" id="msg"></div>
                </div>

                <div class="field row2">
                  <div class="btns">
                    <button class="btn" id="btnClear" type="button">ë¹„ìš°ê¸°</button>
                    <button class="btn primary" id="btnGen" type="button">ìƒì„±</button>
                    <button class="btn" id="btnCopy" type="button">ë³µì‚¬</button>
                  </div>
                </div>
              </div>
            </section>

            <!-- Order -->
            <section id="secOrder" class="hide">
              <div class="grid">
                <div class="field">
                  <label>ì œëª©(ì˜µì…˜)</label>
                  <input class="input" id="oqTitle" placeholder="ì‹œëŒ€ ìˆœì„œë¥¼ ë§ì¶° ë³´ì„¸ìš”" />
                </div>
                <div class="field">
                  <label>ì„¤ëª…(ì˜µì…˜)</label>
                  <input class="input" id="oqSub" placeholder="ì¹´ë“œë¥¼ ì•„ë˜ ìˆœì„œ ì˜ì—­ìœ¼ë¡œ ë“œë˜ê·¸í•´ì„œ ì˜®ê²¨ ë³´ì„¸ìš”." />
                </div>

                <div class="field">
                  <label>ë³´ê¸° í•­ëª© (í–‰ ì¶”ê°€ ë°©ì‹)</label>
                  <textarea class="ta small" id="oqBulk" placeholder="ì¼ê´„ ë¶™ì—¬ë„£ê¸° (í•œ ì¤„ = 1í•­ëª©)&#10;ì˜ˆ) ì‚¬ê±´A&#10;ì‚¬ê±´B&#10;ì‚¬ê±´C"></textarea>
                  <div class="btns" style="justify-content:flex-start;margin-top:8px;">
                    <button type="button" class="btn" id="oqBulkApply">ì¼ê´„ ë°˜ì˜</button>
                    <button type="button" class="btn" id="oqBulkClear">ë¹„ìš°ê¸°</button>
                    <button type="button" class="btn" id="oqOrderReset">ì •ë‹µ=ì…ë ¥ìˆœì„œ</button>
                  </div>
                  <div class="hint">ì •ë‹µ ìˆœì„œë¥¼ ë”°ë¡œ ì…ë ¥í•˜ì§€ ì•Šì„ ê±°ë©´, ì •ë‹µ ìˆœì„œ ì¹¸ì€ ë¹„ì›Œë‘ë©´ ë¼.</div>

                  <div class="row-head">
                    <button type="button" class="btn" id="oqAdd">+ í•­ëª© ì¶”ê°€</button>
                  </div>
                  <div id="oqRows" class="rows"></div>
                  <div class="hint">ì…ë ¥í•œ ìˆœì„œê°€ ê¸°ë³¸ â€œì •ë‹µ ìˆœì„œâ€ê°€ ë¼. (ì›í•˜ë©´ ì•„ë˜ì—ì„œ ìˆ«ìë¡œ ì¬ì •ì˜ ê°€ëŠ¥)</div>
                </div>

                <div class="field">
                  <label>ì •ë‹µ ìˆœì„œ (ì˜µì…˜: ìˆ«ì, ì‰¼í‘œ)</label>
                  <input class="input" id="oqOrder" placeholder="ì˜ˆ: 2,1,4,3 (ë¯¸ì…ë ¥ ì‹œ 1,2,3â€¦)" />
                  <div class="hint">ë³´ê¸° ì¤„ ë²ˆí˜¸ë¥¼ ë„£ì–´ì¤˜. ë¯¸ì…ë ¥í•˜ë©´ â€œì…ë ¥ ìˆœì„œ=ì •ë‹µâ€</div>
                </div>

                <div class="field">
                  <label>ì¶œë ¥</label>
                  <textarea class="ta out" id="out2" readonly></textarea>
                  <div class="hint" id="msg2"></div>
                </div>

                <div class="field row2">
                  <div class="btns">
                    <button class="btn" id="btnClear2" type="button">ë¹„ìš°ê¸°</button>
                    <button class="btn primary" id="btnGen2" type="button">ìƒì„±</button>
                    <button class="btn" id="btnCopy2" type="button">ë³µì‚¬</button>
                  </div>
                </div>
              </div>
            </section>

          </div>
        </div>
      </main>
    </div>
  </div>

  <script src="./admin-common.js"></script>
  <script>
    // ====== (ì„ íƒ) í—¤ë”/ë©”ë‰´ ë§ˆìš´íŠ¸ ======
    (function mountShell(){
      function tryCall(names, args){
        for(var i=0;i<names.length;i++){
          var n = names[i];
          if(typeof window[n] === 'function'){
            try{ window[n](args); }catch(e){ console.warn(n,e); }
            return true;
          }
        }
        return false;
      }
      tryCall(['renderAdminHeader','mountAdminHeader'], { mountId:'admin-header-slot', badgeText:'blog', subtitle:'ì½”ë“œ ìƒì„±ê¸°' });
      tryCall(['renderAdminMenu','renderAdminSidebar','mountAdminMenu'], { mountId:'admin-menu-slot', active:'blog' });
    })();

    // ====== helpers ======
    function $(id){ return document.getElementById(id); }

    function setMsg(id, text, ok){
      var el = $(id);
      if(!el) return;
      el.textContent = text || '';
      el.className = 'hint ' + (ok ? 'ok' : (text ? 'err' : ''));
    }

    function uid_(){
      return Math.random().toString(36).slice(2, 8);
    }

    function escAttr_(s){
      return String(s || '')
        .replace(/&/g, '&amp;')
        .replace(/"/g, '&quot;')
        .replace(/</g, '&lt;');
    }

    function copyText_(text){
      if(!text) return Promise.reject(new Error('ë³µì‚¬í•  ë‚´ìš©ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.'));
      if(navigator.clipboard && navigator.clipboard.writeText){
        return navigator.clipboard.writeText(text);
      }
      return new Promise(function(res, rej){
        try{
          var ta = document.createElement('textarea');
          ta.value = text;
          ta.setAttribute('readonly','');
          ta.style.position = 'fixed';
          ta.style.left = '-9999px';
          document.body.appendChild(ta);
          ta.select();
          document.execCommand('copy');
          document.body.removeChild(ta);
          res();
        }catch(e){ rej(e); }
      });
    }

    // ====== UI: tabs ======
    function activateTab(which){
      var isFlash = (which === 'flash');
      var tabFlash = $('tabFlash');
      var tabOrder = $('tabOrder');
      var secFlash = $('secFlash');
      var secOrder = $('secOrder');

      if(tabFlash) tabFlash.classList.toggle('on', isFlash);
      if(tabOrder) tabOrder.classList.toggle('on', !isFlash);

      if(secFlash) secFlash.classList.toggle('hide', !isFlash);
      if(secOrder) secOrder.classList.toggle('hide', isFlash);
    }

    // ====== rows: flashcard ======
    function addFlashRow_(front, back){
      front = front || '';
      back = back || '';

      var wrap = $('fcRows');
      if(!wrap) return;

      var row = document.createElement('div');
      row.className = 'row';
      row.innerHTML =
        '<input type="text" class="fc-front" placeholder="ì•ë©´(ì§ˆë¬¸/ë‹¨ì–´)" value="' + escAttr_(front) + '">' +
        '<input type="text" class="fc-back"  placeholder="ë’·ë©´(ì •ë‹µ/ëœ»)" value="' + escAttr_(back) + '">' +
        '<button type="button" class="mini fc-del">ì‚­ì œ</button>';

      var delBtn = row.querySelector('.fc-del');
      if(delBtn) delBtn.addEventListener('click', function(){ row.remove(); });

      wrap.appendChild(row);
    }

    function collectFlashPairs_(){
      var wrap = $('fcRows');
      if(!wrap) throw new Error('fcRows ì˜ì—­ì´ ì—†ìŠµë‹ˆë‹¤. (HTMLì— id="fcRows" í™•ì¸)');

      var rows = Array.prototype.slice.call(wrap.querySelectorAll('.row'));
      var pairs = rows.map(function(r){
        var f = r.querySelector('.fc-front');
        var b = r.querySelector('.fc-back');
        var front = (f && f.value ? f.value : '').trim();
        var back  = (b && b.value ? b.value : '').trim();
        return { front: front, back: back };
      }).filter(function(x){ return x.front || x.back; });

      if(pairs.length === 0) throw new Error('í”Œë˜ì‹œ ì¹´ë“œê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. ì¹´ë“œ ì¶”ê°€ í›„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
      // ë¹ˆìª½ ìˆëŠ” í–‰ ì œê±°
      pairs = pairs.filter(function(x){ return x.front && x.back; });
      if(pairs.length === 0) throw new Error('ì•/ë’·ë©´ì´ ëª¨ë‘ ì…ë ¥ëœ ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.');
      return pairs;
    }

    // ====== rows: order quiz ======
    function addOrderRow_(label){
      label = label || '';
      var wrap = $('oqRows');
      if(!wrap) return;

      var row = document.createElement('div');
      row.className = 'row';
      row.innerHTML =
        '<input type="text" class="oq-label" placeholder="í•­ëª©(ë³´ê¸°/ì •ë‹µì— ë“¤ì–´ê°ˆ ë¬¸êµ¬)" value="' + escAttr_(label) + '">' +
        '<button type="button" class="mini oq-del">ì‚­ì œ</button>';

      var delBtn = row.querySelector('.oq-del');
      if(delBtn) delBtn.addEventListener('click', function(){ row.remove(); });

      wrap.appendChild(row);
    }

    function collectOrderLabels_(){
      var wrap = $('oqRows');
      if(!wrap) throw new Error('oqRows ì˜ì—­ì´ ì—†ìŠµë‹ˆë‹¤. (HTMLì— id="oqRows" í™•ì¸)');

      var inputs = Array.prototype.slice.call(wrap.querySelectorAll('.oq-label'));
      var labels = inputs.map(function(el){
        return (el && el.value ? el.value : '').trim();
      }).filter(function(v){ return !!v; });

      if(labels.length < 2) throw new Error('ìˆœì„œ í€´ì¦ˆ í•­ëª©ì€ ìµœì†Œ 2ê°œ ì´ìƒ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
      return labels;
    }

    function parseOrderNums_(text, n){
      var raw = String(text || '').trim();
      if(!raw) return { ok:true, nums:null }; // ë¯¸ì…ë ¥ OK

      var nums = raw.split(',')
        .map(function(s){ return s.trim(); })
        .filter(function(s){ return !!s; })
        .map(function(s){ return Number(s); });

      if(nums.length !== n) return { ok:false, msg:'ì •ë‹µ ìˆœì„œ ìˆ«ì ê°œìˆ˜(' + nums.length + ')ê°€ ë³´ê¸° í•­ëª©(' + n + ')ê³¼ ë‹¬ë¼ìš”.' };
      for(var i=0;i<nums.length;i++){
        var x = nums[i];
        if(!Number.isInteger(x) || x < 1 || x > n) return { ok:false, msg:'ì •ë‹µ ìˆœì„œì— 1~' + n + ' ë²”ìœ„ ë°– ìˆ«ìê°€ ìˆì–´ìš”: ' + x };
      }
      // ì¤‘ë³µ
      var set = {};
      for(i=0;i<nums.length;i++){
        if(set[nums[i]]) return { ok:false, msg:'ì •ë‹µ ìˆœì„œì— ì¤‘ë³µ ìˆ«ìê°€ ìˆì–´ìš”.' };
        set[nums[i]] = true;
      }
      return { ok:true, nums: nums };
    }

    // ====== snippet builders (ë¸”ë¡œê·¸ì— ë¶™ì¼ ì½”ë“œ ìƒì„±) ======
    function buildFlashcardSnippet_(cards){
      var id = 'cheese-flashcard-root-' + uid_();
      var data = JSON.stringify(cards);

      return '<!-- â–¼ ì¹´ë“œê°€ í‘œì‹œë  ìë¦¬ -->\n' +
      '<div id="' + id + '" class="cheese-flashcard-wrapper"></div>\n\n' +
      '<style>\n' +
      '  .cheese-flashcard-wrapper{display:flex;flex-direction:column;align-items:center;gap:1.5rem;margin:1.5rem 0;}\n' +
      '  .cheese-flashcard{background:none;border:none;padding:0;width:380px;height:230px;perspective:1000px;cursor:pointer;position:relative;border-radius:22px;overflow:hidden;box-shadow:0 14px 30px rgba(15,23,42,.2);}\n' +
      '  .cheese-flashcard.is-flipped .cheese-flashcard-inner{transform:rotateY(180deg);}\n' +
      '  .cheese-flashcard-inner{width:100%;height:100%;position:relative;border-radius:22px;box-shadow:0 14px 30px rgba(15,23,42,.2);background:#fff;transform-style:preserve-3d;transition:transform .4s ease;}\n' +
      '  .cheese-flashcard-face{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;padding:1.4rem 1.8rem;box-sizing:border-box;backface-visibility:hidden;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;font-size:1.4rem;text-align:center;line-height:1.5;border-radius:22px;}\n' +
      '  .cheese-flashcard-front{background:#111827;color:#f9fafb;font-weight:700;}\n' +
      '  .cheese-flashcard-back{background:#e0f2fe;color:#111827;transform:rotateY(180deg);}\n' +
      '  .cheese-flashcard-main{font-size:1.7rem;font-weight:700;}\n' +
      '  .cheese-flashcard-hint{position:absolute;right:.9rem;bottom:.6rem;font-size:.75rem;opacity:.8;display:inline-flex;align-items:center;gap:.1rem;pointer-events:none;}\n' +
      '  @media(max-width:600px){.cheese-flashcard{width:80vw;max-width:320px;height:200px;}.cheese-flashcard-main{font-size:2rem;}.cheese-flashcard-hint{font-size:1.2rem;right:.7rem;bottom:.45rem;}.cheese-flashcard{-webkit-tap-highlight-color:transparent;outline:none;}}\n' +
      '</style>\n\n' +
      '<script>\n' +
      '(function(){\n' +
      '  var cheeseCards = ' + data + ';\n' +
      '  var root = document.getElementById("' + id + '");\n' +
      '  if(!root) return;\n' +
      '  cheeseCards.forEach(function(item, idx){\n' +
      '    var card = document.createElement("button");\n' +
      '    card.type = "button";\n' +
      '    card.className = "cheese-flashcard";\n' +
      '    card.setAttribute("aria-label", "ì¹´ë“œ " + (idx+1));\n' +
      '\n' +
      '    function esc(s){\n' +
      '      return String(s == null ? "" : s)\n' +
      '        .replace(/&/g,"&amp;")\n' +
      '        .replace(/</g,"&lt;")\n' +
      '        .replace(/>/g,"&gt;")\n' +
      '        .replace(/"/g,"&quot;")\n' +
      "        .replace(/'/g,\"&#39;\");\n" +
      '    }\n' +
      '\n' +
      '    card.innerHTML = `\n' +
      '      <div class="cheese-flashcard-inner">\n' +
      '        <div class="cheese-flashcard-face cheese-flashcard-front">\n' +
      '          <span class="cheese-flashcard-main">${esc(item.front)}</span>\n' +
      '          <span class="cheese-flashcard-hint">ğŸ‘‰ ë’¤ì§‘ê¸°</span>\n' +
      '        </div>\n' +
      '        <div class="cheese-flashcard-face cheese-flashcard-back">\n' +
      '          <span class="cheese-flashcard-main">${esc(item.back)}</span>\n' +
      '          <span class="cheese-flashcard-hint">ğŸ‘‰ ë’¤ì§‘ê¸°</span>\n' +
      '        </div>\n' +
      '      </div>\n' +
      '    `;\n' +
      '\n' +
      '    card.addEventListener("click", function(){\n' +
      '      card.classList.toggle("is-flipped");\n' +
      '      card.setAttribute("aria-pressed", card.classList.contains("is-flipped") ? "true" : "false");\n' +
      '    });\n' +
      '\n' +
      '    root.appendChild(card);\n' +
      '  });\n' +
      '})();\n' +
      '</scr' + 'ipt>\n';
    }

    function buildOrderSnippet_(opts){
      var title = (opts && opts.title ? String(opts.title) : '').trim() || 'ì‹œëŒ€ ìˆœì„œë¥¼ ë§ì¶° ë³´ì„¸ìš”';
      var sub   = (opts && opts.sub ? String(opts.sub) : '').trim() || 'ì¹´ë“œë¥¼ ì•„ë˜ ìˆœì„œ ì˜ì—­ìœ¼ë¡œ ë“œë˜ê·¸í•´ì„œ ì˜®ê²¨ ë³´ì„¸ìš”.';
      var labels = (opts && opts.labels) ? opts.labels : [];
      var orderNums = (opts && opts.orderNums) ? opts.orderNums : null;

      var id = 'cheese-order-quiz-' + uid_();

      // items: i1,i2,...
      var items = labels.map(function(label, idx){
        return { id: 'i' + (idx+1), label: label };
      });

      var correctOrder = (orderNums && orderNums.length === labels.length)
        ? orderNums.map(function(n){ return 'i' + n; })
        : labels.map(function(_, i){ return 'i' + (i+1); });

      var itemsJson = JSON.stringify(items);
      var correctJson = JSON.stringify(correctOrder);

      return '<!-- â–¼ ìˆœì„œ ë§ì¶”ê¸° í€´ì¦ˆê°€ ë“¤ì–´ê°ˆ ìë¦¬ -->\n' +
      '<div id="' + id + '" class="cheese-order-quiz"></div>\n\n' +
      '<style>\n' +
      '  :root{--coq-wine:#7B2C39;--coq-gray:#d1d5db;}\n' +
      '  .cheese-order-quiz{max-width:720px;margin:2rem auto;padding:1.5rem 1.25rem;border-radius:16px;background:#f9fafb;box-shadow:0 8px 22px rgba(15,23,42,.10);font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;box-sizing:border-box;}\n' +
      '  .cheese-order-title{font-size:2rem;font-weight:700;margin-bottom:1.2rem;}\n' +
      '  .cheese-order-sub{font-size:1.2rem;color:#6b7280;margin-bottom:1.2rem;}\n' +
      '  .cheese-order-section-label{font-size:1.2rem;font-weight:600;color:#4b5563;margin-bottom:.4rem;}\n' +
      '  .cheese-order-top,.cheese-order-bottom{display:flex;flex-wrap:wrap;gap:.8rem;margin-bottom:1rem;min-height:3.5rem;}\n' +
      '  .cheese-order-bottom{flex-direction:column;flex-wrap:nowrap;gap:.6rem;}\n' +
      '  .cheese-order-card{flex:1 1 auto;width:100%;min-width:0;box-sizing:border-box;padding:.6rem 1.1rem;border-radius:999px;border:2px solid var(--coq-wine);background:#111827;color:#f9fafb;font-size:1.0rem;font-weight:600;text-align:center;cursor:grab;user-select:none;box-shadow:0 3px 8px rgba(15,23,42,.25);}\n' +
      '  .cheese-order-card:active{cursor:grabbing;}\n' +
      '  .cheese-order-card.is-dragging{transform:scale(1.04);box-shadow:0 10px 22px rgba(15,23,42,.25);}\n' +
      '  .cheese-order-slot,.cheese-order-top-slot{min-width:130px;min-height:46px;border-radius:999px;border:2px dashed var(--coq-gray);background:#fff;display:flex;align-items:center;justify-content:center;font-size:1.2rem;color:#9ca3af;box-sizing:border-box;}\n' +
      '  .cheese-order-top-slot{flex:1 1 calc(50% - .85rem);min-width:calc(50% - .85rem);}\n' +
      '  .cheese-order-slot{flex:1 1 100%;min-width:100%;}\n' +
      '  .cheese-order-slot.has-card{border-style:solid;border-color:#cbd5f5;background:#eef2ff;color:transparent;}\n' +
      '  .cheese-order-slot.is-over{border-color:#6366f1;background:#e0e7ff;transform:translateY(-2px);}\n' +
      '  .cheese-order-controls{display:flex;flex-wrap:wrap;gap:.8rem;justify-content:flex-end;align-items:center;margin-top:.9rem;}\n' +
      '  .cheese-order-btn{padding:.7rem 1.5rem;border-radius:999px;border:none;font-size:1.2rem;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:.4rem;white-space:nowrap;box-shadow:0 4px 10px rgba(15,23,42,.18);}\n' +
      '  .cheese-order-btn:not(.secondary){background:#dc2626;color:#fff;}\n' +
      '  .cheese-order-btn.secondary{background:#e5e7eb;color:#111827;}\n' +
      '  .cheese-order-result{flex:1;font-size:1.5rem;color:#4b5563;}\n' +
      '  .cheese-order-result.ok{color:#15803d;font-weight:600;}\n' +
      '  .cheese-order-result.bad{color:#b91c1c;font-weight:600;}\n' +
      '  .cheese-order-guide{display:flex;flex-direction:column;align-items:center;gap:.2rem;margin:.4rem 0 .7rem;font-size:1.2rem;color:#6b7280;}\n' +
      '  .cheese-order-guide-arrow{font-size:2rem;line-height:1.5rem;}\n' +
      '  .cheese-order-slot-arrow{text-align:center;font-size:1.2rem;line-height:1;color:#d1d5db;margin:.1rem 0;}\n' +
      '</style>\n\n' +
      '<script>\n' +
      '(function(){\n' +
      '  var root = document.getElementById("' + id + '");\n' +
      '  if(!root) return;\n' +
      '  var items = ' + itemsJson + ';\n' +
      '  var correctOrder = ' + correctJson + ';\n' +
      '  root.innerHTML = "" +\n' +
      '    "<div class=\\"cheese-order-title\\">' + title.replace(/</g,'&lt;') + '</div>" +\n' +
      '    "<div class=\\"cheese-order-sub\\">' + sub.replace(/</g,'&lt;') + '</div>" +\n' +
      '    "<div class=\\"cheese-order-section cheese-order-section-top\\">" +\n' +
      '      "<div class=\\"cheese-order-section-label\\">ë³´ê¸°</div>" +\n' +
      '      "<div class=\\"cheese-order-top\\" data-top></div>" +\n' +
      '    "</div>" +\n' +
      '    "<div class=\\"cheese-order-guide\\"><div class=\\"cheese-order-guide-arrow\\">â¬‡</div><div class=\\"cheese-order-guide-text\\">ì¹´ë“œë¥¼ ì•„ë˜ ìˆœì„œ ì˜ì—­ìœ¼ë¡œ ë“œë˜ê·¸í•´ì„œ ì˜®ê²¨ ë³´ì„¸ìš”.</div></div>" +\n' +
      '    "<div class=\\"cheese-order-section cheese-order-section-bottom\\">" +\n' +
      '      "<div class=\\"cheese-order-section-label\\">ì •ë‹µ</div>" +\n' +
      '      "<div class=\\"cheese-order-bottom\\" data-bottom></div>" +\n' +
      '    "</div>" +\n' +
      '    "<div class=\\"cheese-order-controls\\">" +\n' +
      '      "<div class=\\"cheese-order-result\\" id=\\"' + id + '-result\\"></div>" +\n' +
      '      "<button type=\\"button\\" class=\\"cheese-order-btn secondary\\" id=\\"' + id + '-reset\\">â†º ì´ˆê¸°í™”</button>" +\n' +
      '      "<button type=\\"button\\" class=\\"cheese-order-btn\\" id=\\"' + id + '-check\\">âœ… ì±„ì í•˜ê¸°</button>" +\n' +
      '    "</div>";\n' +
      '\n' +
      '  var topRow = root.querySelector("[data-top]");\n' +
      '  var bottomRow = root.querySelector("[data-bottom]");\n' +
      '  var resultEl = document.getElementById("' + id + '-result");\n' +
      '  var btnReset = document.getElementById("' + id + '-reset");\n' +
      '  var btnCheck = document.getElementById("' + id + '-check");\n' +
      '\n' +
      '  var slotCount = correctOrder.length;\n' +
      '  var topSlots = [];\n' +
      '  for(var i=0;i<slotCount;i++){\n' +
      '    var ts = document.createElement("div");\n' +
      '    ts.className = "cheese-order-top-slot";\n' +
      '    ts.dataset.topIndex = String(i);\n' +
      '    topRow.appendChild(ts);\n' +
      '    topSlots.push(ts);\n' +
      '  }\n' +
      '  for(i=0;i<slotCount;i++){\n' +
      '    var slot = document.createElement("div");\n' +
      '    slot.className = "cheese-order-slot";\n' +
      '    slot.dataset.slotIndex = String(i);\n' +
      '    slot.textContent = (i+1) + "ë²ˆ";\n' +
      '    bottomRow.appendChild(slot);\n' +
      '    if(i < slotCount - 1){\n' +
      '      var arrow = document.createElement("div");\n' +
      '      arrow.className = "cheese-order-slot-arrow";\n' +
      '      arrow.textContent = "â†“";\n' +
      '      bottomRow.appendChild(arrow);\n' +
      '    }\n' +
      '  }\n' +
      '\n' +
      '  function placeInTop(cardEl){\n' +
      '    var target = null;\n' +
      '    for(var k=0;k<topSlots.length;k++){\n' +
      '      if(!topSlots[k].querySelector(".cheese-order-card")){ target = topSlots[k]; break; }\n' +
      '    }\n' +
      '    if(!target) target = topSlots[0];\n' +
      '    if(target) target.appendChild(cardEl);\n' +
      '  }\n' +
      '\n' +
      '  // ì¹´ë“œ ìƒì„±\n' +
      '  for(i=0;i<items.length;i++){\n' +
      '    var item = items[i];\n' +
      '    var card = document.createElement("div");\n' +
      '    card.className = "cheese-order-card";\n' +
      '    card.draggable = true;\n' +
      '    card.dataset.itemId = item.id;\n' +
      '    card.textContent = item.label;\n' +
      '    (topSlots[i] || topSlots[0]).appendChild(card);\n' +
      '  }\n' +
      '\n' +
      '  var draggingCard = null;\n' +
      '  root.addEventListener("dragstart", function(e){\n' +
      '    var card = e.target && e.target.closest ? e.target.closest(".cheese-order-card") : null;\n' +
      '    if(!card) return;\n' +
      '    draggingCard = card;\n' +
      '    card.classList.add("is-dragging");\n' +
      '    if(e.dataTransfer){ e.dataTransfer.effectAllowed = "move"; try{ e.dataTransfer.setData("text/plain", card.dataset.itemId || ""); }catch(_){} }\n' +
      '  });\n' +
      '  root.addEventListener("dragend", function(){\n' +
      '    if(draggingCard){ draggingCard.classList.remove("is-dragging"); }\n' +
      '    draggingCard = null;\n' +
      '    var overs = root.querySelectorAll(".cheese-order-slot.is-over");\n' +
      '    for(var i2=0;i2<overs.length;i2++) overs[i2].classList.remove("is-over");\n' +
      '  });\n' +
      '  root.addEventListener("dragover", function(e){\n' +
      '    if(!draggingCard) return;\n' +
      '    var slot = e.target && e.target.closest ? e.target.closest(".cheese-order-slot") : null;\n' +
      '    var topArea = e.target && e.target.closest ? e.target.closest("[data-top]") : null;\n' +
      '    if(!slot && !topArea) return;\n' +
      '    e.preventDefault();\n' +
      '    var overs = root.querySelectorAll(".cheese-order-slot.is-over");\n' +
      '    for(var i3=0;i3<overs.length;i3++) overs[i3].classList.remove("is-over");\n' +
      '    if(slot) slot.classList.add("is-over");\n' +
      '  });\n' +
      '  root.addEventListener("drop", function(e){\n' +
      '    if(!draggingCard) return;\n' +
      '    var slot = e.target && e.target.closest ? e.target.closest(".cheese-order-slot") : null;\n' +
      '    var topArea = e.target && e.target.closest ? e.target.closest("[data-top]") : null;\n' +
      '    if(!slot && !topArea) return;\n' +
      '    e.preventDefault();\n' +
      '    // ì•„ë˜ ìŠ¬ë¡¯ ë“œë¡­\n' +
      '    if(slot){\n' +
      '      var existing = slot.querySelector(".cheese-order-card");\n' +
      '      if(existing) placeInTop(existing);\n' +
      '      slot.innerHTML = "";\n' +
      '      slot.appendChild(draggingCard);\n' +
      '      slot.classList.add("has-card");\n' +
      '      if(resultEl){ resultEl.textContent = ""; resultEl.className = "cheese-order-result"; }\n' +
      '      return;\n' +
      '    }\n' +
      '    // ìœ„ìª½ ì˜ì—­ ë“œë¡­\n' +
      '    if(topArea){\n' +
      '      placeInTop(draggingCard);\n' +
      '      if(resultEl){ resultEl.textContent = ""; resultEl.className = "cheese-order-result"; }\n' +
      '      var slots = bottomRow.querySelectorAll(".cheese-order-slot");\n' +
      '      for(var j=0;j<slots.length;j++){\n' +
      '        if(!slots[j].querySelector(".cheese-order-card")){\n' +
      '          slots[j].classList.remove("has-card");\n' +
      '          slots[j].textContent = (Number(slots[j].dataset.slotIndex) + 1) + "ë²ˆ";\n' +
      '        }\n' +
      '      }\n' +
      '    }\n' +
      '  });\n' +
      '\n' +
      '  btnCheck.addEventListener("click", function(){\n' +
      '    var slots = bottomRow.querySelectorAll(".cheese-order-slot");\n' +
      '    var userOrder = [];\n' +
      '    var filled = 0;\n' +
      '    for(var i4=0;i4<slots.length;i4++){\n' +
      '      var c = slots[i4].querySelector(".cheese-order-card");\n' +
      '      if(c){ userOrder.push(c.dataset.itemId || null); filled++; }\n' +
      '      else userOrder.push(null);\n' +
      '    }\n' +
      '    if(filled < correctOrder.length){\n' +
      '      if(resultEl){ resultEl.textContent = "ì•„ì§ ë¹ˆ ì¹¸ì´ ìˆì–´ìš”. ëª¨ë“  ì¹¸ì— ì¹´ë“œë¥¼ ë°°ì¹˜í•´ ì£¼ì„¸ìš”."; resultEl.className = "cheese-order-result bad"; }\n' +
      '      return;\n' +
      '    }\n' +
      '    var ok = true;\n' +
      '    for(var i5=0;i5<userOrder.length;i5++) if(userOrder[i5] !== correctOrder[i5]) ok = false;\n' +
      '    if(resultEl){\n' +
      '      if(ok){ resultEl.textContent = "ì •ë‹µ! ì•„ì£¼ ì˜í–ˆìŠµë‹ˆë‹¤ ğŸ‘"; resultEl.className = "cheese-order-result ok"; }\n' +
      '      else{ resultEl.textContent = "ìˆœì„œê°€ ì¼ë¶€ ë‹¤ë¦…ë‹ˆë‹¤. ë‹¤ì‹œ í•œ ë²ˆ ì¡°ì •í•´ ë³´ì„¸ìš”."; resultEl.className = "cheese-order-result bad"; }\n' +
      '    }\n' +
      '  });\n' +
      '\n' +
      '  btnReset.addEventListener("click", function(){\n' +
      '    // ì•„ë˜ ë¹„ìš°ê¸°\n' +
      '    var slots = bottomRow.querySelectorAll(".cheese-order-slot");\n' +
      '    for(var i6=0;i6<slots.length;i6++){\n' +
      '      var card = slots[i6].querySelector(".cheese-order-card");\n' +
      '      if(card) card.remove();\n' +
      '      slots[i6].classList.remove("has-card","is-over");\n' +
      '      slots[i6].textContent = (Number(slots[i6].dataset.slotIndex) + 1) + "ë²ˆ";\n' +
      '    }\n' +
      '    // ìœ„ ë¹„ìš°ê¸°\n' +
      '    for(i6=0;i6<topSlots.length;i6++){\n' +
      '      var c2 = topSlots[i6].querySelector(".cheese-order-card");\n' +
      '      if(c2) c2.remove();\n' +
      '    }\n' +
      '    // ë‹¤ì‹œ ìƒì„±\n' +
      '    for(i6=0;i6<items.length;i6++){\n' +
      '      var it = items[i6];\n' +
      '      var c3 = document.createElement("div");\n' +
      '      c3.className = "cheese-order-card";\n' +
      '      c3.draggable = true;\n' +
      '      c3.dataset.itemId = it.id;\n' +
      '      c3.textContent = it.label;\n' +
      '      (topSlots[i6] || topSlots[0]).appendChild(c3);\n' +
      '    }\n' +
      '    if(resultEl){ resultEl.textContent = ""; resultEl.className = "cheese-order-result"; }\n' +
      '  });\n' +
      '})();\n' +
      '<\\/script>';
    }

    // ====== wire ======
    
    // ===== Bulk helpers =====
    function splitLine2_(line){
      var s = String(line == null ? '' : line).trim();
      if(!s) return null;

      // Prefer tab (TSV), then |, then comma
      var delim = null;
      if(s.indexOf('\t') >= 0) delim = '\t';
      else if(s.indexOf('|') >= 0) delim = '|';
      else if(s.indexOf(',') >= 0) delim = ',';

      if(!delim) return { a: s, b: '' };

      // first delimiter only
      var idx = (delim === '\t') ? s.search(/\t/) : s.indexOf(delim);
      if(idx < 0) return { a: s, b: '' };

      var left = s.slice(0, idx).trim();
      var right = s.slice(idx).trim();
      if(delim === '\t') right = right.replace(/^\t+/, '').trim();
      else right = right.replace(new RegExp('^\\' + delim + '+'), '').trim();

      return { a: left, b: right };
    }

    function applyFlashBulk_(){
      var ta = $('fcBulk');
      if(!ta) return;
      var lines = String(ta.value || '').split(/\r?\n/);
      var wrap = $('fcRows');
      if(wrap) wrap.innerHTML = '';
      var added = 0;

      lines.forEach(function(line){
        var p = splitLine2_(line);
        if(!p) return;
        addFlashRow_(p.a, p.b);
        added++;
      });

      if(added === 0) addFlashRow_();
      setMsg('msg', 'ì¼ê´„ ë°˜ì˜ ì™„ë£Œ (' + added + 'ê°œ)', true);
    }

    function applyOrderBulk_(){
      var ta = $('oqBulk');
      if(!ta) return;
      var lines = String(ta.value || '')
        .split(/\r?\n/)
        .map(function(s){ return String(s || '').trim(); })
        .filter(Boolean);

      var wrap = $('oqRows');
      if(wrap) wrap.innerHTML = '';
      lines.forEach(function(label){ addOrderRow_(label); });

      if(lines.length === 0) addOrderRow_();

      // ê¸°ë³¸ì€ ì…ë ¥ìˆœì„œ=ì •ë‹µì´ë¯€ë¡œ ì •ë‹µì¹¸ì€ ë¹„ì›Œë‘ê¸°
      var ord = $('oqOrder');
      if(ord) ord.value = '';

      setMsg('msg2', 'ì¼ê´„ ë°˜ì˜ ì™„ë£Œ (' + lines.length + 'ê°œ)', true);
    }

    function mountFallbackLayout_(){
      var hs = document.getElementById('admin-header-slot');
      var ms = document.getElementById('admin-menu-slot');

      if(hs && hs.children.length === 0){
        hs.innerHTML = ''
          + '<header class="admin-header">'
          + '  <div class="admin-logo">'
          + '    <a href="./index.html" style="text-decoration:none;color:inherit;">Cheese Lab Admin</a>'
          + '    <span style="opacity:.7;margin-left:.5rem;">ë¸”ë¡œê·¸ ë„êµ¬</span>'
          + '  </div>'
          + '  <div class="admin-header-right">'
          + '    <span class="admin-badge" style="opacity:.8;">blog</span>'
          + '  </div>'
          + '</header>';
      }

      if(ms && ms.children.length === 0){
        ms.innerHTML = ''
          + '<nav style="padding:12px;display:flex;flex-direction:column;gap:8px;">'
          + '  <a class="btn" href="./index.html" style="text-align:left;">ëŒ€ì‹œë³´ë“œ</a>'
          + '  <a class="btn" href="./blog-tools.html" style="text-align:left;">ë¸”ë¡œê·¸ íˆ´</a>'
          + '</nav>';
      }
    }

function wire_(){
      var tabFlash = $('tabFlash');
      var tabOrder = $('tabOrder');
      if(tabFlash) tabFlash.addEventListener('click', function(){ activateTab('flash'); });
      if(tabOrder) tabOrder.addEventListener('click', function(){ activateTab('order'); });

      var fcAdd = $('fcAdd');
      if(fcAdd) fcAdd.addEventListener('click', function(){ addFlashRow_(); });

      var oqAdd = $('oqAdd');
      if(oqAdd) oqAdd.addEventListener('click', function(){ addOrderRow_(); });

      var fcBulkApply = $('fcBulkApply');
      if(fcBulkApply) fcBulkApply.addEventListener('click', function(){
        try{ applyFlashBulk_(); }catch(e){ setMsg('msg', e.message || String(e), false); }
      });
      var fcBulkClear = $('fcBulkClear');
      if(fcBulkClear) fcBulkClear.addEventListener('click', function(){
        var ta = $('fcBulk'); if(ta) ta.value = '';
        setMsg('msg', '', true);
      });

      var oqBulkApply = $('oqBulkApply');
      if(oqBulkApply) oqBulkApply.addEventListener('click', function(){
        try{ applyOrderBulk_(); }catch(e){ setMsg('msg2', e.message || String(e), false); }
      });
      var oqBulkClear = $('oqBulkClear');
      if(oqBulkClear) oqBulkClear.addEventListener('click', function(){
        var ta = $('oqBulk'); if(ta) ta.value = '';
        setMsg('msg2', '', true);
      });

      var oqOrderReset = $('oqOrderReset');
      if(oqOrderReset) oqOrderReset.addEventListener('click', function(){
        var ord = $('oqOrder'); if(ord) ord.value = '';
        setMsg('msg2', 'ì •ë‹µì„ ì…ë ¥ ìˆœì„œë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.', true);
      });

      var btnGen = $('btnGen');
      if(btnGen) btnGen.addEventListener('click', function(){
        try{
          var pairs = collectFlashPairs_();
          var code = buildFlashcardSnippet_(pairs);
          var out = $('out');
          if(out) out.value = code;
          setMsg('msg', 'ìƒì„± ì™„ë£Œ', true);
        }catch(e){
          setMsg('msg', e.message || String(e), false);
        }
      });

      var btnCopy = $('btnCopy');
      if(btnCopy) btnCopy.addEventListener('click', function(){
        var out = $('out');
        copyText_(out ? out.value : '')
          .then(function(){ setMsg('msg', 'ë³µì‚¬ ì™„ë£Œ', true); })
          .catch(function(e){ setMsg('msg', e.message || String(e), false); });
      });

      var btnClear = $('btnClear');
      if(btnClear) btnClear.addEventListener('click', function(){
        var out = $('out');
        if(out) out.value = '';
        setMsg('msg', '', true);
      });

      var btnGen2 = $('btnGen2');
      if(btnGen2) btnGen2.addEventListener('click', function(){
        try{
          var labels = collectOrderLabels_();
          var title = ($('oqTitle') && $('oqTitle').value ? $('oqTitle').value : '').trim();
          var sub   = ($('oqSub') && $('oqSub').value ? $('oqSub').value : '').trim();

          var ordRaw = ($('oqOrder') && $('oqOrder').value ? $('oqOrder').value : '');
          var parsed = parseOrderNums_(ordRaw, labels.length);
          if(!parsed.ok) throw new Error(parsed.msg);

          var orderNums = parsed.nums ? parsed.nums : labels.map(function(_, i){ return i+1; });

          var code = buildOrderSnippet_({ title:title, sub:sub, labels:labels, orderNums:orderNums });
          var out2 = $('out2');
          if(out2) out2.value = code;
          setMsg('msg2', 'ìƒì„± ì™„ë£Œ', true);
        }catch(e){
          setMsg('msg2', e.message || String(e), false);
        }
      });

      var btnCopy2 = $('btnCopy2');
      if(btnCopy2) btnCopy2.addEventListener('click', function(){
        var out2 = $('out2');
        copyText_(out2 ? out2.value : '')
          .then(function(){ setMsg('msg2', 'ë³µì‚¬ ì™„ë£Œ', true); })
          .catch(function(e){ setMsg('msg2', e.message || String(e), false); });
      });

      var btnClear2 = $('btnClear2');
      if(btnClear2) btnClear2.addEventListener('click', function(){
        var out2 = $('out2');
        if(out2) out2.value = '';
        setMsg('msg2', '', true);
      });
    }

    document.addEventListener('DOMContentLoaded', function(){
      try{
        if(window.CheeseAdmin && typeof window.CheeseAdmin.mountLayout === 'function'){
          window.CheeseAdmin.mountLayout({ headerSlotId:'admin-header-slot', menuSlotId:'admin-menu-slot', pageTitle:'ë¸”ë¡œê·¸ ë„êµ¬' });
        }
      }catch(e){}
      mountFallbackLayout_();
      wire_();
      // ê¸°ë³¸ 1ì¤„ì”©
      addFlashRow_();
      addOrderRow_();
      activateTab('flash');
    });
  </script>
</body>
</html>
