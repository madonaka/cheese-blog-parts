<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë¸”ë¡œê·¸ ë„êµ¬ Â· ì½”ë“œ ìƒì„±ê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./admin.css" />
<style>
    :root{
      --bg:#f3f4f6;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --line:rgba(15,23,42,.10);
      --shadow:0 10px 28px rgba(15,23,42,.10);
      --primary:#111827;
      --accent:#7B2C39; /* wine */
      --soft:#e0f2fe;
      --ok:#16a34a;
      --bad:#ef4444;
    }
    *{box-sizing:border-box;}
    body{ margin:0; background:var(--bg); font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif; color:var(--text); }
    .wrap{ max-width:1100px; margin:0 auto; padding:18px 18px 28px; }
    .card{ background:var(--card); border:1px solid var(--line); border-radius:18px; box-shadow:var(--shadow); overflow:hidden; margin-bottom:14px; }
    .h{ padding:14px 14px; display:flex; align-items:center; justify-content:space-between; gap:10px; border-bottom:1px solid var(--line); }
    .h-title{ font-size:1.05rem; font-weight:750; letter-spacing:-.02em; }
    .h-sub{ font-size:.86rem; color:var(--muted); }
    .h-left{ display:flex; flex-direction:column; gap:2px; }
    .h-right{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
    .pill{ font-size:.78rem; padding:.32rem .55rem; border-radius:999px; border:1px solid var(--line); color:var(--muted); background:#fff; }
    .tabs{ display:flex; gap:8px; padding:12px 14px; border-bottom:1px solid var(--line); background:#fff; }
    .tab{
      border:1px solid var(--line);
      background:#fff;
      border-radius:12px;
      padding:.55rem .75rem;
      font-weight:650;
      cursor:pointer;
      color:var(--muted);
      user-select:none;
    }
    .tab.is-active{ color:var(--text); border-color:rgba(15,23,42,.22); box-shadow:0 8px 18px rgba(15,23,42,.08); }
    .b{ padding:14px; }
    .grid{ display:grid; gap:10px; }
    .grid-2{ grid-template-columns: 1fr 1fr; }
    @media(max-width:900px){ .grid-2{ grid-template-columns:1fr; } }

    .field label{ display:block; font-size:.86rem; color:var(--muted); margin:0 0 6px; }
    input[type="text"], textarea{
      width:100%;
      border:1px solid rgba(15,23,42,.16);
      border-radius:12px;
      padding:.75rem .85rem;
      font-size:.95rem;
      outline:none;
      background:#fff;
    }
    textarea{ min-height:140px; resize:vertical; font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:.9rem; }
    input[type="text"]:focus, textarea:focus{ border-color:rgba(15,23,42,.36); box-shadow:0 0 0 4px rgba(15,23,42,.06); }

    .rowlist{ display:flex; flex-direction:column; gap:8px; }
    .row{ display:flex; gap:8px; align-items:center; }
    .row input{ flex:1; }
    .mini, .btn{
      border:1px solid rgba(15,23,42,.18);
      background:#fff;
      padding:.58rem .78rem;
      border-radius:12px;
      cursor:pointer;
      font-weight:700;
      color:var(--text);
    }
    .mini{ padding:.52rem .64rem; font-size:.85rem; }
    .btn{ padding:.70rem .92rem; }
    .btn.primary{ background:var(--primary); color:#fff; border-color:transparent; }
    .btn.ghost{ background:#fff; color:var(--text); }
    .btn:active, .mini:active{ transform:translateY(1px); }

    .actions{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:10px; }
    .muted{ color:var(--muted); font-size:.86rem; line-height:1.45; }
    .hintbox{
      border:1px dashed rgba(15,23,42,.18);
      background:#fff;
      border-radius:14px;
      padding:10px 12px;
      color:var(--muted);
      font-size:.86rem;
      line-height:1.5;
    }
    .msg{ margin-top:10px; font-size:.9rem; font-weight:700; }
    .msg.ok{ color:var(--ok); }
    .msg.bad{ color:var(--bad); }

    .split{ display:grid; grid-template-columns: 1.15fr .85fr; gap:12px; align-items:start; }
    @media(max-width:900px){ .split{ grid-template-columns:1fr; } }

    .section-title{ font-weight:800; margin:2px 0 8px; }
    .toggleline{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .toggle{ display:inline-flex; align-items:center; gap:8px; padding:.35rem .55rem; border-radius:999px; border:1px solid rgba(15,23,42,.14); background:#fff; }
    .toggle input{ width:18px; height:18px; }

    .out textarea{ min-height:220px; }
    .hr{ height:1px; background:rgba(15,23,42,.10); margin:12px 0; }

    .hide{ display:none !important; }
  </style>
<style>\n' +
      '  .cheese-flashcard-wrapper{display:flex;flex-direction:column;align-items:center;gap:1.5rem;margin:1.5rem 0;}\n' +
      '  .cheese-flashcard{background:none;border:none;padding:0;width:380px;height:230px;perspective:1000px;cursor:pointer;position:relative;border-radius:22px;overflow:hidden;box-shadow:0 14px 30px rgba(15,23,42,.2);}\n' +
      '  .cheese-flashcard.is-flipped .cheese-flashcard-inner{transform:rotateY(180deg);}\n' +
      '  .cheese-flashcard-inner{width:100%;height:100%;position:relative;border-radius:22px;box-shadow:0 14px 30px rgba(15,23,42,.2);background:#fff;transform-style:preserve-3d;transition:transform .4s ease;}\n' +
      '  .cheese-flashcard-face{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;padding:1.4rem 1.8rem;box-sizing:border-box;backface-visibility:hidden;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;font-size:1.4rem;text-align:center;line-height:1.5;border-radius:22px;}\n' +
      '  .cheese-flashcard-front{background:#111827;color:#f9fafb;font-weight:700;}\n' +
      '  .cheese-flashcard-back{background:#e0f2fe;color:#111827;transform:rotateY(180deg);}\n' +
      '  .cheese-flashcard-main{font-size:1.7rem;font-weight:800;}\n' +
      '  .cheese-flashcard-hint{position:absolute;right:.9rem;bottom:.6rem;font-size:.75rem;opacity:.8;display:inline-flex;align-items:center;gap:.1rem;pointer-events:none;}\n' +
      '  @media(max-width:600px){.cheese-flashcard{width:80vw;max-width:320px;height:200px;}.cheese-flashcard-main{font-size:2rem;}.cheese-flashcard-hint{font-size:1.05rem;right:.7rem;bottom:.45rem;}.cheese-flashcard{-webkit-tap-highlight-color:transparent;outline:none;}}\n' +
      '</style>
<style>\n' +
      '  :root{--coq-wine:#7B2C39;--coq-gray:#d1d5db;}\n' +
      '  .cheese-order-quiz{max-width:720px;margin:2rem auto;padding:1.5rem 1.25rem;border-radius:16px;background:#f9fafb;box-shadow:0 8px 22px rgba(15,23,42,.10);font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;box-sizing:border-box;}\n' +
      '  .cheese-order-title{font-size:2rem;font-weight:700;margin-bottom:1.2rem;}\n' +
      '  .cheese-order-sub{font-size:1.2rem;color:#6b7280;margin-bottom:1.2rem;}\n' +
      '  .cheese-order-section-label{font-size:1.2rem;font-weight:600;color:#4b5563;margin-bottom:.4rem;}\n' +
      '  .cheese-order-top,.cheese-order-bottom{display:flex;flex-wrap:wrap;gap:.8rem;margin-bottom:1rem;min-height:3.5rem;}\n' +
      '  .cheese-order-bottom{flex-direction:column;flex-wrap:nowrap;gap:.6rem;}\n' +
      '  .cheese-order-card{flex:1 1 auto;width:100%;min-width:0;box-sizing:border-box;padding:.6rem 1.1rem;border-radius:999px;border:2px solid var(--coq-wine);background:#111827;color:#f9fafb;font-size:1.0rem;font-weight:600;text-align:center;cursor:grab;user-select:none;box-shadow:0 3px 8px rgba(15,23,42,.25);}\n' +
      '  .cheese-order-card:active{cursor:grabbing;}\n' +
      '  .cheese-order-card.is-dragging{transform:scale(1.04);box-shadow:0 10px 22px rgba(15,23,42,.25);}\n' +
      '  .cheese-order-slot,.cheese-order-top-slot{min-width:130px;min-height:46px;border-radius:999px;border:2px dashed var(--coq-gray);background:#fff;display:flex;align-items:center;justify-content:center;font-size:1.2rem;color:#9ca3af;box-sizing:border-box;}\n' +
      '  .cheese-order-top-slot{flex:1 1 calc(50% - .85rem);min-width:calc(50% - .85rem);}\n' +
      '  .cheese-order-slot{flex:1 1 100%;min-width:100%;}\n' +
      '  .cheese-order-slot.has-card{border-style:solid;border-color:#cbd5f5;background:#eef2ff;color:transparent;}\n' +
      '  .cheese-order-slot.is-over{border-color:#6366f1;background:#e0e7ff;transform:translateY(-2px);}\n' +
      '  .cheese-order-controls{display:flex;flex-wrap:wrap;gap:.8rem;justify-content:flex-end;align-items:center;margin-top:.9rem;}\n' +
      '  .cheese-order-btn{padding:.7rem 1.5rem;border-radius:999px;border:none;font-size:1.2rem;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:.4rem;white-space:nowrap;box-shadow:0 4px 10px rgba(15,23,42,.18);}\n' +
      '  .cheese-order-btn:not(.secondary){background:#dc2626;color:#fff;}\n' +
      '  .cheese-order-btn.secondary{background:#e5e7eb;color:#111827;}\n' +
      '  .cheese-order-result{flex:1;font-size:1.5rem;color:#4b5563;}\n' +
      '  .cheese-order-result.ok{color:#15803d;font-weight:600;}\n' +
      '  .cheese-order-result.bad{color:#b91c1c;font-weight:600;}\n' +
      '  .cheese-order-guide{display:flex;flex-direction:column;align-items:center;gap:.2rem;margin:.4rem 0 .7rem;font-size:1.2rem;color:#6b7280;}\n' +
      '  .cheese-order-guide-arrow{font-size:2rem;line-height:1.5rem;}\n' +
      '  .cheese-order-slot-arrow{text-align:center;font-size:1.2rem;line-height:1;color:#d1d5db;margin:.1rem 0;}\n' +
      '</style>
</head>
<body>
  <div class="admin-shell">
    <div id="admin-header-slot"></div>
    <div class="admin-main">
      <aside id="admin-menu-slot" class="admin-sidebar"></aside>

      <main class="wrap">
<div class="card">
      <div class="h">
        <div class="h-left">
          <div class="h-title">ë¸”ë¡œê·¸ íˆ´ Â· ì½”ë“œ ìƒì„±ê¸°</div>
          <div class="h-sub">í‹°ìŠ¤í† ë¦¬/ë¸”ë¡œê·¸ìŠ¤íŒŸ HTMLì— ê·¸ëŒ€ë¡œ ë¶™ì—¬ ë„£ëŠ” ìŠ¤ë‹ˆí«ì„ ìƒì„±í•©ë‹ˆë‹¤.</div>
        </div>
        <div class="h-right">
          <span class="pill">Flashcard</span>
          <span class="pill">Drag Order Quiz</span>
          <span class="pill">v0.7</span>
        </div>
      </div>

      <div class="tabs">
        <div class="tab is-active" id="tabFlash" role="button" tabindex="0">í”Œë˜ì‹œ ì¹´ë“œ</div>
        <div class="tab" id="tabOrder" role="button" tabindex="0">ë“œë˜ê·¸ ìˆœì„œ í€´ì¦ˆ</div>
      </div>

      <!-- ==================== FLASHCARD ==================== -->
      <div class="b" id="paneFlash">
        <div class="split">
          <div>
            <div class="section-title">ì…ë ¥</div>

            <div class="hintbox">
              <b>ë¹ ë¥¸ ì…ë ¥:</b> ì•„ë˜ â€œì¼ê´„ ë¶™ì—¬ë„£ê¸°â€ì— <code>ì•ë©´[TAB]ë’·ë©´</code> ë˜ëŠ” <code>ì•ë©´|ë’·ë©´</code> í˜•ì‹ìœ¼ë¡œ í•œ ì¤„ì— 1ê°œì”© ë¶™ì—¬ë„£ê³  â€œë¶ˆëŸ¬ì˜¤ê¸°â€ë¥¼ ëˆ„ë¥´ì„¸ìš”.
              <br/>ì¼ë°˜ ì…ë ¥(í–‰ ì¶”ê°€)ë„ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
            </div>

            <div class="hr"></div>

            <div class="grid grid-2">
              <div>
                <div class="field">
                  <label>ì¼ê´„ ë¶™ì—¬ë„£ê¸° (í•œ ì¤„ = 1ì¹´ë“œ)</label>
                  <textarea id="fcBulk" placeholder="ì˜ˆ) ì¡°ì„  ê±´êµ­&#9;1392&#10;ì„ì§„ì™œë€|1592&#10;..."></textarea>
                </div>
                <div class="actions">
                  <button class="btn" type="button" id="fcBulkLoad">ë¶ˆëŸ¬ì˜¤ê¸°</button>
                  <button class="btn ghost" type="button" id="fcBulkExport">í˜„ì¬ ì…ë ¥ ë‚´ë³´ë‚´ê¸°</button>
                  <button class="btn ghost" type="button" id="fcBulkClear">ë¹„ìš°ê¸°</button>
                </div>
              </div>

              <div>
                <div class="field">
                  <label>í–‰ ì…ë ¥ (ì•ë©´ / ë’·ë©´)</label>
                  <div id="fcRows" class="rowlist"></div>
                </div>
                <div class="actions">
                  <button class="btn" type="button" id="fcAdd">+ ì¹´ë“œ ì¶”ê°€</button>
                  <button class="btn ghost" type="button" id="fcClearRows">í–‰ ì „ì²´ ì‚­ì œ</button>
                </div>
              </div>
            </div>

            <div class="actions" style="margin-top:14px;">
              <button class="btn primary" type="button" id="btnGen">ì½”ë“œ ìƒì„±</button>
              <button class="btn ghost" type="button" id="btnCopy">ë³µì‚¬</button>
              <button class="btn ghost" type="button" id="btnClear">ì¶œë ¥ ë¹„ìš°ê¸°</button>
              <span id="msg" class="msg"></span>
            </div>
          </div>

          <div class="out">
            <div class="section-title">ì¶œë ¥</div>
            <div class="field">
              <label>ìƒì„±ëœ ì½”ë“œë¥¼ ë¸”ë¡œê·¸ HTMLì— ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ê¸°</label>
              <textarea id="out" readonly placeholder="ì—¬ê¸°ì— ìƒì„±ëœ ì½”ë“œê°€ ë‚˜ì˜µë‹ˆë‹¤."></textarea>
            </div>
            <div class="muted" style="margin-top:8px;">
              - ì¹´ë“œ ë‚´ìš©ì— <code>&lt;</code> <code>&gt;</code> ê°™ì€ ë¬¸ìê°€ ìˆì–´ë„ ê¹¨ì§€ì§€ ì•Šë„ë¡ ë‚´ë¶€ì—ì„œ escape ì²˜ë¦¬í•©ë‹ˆë‹¤.<br/>
              - ìŠ¤ë‹ˆí«ì— <code>&lt;/script&gt;</code>ê°€ â€œê·¸ëŒ€ë¡œâ€ ë“¤ì–´ê°€ë©´ ë¸Œë¼ìš°ì €ê°€ ì¤‘ê°„ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ëŠì–´ë²„ë¦´ ìˆ˜ ìˆì–´ì„œ, ì•ˆì „í•˜ê²Œ ë¶„í• í•´ì„œ ì¶œë ¥í•©ë‹ˆë‹¤.
            </div>
          </div>
        </div>
      </div>

      <!-- ==================== ORDER QUIZ ==================== -->
      <div class="b hide" id="paneOrder">
        <div class="split">
          <div>
            <div class="section-title">ì…ë ¥</div>

            <div class="hintbox">
              <b>ì •ë‹µ ì…ë ¥ì„ ì‰½ê²Œ:</b> ê¸°ë³¸ì€ <b>ì…ë ¥í•œ ìˆœì„œê°€ ì •ë‹µ</b>ì…ë‹ˆë‹¤. (ì˜ˆ: 1,2,3,4...)<br/>
              ê·¸ë¦¬ê³  <b>ë³´ê¸° ë°°ì¹˜ë§Œ ëœë¤(ì„ê¸°)</b>í•  ìˆ˜ ìˆì–´ìš”. â†’ ìˆ«ì ì •ë‹µì„ ê±°ì˜ ì•ˆ ì“°ê²Œ ë©ë‹ˆë‹¤.
            </div>

            <div class="hr"></div>

            <div class="grid grid-2">
              <div class="field">
                <label>ë¬¸ì œ ì œëª©</label>
                <input id="oqTitle" type="text" placeholder="ì˜ˆ) ì‹œëŒ€ ìˆœì„œë¥¼ ë§ì¶° ë³´ì„¸ìš”" />
              </div>
              <div class="field">
                <label>ë¶€ì œ</label>
                <input id="oqSub" type="text" placeholder="ì˜ˆ) ì¹´ë“œë¥¼ ì•„ë˜ ìˆœì„œ ì˜ì—­ìœ¼ë¡œ ë“œë˜ê·¸í•´ì„œ ì˜®ê²¨ ë³´ì„¸ìš”." />
              </div>
            </div>

            <div class="hr"></div>

            <div class="grid grid-2">
              <div>
                <div class="field">
                  <label>ì¼ê´„ ë¶™ì—¬ë„£ê¸° (í•œ ì¤„ = 1í•­ëª©)</label>
                  <textarea id="oqBulk" placeholder="ì˜ˆ) ì„ì§„ì™œë€&#10;ë³‘ìí˜¸ë€&#10;..."></textarea>
                </div>
                <div class="actions">
                  <button class="btn" type="button" id="oqBulkLoad">ë¶ˆëŸ¬ì˜¤ê¸°</button>
                  <button class="btn ghost" type="button" id="oqBulkExport">í˜„ì¬ ì…ë ¥ ë‚´ë³´ë‚´ê¸°</button>
                  <button class="btn ghost" type="button" id="oqBulkClear">ë¹„ìš°ê¸°</button>
                </div>
              </div>

              <div>
                <div class="field">
                  <label>í–‰ ì…ë ¥</label>
                  <div id="oqRows" class="rowlist"></div>
                </div>
                <div class="actions">
                  <button class="btn" type="button" id="oqAdd">+ í•­ëª© ì¶”ê°€</button>
                  <button class="btn ghost" type="button" id="oqClearRows">í–‰ ì „ì²´ ì‚­ì œ</button>
                </div>
              </div>
            </div>

            <div class="hr"></div>

            <div class="toggleline">
              <label class="toggle"><input type="checkbox" id="oqShuffle" checked> ë³´ê¸° ì„ê¸°(ì¶”ì²œ)</label>
              <label class="toggle"><input type="checkbox" id="oqUseCustomOrder"> ê³ ê¸‰: ì •ë‹µ ìˆœì„œ ì§ì ‘ ì§€ì •</label>
            </div>

            <div id="oqOrderBox" class="field hide" style="margin-top:10px;">
              <label>ì •ë‹µ ìˆœì„œ (ì˜ˆ: 3,1,2,4) â€” ìˆ«ìëŠ” â€œì…ë ¥í•œ í•­ëª© ë²ˆí˜¸â€ ê¸°ì¤€</label>
              <input id="oqOrder" type="text" placeholder="ì˜ˆ) 3,1,2,4" />
              <div class="muted" style="margin-top:6px;">
                ìœ„ ì²´í¬ë¥¼ ë„ë©´ <b>ì…ë ¥í•œ ìˆœì„œ(1,2,3...)</b>ê°€ ìë™ ì •ë‹µì´ë¼ ì—¬ê¸° ì…ë ¥í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.
              </div>
            </div>

            <div class="actions" style="margin-top:14px;">
              <button class="btn primary" type="button" id="btnGen2">ì½”ë“œ ìƒì„±</button>
              <button class="btn ghost" type="button" id="btnCopy2">ë³µì‚¬</button>
              <button class="btn ghost" type="button" id="btnClear2">ì¶œë ¥ ë¹„ìš°ê¸°</button>
              <span id="msg2" class="msg"></span>
            </div>
          </div>

          <div class="out">
            <div class="section-title">ì¶œë ¥</div>
            <div class="field">
              <label>ìƒì„±ëœ ì½”ë“œë¥¼ ë¸”ë¡œê·¸ HTMLì— ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ê¸°</label>
              <textarea id="out2" readonly placeholder="ì—¬ê¸°ì— ìƒì„±ëœ ì½”ë“œê°€ ë‚˜ì˜µë‹ˆë‹¤."></textarea>
            </div>
            <div class="muted" style="margin-top:8px;">
              - ë³´ê¸° ì„ê¸° ONì´ë©´, <b>ì •ë‹µì€ ê·¸ëŒ€ë¡œ</b> ë‘ê³  <b>ë³´ê¸°ë§Œ ëœë¤</b>ìœ¼ë¡œ ë°°ì¹˜ë©ë‹ˆë‹¤. (ì…ë ¥ ìˆœì„œ = ì •ë‹µì„ ìœ ì§€)
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="muted">
      Tips: ë¸”ë¡œê·¸ìŠ¤íŒŸì€ â€œí…Œë§ˆ HTMLâ€ì— ë¶™ì—¬ë„£ì„ ë•Œ ìŠ¤í¬ë¦½íŠ¸/ìŠ¤íƒ€ì¼ ìœ„ì¹˜ì— ë”°ë¼ ë™ì‘ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”. ê°€ëŠ¥í•˜ë©´ ê²Œì‹œê¸€ HTML(ë˜ëŠ” HTML/ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°€ì ¯)ì— ë¶™ì—¬ë„£ëŠ” ë°©ì‹ì´ ê°€ì¥ ì•ˆì •ì ì…ë‹ˆë‹¤.
    </div>
      </main>
    </div>
  </div>

  <script src="./admin-common.js"></script>
  <script>
    // ====== (ì„ íƒ) í—¤ë”/ë©”ë‰´ ë§ˆìš´íŠ¸ ======
    (function mountShell(){
      function tryCall(names, args){
        for(var i=0;i<names.length;i++){
          var n = names[i];
          if(typeof window[n] === 'function'){
            try{ window[n](args); }catch(e){ console.warn(n,e); }
            return true;
          }
        }
        return false;
      }
      tryCall(['renderAdminHeader','mountAdminHeader'], { mountId:'admin-header-slot', badgeText:'blog', subtitle:'ì½”ë“œ ìƒì„±ê¸°' });
      tryCall(['renderAdminMenu','renderAdminSidebar','mountAdminMenu'], { mountId:'admin-menu-slot', active:'blog' });
    })();
  </script>

<script>
  (function(){
    // ====== utils ======
    function $(id){ return document.getElementById(id); }
    function uid_(){ return Math.random().toString(36).slice(2, 8); }
    function setMsg(id, text, ok){
      var el = $(id);
      if(!el) return;
      el.textContent = text || '';
      el.className = 'msg ' + (ok ? 'ok' : 'bad');
      if(!text) el.className = 'msg';
    }
    function copyText_(text){
      if(navigator.clipboard && navigator.clipboard.writeText){
        return navigator.clipboard.writeText(String(text || ''));
      }
      // fallback
      return new Promise(function(resolve, reject){
        try{
          var ta = document.createElement('textarea');
          ta.value = String(text || '');
          ta.setAttribute('readonly','');
          ta.style.position='fixed';
          ta.style.left='-9999px';
          document.body.appendChild(ta);
          ta.select();
          var ok = document.execCommand('copy');
          document.body.removeChild(ta);
          if(ok) resolve(); else reject(new Error('ë³µì‚¬ ì‹¤íŒ¨(ë¸Œë¼ìš°ì € ì œí•œ)'));
        }catch(e){ reject(e); }
      });
    }
    function escAttr_(s){
      return String(s == null ? '' : s)
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;')
        .replace(/"/g,'&quot;')
        .replace(/'/g,'&#39;');
    }
    function parseLines_(text){
      return String(text || '')
        .replace(/\r\n/g, '\n')
        .replace(/\r/g, '\n')
        .split('\n')
        .map(function(x){ return x.trim(); })
        .filter(function(x){ return !!x; });
    }
    function shuffleCopy_(arr){
      var a = (arr || []).slice();
      for(var i=a.length-1;i>0;i--){
        var j = Math.floor(Math.random()*(i+1));
        var t=a[i]; a[i]=a[j]; a[j]=t;
      }
      return a;
    }

    // ====== tabs ======
    function activateTab(which){
      var tabFlash = $('tabFlash'), tabOrder = $('tabOrder');
      var paneFlash = $('paneFlash'), paneOrder = $('paneOrder');
      if(which === 'flash'){
        tabFlash.classList.add('is-active'); tabOrder.classList.remove('is-active');
        paneFlash.classList.remove('hide'); paneOrder.classList.add('hide');
      }else{
        tabOrder.classList.add('is-active'); tabFlash.classList.remove('is-active');
        paneOrder.classList.remove('hide'); paneFlash.classList.add('hide');
      }
    }

    // ====== rows: flashcard ======
    function addFlashRow_(front, back){
      front = front || ''; back = back || '';
      var wrap = $('fcRows');
      if(!wrap) return;

      var row = document.createElement('div');
      row.className = 'row';
      row.innerHTML =
        '<input type="text" class="fc-front" placeholder="ì•ë©´" value="' + escAttr_(front) + '">' +
        '<input type="text" class="fc-back" placeholder="ë’·ë©´" value="' + escAttr_(back) + '">' +
        '<button type="button" class="mini fc-del">ì‚­ì œ</button>';

      row.querySelector('.fc-del').addEventListener('click', function(){ row.remove(); });
      wrap.appendChild(row);
    }

    function clearFlashRows_(){
      var wrap = $('fcRows');
      if(wrap) wrap.innerHTML = '';
    }

    function collectFlashPairs_(){
      var wrap = $('fcRows');
      if(!wrap) throw new Error('fcRows ì˜ì—­ì´ ì—†ìŠµë‹ˆë‹¤. (HTMLì— id="fcRows" í™•ì¸)');
      var rows = Array.prototype.slice.call(wrap.querySelectorAll('.row'));

      var pairs = rows.map(function(r){
        var f = (r.querySelector('.fc-front') && r.querySelector('.fc-front').value ? r.querySelector('.fc-front').value : '').trim();
        var b = (r.querySelector('.fc-back') && r.querySelector('.fc-back').value ? r.querySelector('.fc-back').value : '').trim();
        return { front:f, back:b };
      });

      // ë¹ˆ ì¤„ ì œê±°
      pairs = pairs.filter(function(x){ return x.front || x.back; });

      if(pairs.length === 0) throw new Error('í”Œë˜ì‹œ ì¹´ë“œê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. ì¹´ë“œ ì¶”ê°€ í›„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
      // ì•/ë’¤ ëª¨ë‘ ìˆëŠ” ì¹´ë“œë§Œ
      pairs = pairs.filter(function(x){ return x.front && x.back; });
      if(pairs.length === 0) throw new Error('ì•/ë’·ë©´ì´ ëª¨ë‘ ì…ë ¥ëœ ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.');
      return pairs;
    }

    function bulkToFlashRows_(){
      var lines = parseLines_($('fcBulk').value);
      if(lines.length === 0) throw new Error('ì¼ê´„ ë¶™ì—¬ë„£ê¸° ë‚´ìš©ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.');
      clearFlashRows_();

      lines.forEach(function(line){
        // tab ìš°ì„ , ì—†ìœ¼ë©´ |
        var front='', back='';
        if(line.indexOf('\t') >= 0){
          var parts = line.split('\t');
          front = (parts[0] || '').trim();
          back  = (parts.slice(1).join('\t') || '').trim();
        }else if(line.indexOf('|') >= 0){
          var p2 = line.split('|');
          front = (p2[0] || '').trim();
          back  = (p2.slice(1).join('|') || '').trim();
        }else{
          // ë‹¨ë… ë¼ì¸ì€ ì•ë©´ë§Œ ë“¤ì–´ì˜¨ ê±¸ë¡œ ë³´ê³  ë’·ë©´ì€ ë¹„ì›€
          front = line.trim();
          back = '';
        }
        addFlashRow_(front, back);
      });
    }

    function flashRowsToBulk_(){
      var pairs = collectFlashPairs_(); // ì•/ë’¤ ë‹¤ ìˆëŠ” ê²ƒë§Œ
      var text = pairs.map(function(x){ return x.front + '\t' + x.back; }).join('\n');
      $('fcBulk').value = text;
    }

    // ====== rows: order quiz ======
    function addOrderRow_(label){
      label = label || '';
      var wrap = $('oqRows');
      if(!wrap) return;

      var row = document.createElement('div');
      row.className = 'row';
      row.innerHTML =
        '<input type="text" class="oq-label" placeholder="í•­ëª©(ë³´ê¸°/ì •ë‹µì— ë“¤ì–´ê°ˆ ë¬¸êµ¬)" value="' + escAttr_(label) + '">' +
        '<button type="button" class="mini oq-del">ì‚­ì œ</button>';

      row.querySelector('.oq-del').addEventListener('click', function(){ row.remove(); });
      wrap.appendChild(row);
    }

    function clearOrderRows_(){
      var wrap = $('oqRows');
      if(wrap) wrap.innerHTML = '';
    }

    function collectOrderLabels_(){
      var wrap = $('oqRows');
      if(!wrap) throw new Error('oqRows ì˜ì—­ì´ ì—†ìŠµë‹ˆë‹¤. (HTMLì— id="oqRows" í™•ì¸)');

      var inputs = Array.prototype.slice.call(wrap.querySelectorAll('.oq-label'));
      var labels = inputs.map(function(el){
        return (el && el.value ? el.value : '').trim();
      }).filter(function(v){ return !!v; });

      if(labels.length < 2) throw new Error('ìˆœì„œ í€´ì¦ˆ í•­ëª©ì€ ìµœì†Œ 2ê°œ ì´ìƒ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
      return labels;
    }

    function bulkToOrderRows_(){
      var lines = parseLines_($('oqBulk').value);
      if(lines.length === 0) throw new Error('ì¼ê´„ ë¶™ì—¬ë„£ê¸° ë‚´ìš©ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.');
      clearOrderRows_();
      lines.forEach(function(line){ addOrderRow_(line); });
    }

    function orderRowsToBulk_(){
      var labels = collectOrderLabels_();
      $('oqBulk').value = labels.join('\n');
    }

    function parseOrderNums_(text, n){
      var raw = String(text || '').trim();
      if(!raw) return { ok:true, nums:null }; // ë¯¸ì…ë ¥ OK

      var nums = raw.split(',')
        .map(function(s){ return s.trim(); })
        .filter(function(s){ return !!s; })
        .map(function(s){ return Number(s); });

      if(nums.length !== n) return { ok:false, msg:'ì •ë‹µ ìˆœì„œ ìˆ«ì ê°œìˆ˜(' + nums.length + ')ê°€ ë³´ê¸° í•­ëª©(' + n + ')ê³¼ ë‹¬ë¼ìš”.' };
      for(var i=0;i<nums.length;i++){
        var x = nums[i];
        if(!Number.isInteger(x) || x < 1 || x > n) return { ok:false, msg:'ì •ë‹µ ìˆœì„œì— 1~' + n + ' ë²”ìœ„ ë°– ìˆ«ìê°€ ìˆì–´ìš”: ' + x };
      }
      // ì¤‘ë³µ ì²´í¬
      var set = {};
      for(i=0;i<nums.length;i++){
        if(set[nums[i]]) return { ok:false, msg:'ì •ë‹µ ìˆœì„œì— ì¤‘ë³µ ìˆ«ìê°€ ìˆì–´ìš”.' };
        set[nums[i]] = true;
      }
      return { ok:true, nums: nums };
    }

    // ====== snippet builders (ë¸”ë¡œê·¸ì— ë¶™ì¼ ì½”ë“œ ìƒì„±) ======
    function buildFlashcardSnippet_(cards){
      var id = 'cheese-flashcard-root-' + uid_();
      var data = JSON.stringify(cards);

      return '<!-- â–¼ ì¹´ë“œê°€ í‘œì‹œë  ìë¦¬ -->\n' +
      '<div id="' + id + '" class="cheese-flashcard-wrapper"></div>\n\n' +
      '<style>\n' +
      '  .cheese-flashcard-wrapper{display:flex;flex-direction:column;align-items:center;gap:1.5rem;margin:1.5rem 0;}\n' +
      '  .cheese-flashcard{background:none;border:none;padding:0;width:380px;height:230px;perspective:1000px;cursor:pointer;position:relative;border-radius:22px;overflow:hidden;box-shadow:0 14px 30px rgba(15,23,42,.2);}\n' +
      '  .cheese-flashcard.is-flipped .cheese-flashcard-inner{transform:rotateY(180deg);}\n' +
      '  .cheese-flashcard-inner{width:100%;height:100%;position:relative;border-radius:22px;box-shadow:0 14px 30px rgba(15,23,42,.2);background:#fff;transform-style:preserve-3d;transition:transform .4s ease;}\n' +
      '  .cheese-flashcard-face{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;padding:1.4rem 1.8rem;box-sizing:border-box;backface-visibility:hidden;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;font-size:1.4rem;text-align:center;line-height:1.5;border-radius:22px;}\n' +
      '  .cheese-flashcard-front{background:#111827;color:#f9fafb;font-weight:700;}\n' +
      '  .cheese-flashcard-back{background:#e0f2fe;color:#111827;transform:rotateY(180deg);}\n' +
      '  .cheese-flashcard-main{font-size:1.7rem;font-weight:800;}\n' +
      '  .cheese-flashcard-hint{position:absolute;right:.9rem;bottom:.6rem;font-size:.75rem;opacity:.8;display:inline-flex;align-items:center;gap:.1rem;pointer-events:none;}\n' +
      '  @media(max-width:600px){.cheese-flashcard{width:80vw;max-width:320px;height:200px;}.cheese-flashcard-main{font-size:2rem;}.cheese-flashcard-hint{font-size:1.05rem;right:.7rem;bottom:.45rem;}.cheese-flashcard{-webkit-tap-highlight-color:transparent;outline:none;}}\n' +
      '</style>\n\n' +
      '<script>\n' +
      '(function(){\n' +
      '  var cheeseCards = ' + data + ';\n' +
      '  var root = document.getElementById("' + id + '");\n' +
      '  if(!root) return;\n' +
      '  function esc(s){\n' +
      '    return String(s == null ? "" : s)\n' +
      '      .replace(/&/g,"&amp;")\n' +
      '      .replace(/</g,"&lt;")\n' +
      '      .replace(/>/g,"&gt;")\n' +
      '      .replace(/"/g,"&quot;")\n' +
      "      .replace(/'/g,\"&#39;\");\n" +
      '  }\n' +
      '  cheeseCards.forEach(function(item, idx){\n' +
      '    var card = document.createElement("button");\n' +
      '    card.type = "button";\n' +
      '    card.className = "cheese-flashcard";\n' +
      '    card.setAttribute("aria-label", "ì¹´ë“œ " + (idx+1));\n' +
      '    card.setAttribute("aria-pressed","false");\n' +
      '    card.innerHTML = `\n' +
      '      <div class="cheese-flashcard-inner">\n' +
      '        <div class="cheese-flashcard-face cheese-flashcard-front">\n' +
      '          <span class="cheese-flashcard-main">${esc(item.front)}</span>\n' +
      '          <span class="cheese-flashcard-hint">ğŸ‘‰ ë’¤ì§‘ê¸°</span>\n' +
      '        </div>\n' +
      '        <div class="cheese-flashcard-face cheese-flashcard-back">\n' +
      '          <span class="cheese-flashcard-main">${esc(item.back)}</span>\n' +
      '          <span class="cheese-flashcard-hint">ğŸ‘‰ ë’¤ì§‘ê¸°</span>\n' +
      '        </div>\n' +
      '      </div>\n' +
      '    `;\n' +
      '    card.addEventListener("click", function(){\n' +
      '      card.classList.toggle("is-flipped");\n' +
      '      card.setAttribute("aria-pressed", card.classList.contains("is-flipped") ? "true" : "false");\n' +
      '    });\n' +
      '    root.appendChild(card);\n' +
      '  });\n' +
      '})();\n' +
      '</scr' + 'ipt>\n';
    }

    
    function buildOrderSnippet_(opts){
      var title = (opts && opts.title ? String(opts.title) : '').trim() || 'ì‹œëŒ€ ìˆœì„œë¥¼ ë§ì¶° ë³´ì„¸ìš”';
      var sub   = (opts && opts.sub ? String(opts.sub) : '').trim() || 'ì¹´ë“œë¥¼ ì•„ë˜ ìˆœì„œ ì˜ì—­ìœ¼ë¡œ ë“œë˜ê·¸í•´ì„œ ì˜®ê²¨ ë³´ì„¸ìš”.';
      var labels = (opts && opts.labels) ? opts.labels : [];
      var orderNums = (opts && opts.orderNums) ? opts.orderNums : null;

      var id = 'cheese-order-quiz-' + uid_();

      // items: i1,i2,...
      var items = labels.map(function(label, idx){
        return { id: 'i' + (idx+1), label: label };
      });

      var correctOrder = (orderNums && orderNums.length === labels.length)
        ? orderNums.map(function(n){ return 'i' + n; })
        : labels.map(function(_, i){ return 'i' + (i+1); });

      var itemsJson = JSON.stringify(items);
      var correctJson = JSON.stringify(correctOrder);

      return '<!-- â–¼ ìˆœì„œ ë§ì¶”ê¸° í€´ì¦ˆê°€ ë“¤ì–´ê°ˆ ìë¦¬ -->\n' +
      '<div id="' + id + '" class="cheese-order-quiz"></div>\n\n' +
      '<style>\n' +
      '  :root{--coq-wine:#7B2C39;--coq-gray:#d1d5db;}\n' +
      '  .cheese-order-quiz{max-width:720px;margin:2rem auto;padding:1.5rem 1.25rem;border-radius:16px;background:#f9fafb;box-shadow:0 8px 22px rgba(15,23,42,.10);font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;box-sizing:border-box;}\n' +
      '  .cheese-order-title{font-size:2rem;font-weight:700;margin-bottom:1.2rem;}\n' +
      '  .cheese-order-sub{font-size:1.2rem;color:#6b7280;margin-bottom:1.2rem;}\n' +
      '  .cheese-order-section-label{font-size:1.2rem;font-weight:600;color:#4b5563;margin-bottom:.4rem;}\n' +
      '  .cheese-order-top,.cheese-order-bottom{display:flex;flex-wrap:wrap;gap:.8rem;margin-bottom:1rem;min-height:3.5rem;}\n' +
      '  .cheese-order-bottom{flex-direction:column;flex-wrap:nowrap;gap:.6rem;}\n' +
      '  .cheese-order-card{flex:1 1 auto;width:100%;min-width:0;box-sizing:border-box;padding:.6rem 1.1rem;border-radius:999px;border:2px solid var(--coq-wine);background:#111827;color:#f9fafb;font-size:1.0rem;font-weight:600;text-align:center;cursor:grab;user-select:none;box-shadow:0 3px 8px rgba(15,23,42,.25);}\n' +
      '  .cheese-order-card:active{cursor:grabbing;}\n' +
      '  .cheese-order-card.is-dragging{transform:scale(1.04);box-shadow:0 10px 22px rgba(15,23,42,.25);}\n' +
      '  .cheese-order-slot,.cheese-order-top-slot{min-width:130px;min-height:46px;border-radius:999px;border:2px dashed var(--coq-gray);background:#fff;display:flex;align-items:center;justify-content:center;font-size:1.2rem;color:#9ca3af;box-sizing:border-box;}\n' +
      '  .cheese-order-top-slot{flex:1 1 calc(50% - .85rem);min-width:calc(50% - .85rem);}\n' +
      '  .cheese-order-slot{flex:1 1 100%;min-width:100%;}\n' +
      '  .cheese-order-slot.has-card{border-style:solid;border-color:#cbd5f5;background:#eef2ff;color:transparent;}\n' +
      '  .cheese-order-slot.is-over{border-color:#6366f1;background:#e0e7ff;transform:translateY(-2px);}\n' +
      '  .cheese-order-controls{display:flex;flex-wrap:wrap;gap:.8rem;justify-content:flex-end;align-items:center;margin-top:.9rem;}\n' +
      '  .cheese-order-btn{padding:.7rem 1.5rem;border-radius:999px;border:none;font-size:1.2rem;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:.4rem;white-space:nowrap;box-shadow:0 4px 10px rgba(15,23,42,.18);}\n' +
      '  .cheese-order-btn:not(.secondary){background:#dc2626;color:#fff;}\n' +
      '  .cheese-order-btn.secondary{background:#e5e7eb;color:#111827;}\n' +
      '  .cheese-order-result{flex:1;font-size:1.5rem;color:#4b5563;}\n' +
      '  .cheese-order-result.ok{color:#15803d;font-weight:600;}\n' +
      '  .cheese-order-result.bad{color:#b91c1c;font-weight:600;}\n' +
      '  .cheese-order-guide{display:flex;flex-direction:column;align-items:center;gap:.2rem;margin:.4rem 0 .7rem;font-size:1.2rem;color:#6b7280;}\n' +
      '  .cheese-order-guide-arrow{font-size:2rem;line-height:1.5rem;}\n' +
      '  .cheese-order-slot-arrow{text-align:center;font-size:1.2rem;line-height:1;color:#d1d5db;margin:.1rem 0;}\n' +
      '</style>\n\n' +
      '<script>\n' +
      '(function(){\n' +
      '  var root = document.getElementById("' + id + '");\n' +
      '  if(!root) return;\n' +
      '  var items = ' + itemsJson + ';\n' +
      '  var correctOrder = ' + correctJson + ';\n' +
      '  root.innerHTML = "" +\n' +
      '    "<div class=\\"cheese-order-title\\">' + title.replace(/</g,'&lt;') + '</div>" +\n' +
      '    "<div class=\\"cheese-order-sub\\">' + sub.replace(/</g,'&lt;') + '</div>" +\n' +
      '    "<div class=\\"cheese-order-section cheese-order-section-top\\">" +\n' +
      '      "<div class=\\"cheese-order-section-label\\">ë³´ê¸°</div>" +\n' +
      '      "<div class=\\"cheese-order-top\\" data-top></div>" +\n' +
      '    "</div>" +\n' +
      '    "<div class=\\"cheese-order-guide\\"><div class=\\"cheese-order-guide-arrow\\">â¬‡</div><div class=\\"cheese-order-guide-text\\">ì¹´ë“œë¥¼ ì•„ë˜ ìˆœì„œ ì˜ì—­ìœ¼ë¡œ ë“œë˜ê·¸í•´ì„œ ì˜®ê²¨ ë³´ì„¸ìš”.</div></div>" +\n' +
      '    "<div class=\\"cheese-order-section cheese-order-section-bottom\\">" +\n' +
      '      "<div class=\\"cheese-order-section-label\\">ì •ë‹µ</div>" +\n' +
      '      "<div class=\\"cheese-order-bottom\\" data-bottom></div>" +\n' +
      '    "</div>" +\n' +
      '    "<div class=\\"cheese-order-controls\\">" +\n' +
      '      "<div class=\\"cheese-order-result\\" id=\\"' + id + '-result\\"></div>" +\n' +
      '      "<button type=\\"button\\" class=\\"cheese-order-btn secondary\\" id=\\"' + id + '-reset\\">â†º ì´ˆê¸°í™”</button>" +\n' +
      '      "<button type=\\"button\\" class=\\"cheese-order-btn\\" id=\\"' + id + '-check\\">âœ… ì±„ì í•˜ê¸°</button>" +\n' +
      '    "</div>";\n' +
      '\n' +
      '  var topRow = root.querySelector("[data-top]");\n' +
      '  var bottomRow = root.querySelector("[data-bottom]");\n' +
      '  var resultEl = document.getElementById("' + id + '-result");\n' +
      '  var btnReset = document.getElementById("' + id + '-reset");\n' +
      '  var btnCheck = document.getElementById("' + id + '-check");\n' +
      '\n' +
      '  var slotCount = correctOrder.length;\n' +
      '  var topSlots = [];\n' +
      '  for(var i=0;i<slotCount;i++){\n' +
      '    var ts = document.createElement("div");\n' +
      '    ts.className = "cheese-order-top-slot";\n' +
      '    ts.dataset.topIndex = String(i);\n' +
      '    topRow.appendChild(ts);\n' +
      '    topSlots.push(ts);\n' +
      '  }\n' +
      '  for(i=0;i<slotCount;i++){\n' +
      '    var slot = document.createElement("div");\n' +
      '    slot.className = "cheese-order-slot";\n' +
      '    slot.dataset.slotIndex = String(i);\n' +
      '    slot.textContent = (i+1) + "ë²ˆ";\n' +
      '    bottomRow.appendChild(slot);\n' +
      '    if(i < slotCount - 1){\n' +
      '      var arrow = document.createElement("div");\n' +
      '      arrow.className = "cheese-order-slot-arrow";\n' +
      '      arrow.textContent = "â†“";\n' +
      '      bottomRow.appendChild(arrow);\n' +
      '    }\n' +
      '  }\n' +
      '\n' +
      '  function placeInTop(cardEl){\n' +
      '    var target = null;\n' +
      '    for(var k=0;k<topSlots.length;k++){\n' +
      '      if(!topSlots[k].querySelector(".cheese-order-card")){ target = topSlots[k]; break; }\n' +
      '    }\n' +
      '    if(!target) target = topSlots[0];\n' +
      '    if(target) target.appendChild(cardEl);\n' +
      '  }\n' +
      '\n' +
      '  // ì¹´ë“œ ìƒì„±\n' +
      '  for(i=0;i<items.length;i++){\n' +
      '    var item = items[i];\n' +
      '    var card = document.createElement("div");\n' +
      '    card.className = "cheese-order-card";\n' +
      '    card.draggable = true;\n' +
      '    card.dataset.itemId = item.id;\n' +
      '    card.textContent = item.label;\n' +
      '    (topSlots[i] || topSlots[0]).appendChild(card);\n' +
      '  }\n' +
      '\n' +
      '  var draggingCard = null;\n' +
      '  root.addEventListener("dragstart", function(e){\n' +
      '    var card = e.target && e.target.closest ? e.target.closest(".cheese-order-card") : null;\n' +
      '    if(!card) return;\n' +
      '    draggingCard = card;\n' +
      '    card.classList.add("is-dragging");\n' +
      '    if(e.dataTransfer){ e.dataTransfer.effectAllowed = "move"; try{ e.dataTransfer.setData("text/plain", card.dataset.itemId || ""); }catch(_){} }\n' +
      '  });\n' +
      '  root.addEventListener("dragend", function(){\n' +
      '    if(draggingCard){ draggingCard.classList.remove("is-dragging"); }\n' +
      '    draggingCard = null;\n' +
      '    var overs = root.querySelectorAll(".cheese-order-slot.is-over");\n' +
      '    for(var i2=0;i2<overs.length;i2++) overs[i2].classList.remove("is-over");\n' +
      '  });\n' +
      '  root.addEventListener("dragover", function(e){\n' +
      '    if(!draggingCard) return;\n' +
      '    var slot = e.target && e.target.closest ? e.target.closest(".cheese-order-slot") : null;\n' +
      '    var topArea = e.target && e.target.closest ? e.target.closest("[data-top]") : null;\n' +
      '    if(!slot && !topArea) return;\n' +
      '    e.preventDefault();\n' +
      '    var overs = root.querySelectorAll(".cheese-order-slot.is-over");\n' +
      '    for(var i3=0;i3<overs.length;i3++) overs[i3].classList.remove("is-over");\n' +
      '    if(slot) slot.classList.add("is-over");\n' +
      '  });\n' +
      '  root.addEventListener("drop", function(e){\n' +
      '    if(!draggingCard) return;\n' +
      '    var slot = e.target && e.target.closest ? e.target.closest(".cheese-order-slot") : null;\n' +
      '    var topArea = e.target && e.target.closest ? e.target.closest("[data-top]") : null;\n' +
      '    if(!slot && !topArea) return;\n' +
      '    e.preventDefault();\n' +
      '    // ì•„ë˜ ìŠ¬ë¡¯ ë“œë¡­\n' +
      '    if(slot){\n' +
      '      var existing = slot.querySelector(".cheese-order-card");\n' +
      '      if(existing) placeInTop(existing);\n' +
      '      slot.innerHTML = "";\n' +
      '      slot.appendChild(draggingCard);\n' +
      '      slot.classList.add("has-card");\n' +
      '      if(resultEl){ resultEl.textContent = ""; resultEl.className = "cheese-order-result"; }\n' +
      '      return;\n' +
      '    }\n' +
      '    // ìœ„ìª½ ì˜ì—­ ë“œë¡­\n' +
      '    if(topArea){\n' +
      '      placeInTop(draggingCard);\n' +
      '      if(resultEl){ resultEl.textContent = ""; resultEl.className = "cheese-order-result"; }\n' +
      '      var slots = bottomRow.querySelectorAll(".cheese-order-slot");\n' +
      '      for(var j=0;j<slots.length;j++){\n' +
      '        if(!slots[j].querySelector(".cheese-order-card")){\n' +
      '          slots[j].classList.remove("has-card");\n' +
      '          slots[j].textContent = (Number(slots[j].dataset.slotIndex) + 1) + "ë²ˆ";\n' +
      '        }\n' +
      '      }\n' +
      '    }\n' +
      '  });\n' +
      '\n' +
      '  btnCheck.addEventListener("click", function(){\n' +
      '    var slots = bottomRow.querySelectorAll(".cheese-order-slot");\n' +
      '    var userOrder = [];\n' +
      '    var filled = 0;\n' +
      '    for(var i4=0;i4<slots.length;i4++){\n' +
      '      var c = slots[i4].querySelector(".cheese-order-card");\n' +
      '      if(c){ userOrder.push(c.dataset.itemId || null); filled++; }\n' +
      '      else userOrder.push(null);\n' +
      '    }\n' +
      '    if(filled < correctOrder.length){\n' +
      '      if(resultEl){ resultEl.textContent = "ì•„ì§ ë¹ˆ ì¹¸ì´ ìˆì–´ìš”. ëª¨ë“  ì¹¸ì— ì¹´ë“œë¥¼ ë°°ì¹˜í•´ ì£¼ì„¸ìš”."; resultEl.className = "cheese-order-result bad"; }\n' +
      '      return;\n' +
      '    }\n' +
      '    var ok = true;\n' +
      '    for(var i5=0;i5<userOrder.length;i5++) if(userOrder[i5] !== correctOrder[i5]) ok = false;\n' +
      '    if(resultEl){\n' +
      '      if(ok){ resultEl.textContent = "ì •ë‹µ! ì•„ì£¼ ì˜í–ˆìŠµë‹ˆë‹¤ ğŸ‘"; resultEl.className = "cheese-order-result ok"; }\n' +
      '      else{ resultEl.textContent = "ìˆœì„œê°€ ì¼ë¶€ ë‹¤ë¦…ë‹ˆë‹¤. ë‹¤ì‹œ í•œ ë²ˆ ì¡°ì •í•´ ë³´ì„¸ìš”."; resultEl.className = "cheese-order-result bad"; }\n' +
      '    }\n' +
      '  });\n' +
      '\n' +
      '  btnReset.addEventListener("click", function(){\n' +
      '    // ì•„ë˜ ë¹„ìš°ê¸°\n' +
      '    var slots = bottomRow.querySelectorAll(".cheese-order-slot");\n' +
      '    for(var i6=0;i6<slots.length;i6++){\n' +
      '      var card = slots[i6].querySelector(".cheese-order-card");\n' +
      '      if(card) card.remove();\n' +
      '      slots[i6].classList.remove("has-card","is-over");\n' +
      '      slots[i6].textContent = (Number(slots[i6].dataset.slotIndex) + 1) + "ë²ˆ";\n' +
      '    }\n' +
      '    // ìœ„ ë¹„ìš°ê¸°\n' +
      '    for(i6=0;i6<topSlots.length;i6++){\n' +
      '      var c2 = topSlots[i6].querySelector(".cheese-order-card");\n' +
      '      if(c2) c2.remove();\n' +
      '    }\n' +
      '    // ë‹¤ì‹œ ìƒì„±\n' +
      '    for(i6=0;i6<items.length;i6++){\n' +
      '      var it = items[i6];\n' +
      '      var c3 = document.createElement("div");\n' +
      '      c3.className = "cheese-order-card";\n' +
      '      c3.draggable = true;\n' +
      '      c3.dataset.itemId = it.id;\n' +
      '      c3.textContent = it.label;\n' +
      '      (topSlots[i6] || topSlots[0]).appendChild(c3);\n' +
      '    }\n' +
      '    if(resultEl){ resultEl.textContent = ""; resultEl.className = "cheese-order-result"; }\n' +
      '  });\n' +
      '})();\n' +
      '<\\/script>';
    }


    // ====== wire ======
    function wire_(){
      $('tabFlash').addEventListener('click', function(){ activateTab('flash'); });
      $('tabOrder').addEventListener('click', function(){ activateTab('order'); });

      // flash bulk
      $('fcBulkLoad').addEventListener('click', function(){
        try{ bulkToFlashRows_(); setMsg('msg','ì¼ê´„ ì…ë ¥ ë°˜ì˜ ì™„ë£Œ', true); }
        catch(e){ setMsg('msg', e.message || String(e), false); }
      });
      $('fcBulkExport').addEventListener('click', function(){
        try{ flashRowsToBulk_(); setMsg('msg','ë‚´ë³´ë‚´ê¸° ì™„ë£Œ', true); }
        catch(e){ setMsg('msg', e.message || String(e), false); }
      });
      $('fcBulkClear').addEventListener('click', function(){ $('fcBulk').value=''; setMsg('msg','', true); });

      // flash rows
      $('fcAdd').addEventListener('click', function(){ addFlashRow_(); });
      $('fcClearRows').addEventListener('click', function(){ clearFlashRows_(); addFlashRow_(); setMsg('msg','', true); });

      // flash gen/copy/clear
      $('btnGen').addEventListener('click', function(){
        try{
          var pairs = collectFlashPairs_();
          var code = buildFlashcardSnippet_(pairs);
          $('out').value = code;
          setMsg('msg', 'ìƒì„± ì™„ë£Œ', true);
        }catch(e){
          setMsg('msg', e.message || String(e), false);
        }
      });
      $('btnCopy').addEventListener('click', function(){
        copyText_($('out').value || '')
          .then(function(){ setMsg('msg', 'ë³µì‚¬ ì™„ë£Œ', true); })
          .catch(function(e){ setMsg('msg', e.message || String(e), false); });
      });
      $('btnClear').addEventListener('click', function(){ $('out').value=''; setMsg('msg','', true); });

      // order bulk
      $('oqBulkLoad').addEventListener('click', function(){
        try{ bulkToOrderRows_(); setMsg('msg2','ì¼ê´„ ì…ë ¥ ë°˜ì˜ ì™„ë£Œ', true); }
        catch(e){ setMsg('msg2', e.message || String(e), false); }
      });
      $('oqBulkExport').addEventListener('click', function(){
        try{ orderRowsToBulk_(); setMsg('msg2','ë‚´ë³´ë‚´ê¸° ì™„ë£Œ', true); }
        catch(e){ setMsg('msg2', e.message || String(e), false); }
      });
      $('oqBulkClear').addEventListener('click', function(){ $('oqBulk').value=''; setMsg('msg2','', true); });

      // order rows
      $('oqAdd').addEventListener('click', function(){ addOrderRow_(); });
      $('oqClearRows').addEventListener('click', function(){ clearOrderRows_(); addOrderRow_(); setMsg('msg2','', true); });

      // order custom toggle
      $('oqUseCustomOrder').addEventListener('change', function(){
        var on = $('oqUseCustomOrder').checked;
        $('oqOrderBox').classList.toggle('hide', !on);
      });

      // order gen/copy/clear
      $('btnGen2').addEventListener('click', function(){
        try{
          var labels = collectOrderLabels_();
          var title = ($('oqTitle').value || '').trim();
          var sub   = ($('oqSub').value || '').trim();
          var shuffle = !!$('oqShuffle').checked;

          var orderNums = null;
          if($('oqUseCustomOrder').checked){
            var ordRaw = ($('oqOrder').value || '');
            var parsed = parseOrderNums_(ordRaw, labels.length);
            if(!parsed.ok) throw new Error(parsed.msg);
            orderNums = parsed.nums;
          }

          var code = buildOrderSnippet_({ title:title, sub:sub, labels:labels, orderNums:orderNums, shuffle:shuffle });
          $('out2').value = code;
          setMsg('msg2', 'ìƒì„± ì™„ë£Œ', true);
        }catch(e){
          setMsg('msg2', e.message || String(e), false);
        }
      });

      $('btnCopy2').addEventListener('click', function(){
        copyText_($('out2').value || '')
          .then(function(){ setMsg('msg2', 'ë³µì‚¬ ì™„ë£Œ', true); })
          .catch(function(e){ setMsg('msg2', e.message || String(e), false); });
      });

      $('btnClear2').addEventListener('click', function(){ $('out2').value=''; setMsg('msg2','', true); });
    }

    document.addEventListener('DOMContentLoaded', function(){
      wire_();
      // ê¸°ë³¸ 1ì¤„ì”©
      addFlashRow_();
      addOrderRow_();
      activateTab('flash');
    });
  })();
  </script>
</body>
</html>
